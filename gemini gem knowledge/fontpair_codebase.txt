Project: FontPair AI
Generated: 2025-11-19T09:21:42.951Z


================================================================================
FILE PATH: App.tsx
================================================================================
import React, { useState, useEffect, useRef } from 'react';
import { CadmusLogoIcon, SparklesIcon, HistoryIcon, SettingsIcon } from './components/Icons';
import AnalysisColumn from './components/AnalysisColumn';
import type { FontAnalysis, PairingCritique, GlyphComparisonResult, AIMode, Project } from './types';
import { critiqueFontPairing, compareGlyphs } from './services/geminiService';
import PairingCritiqueModal from './components/PairingCritiqueModal';
import HistoryPanel from './components/HistoryPanel';
import GlyphComparisonModal from './components/GlyphComparisonModal';
import SettingsModal from './components/SettingsModal';
import LicenseKeyScreen from './components/LicenseKeyScreen';
import FontSuggestionView from './components/FontSuggestionView';
import OnboardingTour from './components/OnboardingTour';
import PaperTexture from './components/PaperTexture';
import ProjectPanel from './components/ProjectPanel';
import TypeScaleBuilder from './components/TypeScaleBuilder';
import BatchCompatibilityMatrix from './components/BatchCompatibilityMatrix';
import { getAIMode, setAIMode, getAPIKey, validateAIMode, isChromeAIAvailable } from './utils/aiSettings';
import { checkActivationStatus } from './services/licenseService';

type ViewMode = 'comparison' | 'suggestions';


const App: React.FC = () => {
  const [viewMode, setViewMode] = useState<ViewMode>('comparison');
  const [sharedAnalysis, setSharedAnalysis] = useState<FontAnalysis | null>(null);
  const [leftAnalysis, setLeftAnalysis] = useState<FontAnalysis | null>(null);
  const [rightAnalysis, setRightAnalysis] = useState<FontAnalysis | null>(null);
  const [critique, setCritique] = useState<PairingCritique | null>(null);
  const [isCritiquing, setIsCritiquing] = useState<boolean>(false);
  const [critiqueError, setCritiqueError] = useState<string | null>(null);
  const [showHistory, setShowHistory] = useState(false);
  const [glyphComparison, setGlyphComparison] = useState<GlyphComparisonResult | null>(null);
  const [isComparingGlyphs, setIsComparingGlyphs] = useState(false);
  const [leftPreviewImage, setLeftPreviewImage] = useState<string | null>(null);
  const [rightPreviewImage, setRightPreviewImage] = useState<string | null>(null);
  const [showSettings, setShowSettings] = useState(false);
  const [aiMode, setAiModeState] = useState<AIMode>('cloud');
  const [chromeAIAvailable, setChromeAIAvailable] = useState(false);
  const [hasAPIKey, setHasAPIKey] = useState(false);
  const [isLicenseValid, setIsLicenseValid] = useState<boolean | null>(null); // null = checking, true = valid, false = invalid
  const [isCheckingLicense, setIsCheckingLicense] = useState(true);
  const [showOnboarding, setShowOnboarding] = useState(false);
  const [showProjects, setShowProjects] = useState(false);
  const [activeProject, setActiveProject] = useState<Project | null>(null);
  const [showTypeScale, setShowTypeScale] = useState(false);
  const [showBatchMatrix, setShowBatchMatrix] = useState(false);

  // Check license on mount
  useEffect(() => {
    const checkLicense = async () => {
      setIsCheckingLicense(true);
      try {
        const result = await checkActivationStatus();
        setIsLicenseValid(result.valid);
      } catch (error) {
        console.error('License check failed:', error);
        setIsLicenseValid(false);
      } finally {
        setIsCheckingLicense(false);
      }
    };

    checkLicense();
  }, []);

  useEffect(() => {
    const handleHashChange = () => {
      const hash = window.location.hash.slice(1);
      if (hash) {
        try {
          const decodedJson = atob(hash);
          const data = JSON.parse(decodedJson);
          setSharedAnalysis(data as FontAnalysis);
        } catch (e) {
          console.error("Failed to parse shared data from URL", e);
          window.location.hash = ''; // Clear invalid hash
        }
      } else {
        setSharedAnalysis(null);
      }
    };

    window.addEventListener('hashchange', handleHashChange);
    handleHashChange(); // Check hash on initial load

    return () => {
      window.removeEventListener('hashchange', handleHashChange);
    };
  }, []);

  // Initialize AI mode and check availability
  useEffect(() => {
    const initAISettings = async () => {
      // Check Chrome AI availability
      const chromeAvailable = await isChromeAIAvailable();
      setChromeAIAvailable(chromeAvailable);

      // Load saved AI mode
      const savedMode = await getAIMode();
      setAiModeState(savedMode);

      // Check if API key exists
      const apiKey = getAPIKey();
      setHasAPIKey(!!apiKey);
    };

    initAISettings();
  }, []);

  // Check if user has completed onboarding
  useEffect(() => {
    const hasCompleted = localStorage.getItem('onboarding_completed');
    if (!hasCompleted && isLicenseValid) {
      // Delay slightly to ensure DOM is ready
      setTimeout(() => setShowOnboarding(true), 500);
    }
  }, [isLicenseValid]);

  const handleToggleAIMode = async () => {
    const newMode: AIMode = aiMode === 'chrome' ? 'cloud' : 'chrome';

    // Validate the new mode
    const validation = await validateAIMode(newMode);
    if (!validation.valid) {
      // If Chrome AI fails, auto-fallback to Cloud AI
      if (validation.shouldFallback && newMode === 'chrome') {
        alert('Chrome AI is experimental and not available on your system. Using Cloud AI instead.');
        // Stay on cloud mode
        return;
      }

      // For Cloud AI, show settings to add API key
      alert(validation.error);
      if (newMode === 'cloud') {
        setShowSettings(true);
      }
      return;
    }

    // Mode is valid, switch to it
    setAiModeState(newMode);
    setAIMode(newMode);
  };
  
  const resetToComparisonView = () => {
      window.location.hash = '';
      setSharedAnalysis(null);
  }
  
  const handleCritique = async () => {
      if (!leftAnalysis || !rightAnalysis) return;
      setIsCritiquing(true);
      setCritique(null);
      setCritiqueError(null);
      try {
          const result = await critiqueFontPairing(leftAnalysis, rightAnalysis);
          setCritique(result);
      } catch (e) {
          console.error("Critique failed:", e);
          setCritiqueError("The AI critique failed. Please try again.");
          setTimeout(() => setCritiqueError(null), 4000);
      } finally {
          setIsCritiquing(false);
      }
  };

  const handleLoadFromHistory = (analysis: FontAnalysis) => {
    setLeftAnalysis(analysis);
  };

  const handleGlyphComparison = async () => {
    if (!leftAnalysis || !rightAnalysis || !leftPreviewImage || !rightPreviewImage) return;
    setIsComparingGlyphs(true);
    setGlyphComparison(null);
    try {
      const result = await compareGlyphs(
        leftPreviewImage,
        rightPreviewImage,
        leftAnalysis.fontName,
        rightAnalysis.fontName
      );
      setGlyphComparison(result);
    } catch (e) {
      console.error("Glyph comparison failed:", e);
    } finally {
      setIsComparingGlyphs(false);
    }
  };

  const handleLicenseValidated = () => {
    setIsLicenseValid(true);
  };

  const handleAnalyzeFontFromSuggestions = (fontName: string) => {
    // Switch to comparison view - user can then select the font from Google Fonts dropdown
    setViewMode('comparison');
    // TODO: Could enhance this to auto-select the font in the Google Fonts dropdown
    console.log(`Suggested font to analyze: ${fontName}`);
  };

  const handleOnboardingComplete = () => {
    localStorage.setItem('onboarding_completed', 'true');
    setShowOnboarding(false);
  };

  const handleOnboardingSkip = () => {
    localStorage.setItem('onboarding_completed', 'true');
    setShowOnboarding(false);
  };

  // Show loading screen while checking license
  if (isCheckingLicense) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <CadmusLogoIcon className="w-auto mx-auto mb-6 animate-pulse icon-embossed" style={{ height: '200px', color: '#8B7355' }} />
          <p className="text-secondary text-lg">Checking license...</p>
        </div>
      </div>
    );
  }

  // Show license screen if license is invalid
  if (!isLicenseValid) {
    return <LicenseKeyScreen onLicenseValidated={handleLicenseValidated} />;
  }

  // Main app (only shown if license is valid)
  return (
    <div className="min-h-screen bg-background text-text-dark flex flex-col font-sans">
      {/* SVG Filters for paper texture */}
      <PaperTexture />

      <header className="w-full px-6 paper-texture-bg border-b-2" style={{ borderBottomColor: 'rgba(107, 93, 79, 0.3)', height: '100px' }}>
        <div className="container mx-auto flex justify-between items-center gap-6 h-full">
          {/* Left: Logo with embossed effect */}
          <div className="flex items-center">
            <CadmusLogoIcon aria-hidden="true" className="w-auto icon-embossed" style={{ color: '#8B7355', height: '150px' }} />
          </div>

          {/* Center: AI Mode Toggle with paper inset effect */}
          <div className="flex items-center gap-3 ai-toggle-inset rounded-lg p-3">
            {/* Cloud AI - Primary Option */}
            <button
              onClick={handleToggleAIMode}
              disabled={aiMode === 'cloud' && !hasAPIKey}
              className={`relative flex items-center gap-2 px-5 py-2.5 rounded-md transition-all duration-200 ${
                aiMode === 'cloud'
                  ? 'button-inset-active'
                  : 'button-inset'
              } ${aiMode === 'cloud' && !hasAPIKey ? 'opacity-50 cursor-not-allowed' : ''}`}
              title={aiMode === 'cloud' && !hasAPIKey ? 'Add API key in settings' : 'Switch to Cloud AI'}
              style={{
                color: aiMode === 'cloud' ? '#3d3226' : '#6b5d4f',
                fontWeight: aiMode === 'cloud' ? '700' : '600'
              }}
            >
              <span className="text-sm">Cloud AI</span>
              <span className={`text-xs px-2 py-0.5 rounded-full ${
                aiMode === 'cloud' ? 'paper-accent-bg text-primary' : 'bg-black/15'
              }`}>
                {hasAPIKey ? 'Recommended' : 'Setup'}
              </span>
            </button>

            <div className="w-px h-8 bg-black/15"></div>

            {/* Chrome AI - Experimental Option */}
            <button
              onClick={handleToggleAIMode}
              className={`relative flex items-center gap-2 px-5 py-2.5 rounded-md transition-all duration-200 ${
                aiMode === 'chrome'
                  ? 'button-inset-active'
                  : 'button-inset'
              }`}
              title={!chromeAIAvailable ? 'Chrome AI is experimental and not available' : 'Switch to Chrome AI (Experimental)'}
              style={{
                color: aiMode === 'chrome' ? '#3d3226' : '#6b5d4f',
                fontWeight: aiMode === 'chrome' ? '700' : '600'
              }}
            >
              <span className="text-sm">Chrome AI</span>
              <span className={`text-xs px-2 py-0.5 rounded-full ${
                aiMode === 'chrome' ? 'paper-accent-bg text-primary' : 'bg-black/15'
              }`}>
                Beta
              </span>
            </button>
          </div>

          {/* Right: Action Buttons with paper inset effect */}
          <div className="flex items-center gap-3">
            <button
              data-tour="find-fonts-button"
              onClick={() => setViewMode(viewMode === 'comparison' ? 'suggestions' : 'comparison')}
              className={`px-5 py-2.5 rounded-md font-semibold transition-all duration-200 ${
                viewMode === 'suggestions'
                  ? 'button-inset-active'
                  : 'button-inset'
              }`}
              aria-label="Toggle view mode"
              style={{
                color: viewMode === 'suggestions' ? '#3d3226' : '#6b5d4f'
              }}
            >
              <span className="text-sm">
                {viewMode === 'suggestions' ? 'Compare Fonts' : 'Find Fonts'}
              </span>
            </button>
            <button
              onClick={() => setShowProjects(true)}
              className={`button-inset p-2.5 rounded-md transition-all duration-200 flex items-center gap-2 ${
                activeProject ? 'ring-2 ring-accent/50' : ''
              }`}
              aria-label="View projects"
              style={{ color: '#6b5d4f' }}
            >
              <svg className="h-6 w-6 icon-embossed" style={{ color: '#8B7355' }} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
              </svg>
              <span className="hidden sm:inline text-sm font-semibold">
                {activeProject ? activeProject.name : 'Projects'}
              </span>
            </button>
            <button
              onClick={() => setShowHistory(true)}
              className="button-inset p-2.5 rounded-md transition-all duration-200 flex items-center gap-2"
              aria-label="View history"
              style={{ color: '#6b5d4f' }}
            >
              <HistoryIcon className="h-6 w-6 icon-embossed" style={{ color: '#8B7355' }} />
              <span className="hidden sm:inline text-sm font-semibold">History</span>
            </button>
            <button
              data-tour="settings-button"
              onClick={() => setShowSettings(true)}
              className="button-inset p-2.5 rounded-md transition-all duration-200"
              aria-label="Settings"
            >
              <SettingsIcon className="h-6 w-6 icon-embossed" style={{ color: '#8B7355' }} />
            </button>
          </div>
        </div>
      </header>

      <main className="flex-grow container mx-auto p-4 md:p-8 flex flex-col items-center">
        {viewMode === 'suggestions' ? (
          <FontSuggestionView onAnalyzeFont={handleAnalyzeFontFromSuggestions} />
        ) : sharedAnalysis ? (
          <div className="w-full max-w-4xl">
             <div className="mb-4 text-center">
                <p className="text-secondary">You are viewing a shared analysis.</p>
                <button onClick={resetToComparisonView} className="text-accent font-semibold hover:underline">Return to Comparison View</button>
            </div>
            <AnalysisColumn key="shared" analysisResult={sharedAnalysis} onAnalysisComplete={() => {}} isSharedView={true} />
          </div>
        ) : (
          <div className="w-full max-w-7xl">
            <p className="text-center text-lg text-light-secondary mb-8 max-w-4xl mx-auto">
              Upload a font file or an image of text in each column to get a side-by-side AI-powered analysis of the typefaces.
            </p>
            {/* Sticky Action Buttons - Always visible when both analyses are ready */}
            {leftAnalysis && rightAnalysis && (
                <div className="sticky top-4 z-20 flex justify-center gap-3 mb-6 flex-wrap">
                    <button
                        onClick={handleCritique}
                        disabled={isCritiquing}
                        className="px-6 py-3 bg-accent text-text-light font-bold rounded-full hover:opacity-90 disabled:bg-secondary disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-background focus-visible:ring-accent flex items-center gap-2"
                    >
                        <SparklesIcon className={`w-5 h-5 ${isCritiquing ? 'animate-spin' : ''}`} />
                        {isCritiquing ? 'Critiquing...' : 'Critique Pairing'}
                    </button>
                    <button
                        onClick={handleGlyphComparison}
                        disabled={isComparingGlyphs || !leftPreviewImage || !rightPreviewImage}
                        className="px-6 py-3 bg-teal-dark text-text-light font-bold rounded-full hover:bg-teal-medium disabled:bg-secondary/30 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-background focus-visible:ring-teal-medium flex items-center gap-2"
                    >
                        <SparklesIcon className={`w-5 h-5 ${isComparingGlyphs ? 'animate-spin' : ''}`} />
                        {isComparingGlyphs ? 'Comparing...' : 'Compare Glyphs'}
                    </button>
                    <button
                        onClick={() => setShowTypeScale(true)}
                        className="px-6 py-3 bg-teal-medium text-text-light font-bold rounded-full hover:bg-teal-dark transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-background focus-visible:ring-teal-light flex items-center gap-2"
                    >
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                        </svg>
                        Type Scale
                    </button>
                    <button
                        onClick={() => setShowBatchMatrix(true)}
                        className="px-6 py-3 bg-surface text-accent font-bold rounded-full border-2 border-accent hover:bg-accent hover:text-surface transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-background focus-visible:ring-accent flex items-center gap-2"
                    >
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
                        </svg>
                        Batch Matrix
                    </button>
                    {critiqueError && <p className="text-xs bg-danger text-text-light p-2 rounded-md">{critiqueError}</p>}
                </div>
            )}

            <div data-tour="comparison-area" className="grid grid-cols-1 lg:grid-cols-2 lg:gap-8 w-full">
                <div data-tour="analysis-column">
                  <AnalysisColumn key="left" analysisResult={leftAnalysis} onAnalysisComplete={setLeftAnalysis} onPreviewCaptured={setLeftPreviewImage} />
                </div>
                <AnalysisColumn key="right" analysisResult={rightAnalysis} onAnalysisComplete={setRightAnalysis} onPreviewCaptured={setRightPreviewImage} />
            </div>
          </div>
        )}
      </main>
      
      {critique && <PairingCritiqueModal critique={critique} onClose={() => setCritique(null)} font1Name={leftAnalysis?.fontName} font2Name={rightAnalysis?.fontName} />}

      {glyphComparison && (
        <GlyphComparisonModal
          comparison={glyphComparison}
          onClose={() => setGlyphComparison(null)}
          font1Name={leftAnalysis?.fontName || 'Font 1'}
          font2Name={rightAnalysis?.fontName || 'Font 2'}
        />
      )}

      <HistoryPanel
        isOpen={showHistory}
        onClose={() => setShowHistory(false)}
        onLoadAnalysis={handleLoadFromHistory}
      />

      <SettingsModal
        isOpen={showSettings}
        onClose={() => {
          setShowSettings(false);
          // Refresh AI settings after closing settings
          const initAISettings = async () => {
            const chromeAvailable = await isChromeAIAvailable();
            setChromeAIAvailable(chromeAvailable);
            const apiKey = getAPIKey();
            setHasAPIKey(!!apiKey);
          };
          initAISettings();
        }}
        onRestartTour={() => {
          setShowSettings(false);
          localStorage.removeItem('onboarding_completed');
          setTimeout(() => setShowOnboarding(true), 300);
        }}
      />

      <OnboardingTour
        isOpen={showOnboarding}
        onComplete={handleOnboardingComplete}
        onSkip={handleOnboardingSkip}
      />

      <ProjectPanel
        isOpen={showProjects}
        onClose={() => setShowProjects(false)}
        currentLeftFont={leftAnalysis}
        currentRightFont={rightAnalysis}
        currentCritique={critique}
        leftPreview={leftPreviewImage || undefined}
        rightPreview={rightPreviewImage || undefined}
        onProjectChange={setActiveProject}
      />

      <TypeScaleBuilder
        isOpen={showTypeScale}
        onClose={() => setShowTypeScale(false)}
        availableFonts={[leftAnalysis, rightAnalysis].filter((f): f is FontAnalysis => f !== null)}
      />

      <BatchCompatibilityMatrix
        isOpen={showBatchMatrix}
        onClose={() => setShowBatchMatrix(false)}
        availableFonts={[leftAnalysis, rightAnalysis].filter((f): f is FontAnalysis => f !== null)}
      />

      <footer className="w-full p-4 text-center text-secondary/70 text-sm border-t border-border">
        Powered by Google Gemini
      </footer>
    </div>
  );
};

export default App;


================================================================================
FILE PATH: CLAUDE.md
================================================================================
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**FontPair AI** is an AI-powered font pairing critique and analysis tool built with React, TypeScript, and Vite. It uses Google's Gemini AI to analyze fonts from uploaded files, images, or Google Fonts, providing detailed typography insights including characteristics, usage recommendations, accessibility analysis, and professional font pairing suggestions with scoring and rationale.

## Development Commands

### Essential Commands
- **Install dependencies**: `npm install`
- **Start dev server**: `npm run dev` (runs on port 3000)
- **Build for production**: `npm run build`
- **Preview production build**: `npm run preview`

### Environment Setup
Before running the app, set `GEMINI_API_KEY` in `.env.local` at the project root. The Vite config (vite.config.ts:14-15) exposes this as both `process.env.API_KEY` and `process.env.GEMINI_API_KEY`.

## Architecture

### Core Application Flow

1. **Two-Column Comparison View** (App.tsx): The main interface displays two `AnalysisColumn` components side-by-side for comparing fonts. Users can also view shared analyses via URL hash.

2. **Font Input Methods** (AnalysisColumn.tsx):
   - **Upload Mode**: Accept font files (.ttf, .otf, .woff, .woff2) or images of text
   - **Google Fonts Mode**: Select from curated list of popular Google Fonts

3. **Analysis Pipeline** (AnalysisColumn.tsx:60-100):
   - Uses `html2canvas` to capture a visual snapshot of the `FontPreview` component
   - Converts canvas to base64 PNG image
   - For font files: extracts metadata (copyright, license, designer) using opentype.js parser
   - Sends image + metadata to Gemini AI via `geminiService.analyzeFont()`
   - Returns structured `FontAnalysis` object with 14 required fields

4. **AI Integration** (services/geminiService.ts):
   - Uses `@google/genai` SDK with `gemini-2.5-flash` model
   - Employs **structured output** with JSON schemas for predictable responses
   - Three main functions:
     - `analyzeFont()`: Font analysis with 14-field schema (types.ts:26-41)
     - `critiqueFontPairing()`: Compares two fonts with scoring (1-10)
     - `generateFunnySentence()`: Creates pangrams for font preview

### Key Architectural Patterns

**Structured AI Responses**: All Gemini API calls use `responseMimeType: 'application/json'` with explicit `responseSchema` definitions. Schemas use `Type.OBJECT`, `Type.STRING`, `Type.ARRAY`, etc. from `@google/genai` to ensure type-safe, predictable responses.

**Font Preview System**:
- `FontPreview` component renders text using either uploaded font files (via opentype.js) or Google Fonts (via dynamic stylesheet injection)
- Supports customizable background/text colors for better visualization
- For font files: parses with opentype.js to extract variable font axes and metadata
- Preview is captured as PNG before analysis to provide visual context to AI

**Shared Analysis**: Font analyses can be shared via URL hash containing base64-encoded JSON. The hash is parsed on mount (App.tsx:18-41) to display read-only shared results.

**Font Pairing Critique**: When both columns have analyses, a "Critique Pairing" button appears (App.tsx:97-109) that uses AI to evaluate the harmony between fonts.

### TypeScript Types (types.ts)

All AI responses conform to interfaces defined in types.ts:
- `FontAnalysis`: 14 fields including status, fontName, analysis, designer, historicalContext, accessibility, similarFonts, etc.
- `PairingCritique`: overallScore (1-10), analysis, pros[], cons[]
- `FontAccessibility`: analysis + specific notes array
- `SimilarFont`: name, source, rationale
- `FontPairing`: primary, secondary, rationale

### Service Layer

**geminiService.ts**: All AI interactions use structured schemas to enforce response format. Error handling wraps API calls with try/catch and throws descriptive errors.

**googleFontsService.ts**: Returns curated static list of 49 popular Google Fonts (sorted alphabetically). Could be extended to fetch from Google Fonts API.

**fontUtils.ts**: Provides descriptions for standard variable font axes (wght, wdth, slnt, ital, opsz).

**fileUtils.ts**: Converts File objects to base64 strings for API transmission.

## Component Structure

- **App.tsx**: Root component managing shared/comparison modes and font pairing critique
- **AnalysisColumn.tsx**: Main column logic including file upload, Google Fonts selection, preview rendering, and analysis triggering
- **AnalysisResult.tsx**: Displays formatted analysis with sections for each field
- **FontPreview.tsx**: Renders font preview with color customization; handles both file and Google Fonts rendering
- **FileUpload.tsx**: Drag-and-drop and click-to-upload interface
- **GoogleFontSearch.tsx**: Searchable dropdown for Google Fonts selection
- **PairingCritiqueModal.tsx**: Modal displaying font pairing critique results
- **Loader.tsx**: Loading spinner
- **Icons.tsx**: SVG icon components

## Critical Implementation Details

### License Information Handling
The AI is explicitly instructed (geminiService.ts:146-150) to:
- For font files: summarize license info from extracted metadata
- For images/web fonts: state "License information cannot be determined from an image or web font"
- Post-processing enforces this constraint (geminiService.ts:180-182)

### Font File Metadata Extraction
When analyzing font files (AnalysisColumn.tsx:78-84), the code extracts `copyright`, `license`, and `designer` from opentype.js parsed font names table and passes to AI as context.

### Variable Font Detection
The AI determines if a font is variable (`isVariable` boolean) based on visual analysis. For uploaded font files, opentype.js parses actual variable axes data displayed in the preview.

### html2canvas Dependency
The app relies on `html2canvas` loaded via CDN (check index.html). It's declared as `declare var html2canvas: any` in AnalysisColumn.tsx:11 to avoid TypeScript errors.

## Path Aliases

Both tsconfig.json and vite.config.ts define `@/*` as an alias to the project root (`./*`), allowing imports like `@/types` or `@/services/geminiService`.

## AI Studio Integration

This project was generated by Google AI Studio (https://ai.studio/apps/drive/1KkjXGcoHACEU3kUjB3sdn_KZ3kcD82px). The metadata.json file contains app description and permissions.


================================================================================
FILE PATH: components\AnalysisColumn.tsx
================================================================================
import React, { useState, useCallback, useRef } from 'react';
import { analyzeFont, generateFunnySentence } from '../services/geminiService';
import type { FontAnalysis } from '../types';
import FileUpload from './FileUpload';
import AnalysisResult from './AnalysisResult';
import Loader from './Loader';
import FontPreview from './FontPreview';
import { fileToBase64 } from '../utils/fileUtils';
import GoogleFontSearch from './GoogleFontSearch';
import { saveToHistory } from '../historyService';
import {
    generateFileCacheKey,
    generateGoogleFontCacheKey,
    generateImageCacheKey,
    getCachedAnalysis,
    setCachedAnalysis
} from '../utils/fontCache';

declare var html2canvas: any;

interface AnalysisColumnProps {
    analysisResult: FontAnalysis | null;
    onAnalysisComplete: (result: FontAnalysis | null) => void;
    isSharedView?: boolean;
    onPreviewCaptured?: (previewBase64: string) => void;
}

const AnalysisColumn: React.FC<AnalysisColumnProps> = ({ analysisResult, onAnalysisComplete, isSharedView = false, onPreviewCaptured }) => {
    const [mode, setMode] = useState<'upload' | 'google'>('upload');
    const [file, setFile] = useState<File | null>(null);
    const [googleFont, setGoogleFont] = useState<string>('');
    const [isLoading, setIsLoading] = useState<boolean>(false);
    const [error, setError] = useState<string | null>(null);
    const fontPreviewRef = useRef<HTMLDivElement>(null);
    const parsedFontRef = useRef<any>(null);
    const [previewImageBase64, setPreviewImageBase64] = useState<string | undefined>(undefined);
    const [isCachedResult, setIsCachedResult] = useState<boolean>(false);

    const [aiSentence, setAiSentence] = useState<string>("The quick brown fox jumps over the lazy dog.");
    const [isGeneratingSentence, setIsGeneratingSentence] = useState<boolean>(false);

    const [previewColors, setPreviewColors] = useState({ background: '#1A3431', text: '#EDF7F6' });

    const handleColorChange = (type: 'bg' | 'text', value: string) => {
        setPreviewColors(prev => ({ ...prev, [type === 'bg' ? 'background' : 'text']: value }));
    };

    const isFontFile = file?.type.includes('font') || file?.name.match(/\.(ttf|otf|woff|woff2)$/i);
    const canAnalyze = file || googleFont;

    const handleFileSelect = useCallback((selectedFile: File) => {
        onAnalysisComplete(null);
        setGoogleFont('');
        setFile(selectedFile);
        setError(null);
        if (selectedFile.name.match(/\.(ttf|otf|woff|woff2)$/i)) {
            setIsGeneratingSentence(true);
            generateFunnySentence().then(setAiSentence).finally(() => setIsGeneratingSentence(false));
        }
    }, [onAnalysisComplete]);
    
    const handleGoogleFontChange = useCallback((fontName: string) => {
        onAnalysisComplete(null);
        setFile(null);
        setGoogleFont(fontName);
        setError(null);
    }, [onAnalysisComplete]);

    const handleFontParsed = useCallback((font: any) => { parsedFontRef.current = font; }, []);

    const handleAnalyzeClick = async () => {
        if (!canAnalyze) return;

        setIsLoading(true);
        setError(null);
        onAnalysisComplete(null);
        setIsCachedResult(false);

        try {
            // Generate cache key based on mode
            let cacheKey: string | null = null;

            if (mode === 'google' && googleFont) {
                // For Google Fonts, use font name
                cacheKey = generateGoogleFontCacheKey(googleFont);
            } else if (mode === 'upload' && file) {
                // For uploaded files, use file name + content sample
                const { base64: fileContent } = await fileToBase64(file);
                if (file.type.startsWith('image/')) {
                    // For images, use image cache key
                    cacheKey = generateImageCacheKey(fileContent);
                } else {
                    // For font files, use file cache key
                    cacheKey = generateFileCacheKey(file.name, fileContent);
                }
            }

            // Check cache if we have a key
            if (cacheKey) {
                const cachedResult = getCachedAnalysis(cacheKey);
                if (cachedResult) {
                    console.log('âœ… Using cached analysis');
                    setIsCachedResult(true);
                    onAnalysisComplete(cachedResult);
                    setIsLoading(false);
                    return;
                }
            }

            // Not cached - proceed with analysis
            if (!fontPreviewRef.current) throw new Error("Preview element not found.");

            const canvas = await html2canvas(fontPreviewRef.current, { backgroundColor: previewColors.background });
            // Convert to JPEG with 0.85 quality for faster processing
            const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
            const base64 = dataUrl.split(',')[1];
            const mimeType = 'image/jpeg';

            // Save preview image for PDF export and glyph comparison
            setPreviewImageBase64(dataUrl);
            onPreviewCaptured?.(dataUrl);

            let fontMetadata: string | undefined = undefined;
            let fileName: string = 'font_preview.jpg';

            if (mode === 'upload' && isFontFile && parsedFontRef.current) {
                const font = parsedFontRef.current;
                const metadataParts: string[] = [];
                if (font.names.copyright?.en) metadataParts.push(`Copyright: ${font.names.copyright.en}`);
                if (font.names.license?.en) metadataParts.push(`License: ${font.names.license.en}`);
                if (font.names.designer?.en) metadataParts.push(`Designer: ${font.names.designer.en}`);
                fontMetadata = metadataParts.join(' | ');
                if(file) fileName = file.name;
            } else if (mode === 'upload' && file) {
                 fileName = file.name;
            } else if (mode === 'google' && googleFont) {
                 fileName = `${googleFont} (from Google Fonts)`;
            }

            const result = await analyzeFont(base64, mimeType, fileName, fontMetadata);

            // Determine font source based on current mode, file type, and AI analysis
            let fontSource: import('../types').FontSource = 'other';
            if (mode === 'google' && googleFont) {
                fontSource = 'google-fonts';
            } else if (mode === 'upload' && file) {
                if (file.type.startsWith('image/')) {
                    fontSource = 'image';
                } else if (isFontFile) {
                    // Comprehensive font source detection
                    const metadataLower = fontMetadata?.toLowerCase() || '';
                    const fileNameLower = file.name.toLowerCase();
                    const foundryLower = result.fontFoundry?.toLowerCase() || '';

                    // Check for various font sources based on metadata, filename, and foundry
                    if (metadataLower.includes('adobe') || fileNameLower.includes('adobe') || foundryLower.includes('adobe')) {
                        fontSource = 'adobe-fonts';
                    } else if (metadataLower.includes('indian type foundry') || foundryLower.includes('indian type foundry') || fileNameLower.includes('fontshare')) {
                        fontSource = 'fontshare';
                    } else if (metadataLower.includes('myfonts') || fileNameLower.includes('myfonts')) {
                        fontSource = 'myfonts';
                    } else if (metadataLower.includes('font squirrel') || fileNameLower.includes('fontsquirrel')) {
                        fontSource = 'font-squirrel';
                    } else if (metadataLower.includes('dafont') || fileNameLower.includes('dafont')) {
                        fontSource = 'dafont';
                    } else if (metadataLower.includes('fontesk') || fileNameLower.includes('fontesk')) {
                        fontSource = 'fontesk';
                    } else if (metadataLower.includes('velvetyne') || foundryLower.includes('velvetyne')) {
                        fontSource = 'velvetyne';
                    } else if (metadataLower.includes('league of moveable type') || foundryLower.includes('league of moveable type')) {
                        fontSource = 'league-of-moveable-type';
                    } else if (metadataLower.includes('northern block') || foundryLower.includes('northern block')) {
                        fontSource = 'the-northern-block';
                    } else if (metadataLower.includes('atipo') || foundryLower.includes('atipo')) {
                        fontSource = 'atipo';
                    } else if (metadataLower.includes('google') || foundryLower.includes('google')) {
                        fontSource = 'google-fonts';
                    } else {
                        fontSource = 'uploaded-file';
                    }
                }
            }

            // Add fontSource to result
            result.fontSource = fontSource;

            onAnalysisComplete(result);

            // Cache the result if we have a cache key and analysis was successful
            if (cacheKey && result.status === 'success') {
                setCachedAnalysis(cacheKey, result);
                console.log('ðŸ’¾ Cached analysis for future use');
            }

            // Save to history if analysis was successful
            if (result.status === 'success') {
                // Create thumbnail (200px wide)
                const thumbnailCanvas = document.createElement('canvas');
                const thumbnailWidth = 200;
                const thumbnailHeight = (canvas.height / canvas.width) * thumbnailWidth;
                thumbnailCanvas.width = thumbnailWidth;
                thumbnailCanvas.height = thumbnailHeight;
                const thumbnailCtx = thumbnailCanvas.getContext('2d');
                if (thumbnailCtx) {
                    thumbnailCtx.drawImage(canvas, 0, 0, thumbnailWidth, thumbnailHeight);
                    const thumbnailDataUrl = thumbnailCanvas.toDataURL('image/jpeg', 0.85);
                    saveToHistory(result, thumbnailDataUrl);
                }
            }
        } catch (err) {
            console.error(err);
            setError('An error occurred during analysis. Please try again.');
        } finally {
            setIsLoading(false);
        }
    };
  
    const resetState = () => {
        setFile(null);
        setGoogleFont('');
        onAnalysisComplete(null);
        setError(null);
        setIsLoading(false);
        setIsCachedResult(false);
        parsedFontRef.current = null;
    };

    const renderMainContent = () => {
        if (isLoading) return <div role="status" className="w-full flex justify-center items-center h-full min-h-96"><Loader /></div>;
        if (analysisResult) return <AnalysisResult result={analysisResult} onReset={resetState} isSharedView={isSharedView} previewImageBase64={previewImageBase64} isCached={isCachedResult} />;
        
        return (
            <div className="flex flex-col items-center justify-center h-full min-h-96">
                {!isSharedView && (
                    <div className="flex w-full justify-center mb-6 border-b border-border">
                        <button onClick={() => setMode('upload')} className={`px-6 py-2 text-sm font-semibold transition-colors ${mode === 'upload' ? 'text-accent border-b-2 border-accent' : 'text-secondary hover:text-text-dark'}`}>Upload File</button>
                        <button onClick={() => setMode('google')} className={`px-6 py-2 text-sm font-semibold transition-colors ${mode === 'google' ? 'text-accent border-b-2 border-accent' : 'text-secondary hover:text-text-dark'}`}>Google Font</button>
                    </div>
                )}
                
                {mode === 'upload' ? (
                     <FileUpload onFileSelect={handleFileSelect} file={file} />
                ) : (
                     <GoogleFontSearch value={googleFont} onChange={handleGoogleFontChange} />
                )}

                <div className="mt-6 flex justify-center">
                    <button onClick={handleAnalyzeClick} disabled={!canAnalyze || isLoading} className="px-8 py-3 bg-accent text-surface font-bold rounded-lg hover:opacity-90 disabled:bg-secondary disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-opacity-75">
                        {isLoading ? 'Analyzing...' : 'Analyze Font'}
                    </button>
                </div>
                {error && <div role="alert" aria-live="assertive" className="mt-4 text-center text-text-light bg-danger/80 p-4 rounded-lg w-full">{error}</div>}
            </div>
        );
    }
  
    const renderPreviewContent = () => {
        if (mode === 'upload' && file?.type.startsWith('image/')) {
            return (
                <div className="w-full h-full p-4 border border-dashed border-border rounded-lg bg-background/50 flex flex-col justify-center items-center">
                    <h3 className="font-semibold text-text-dark mb-2 self-start">Image Preview</h3>
                    <img src={URL.createObjectURL(file)} alt="Font preview" className="max-w-full max-h-96 rounded-md object-contain mx-auto" />
                </div>
            );
        }
        
        if (canAnalyze || analysisResult) {
            return <FontPreview 
                ref={!analysisResult ? fontPreviewRef : null} 
                file={file}
                googleFontName={googleFont}
                initialSentence={aiSentence} 
                isGeneratingSentence={isGeneratingSentence} 
                onFontParsed={handleFontParsed}
                backgroundColor={previewColors.background}
                textColor={previewColors.text}
                onColorChange={handleColorChange}
            />;
        }

        return (
            <div className="w-full h-full p-4 border border-dashed border-border rounded-lg flex flex-col items-center justify-center text-center bg-background/50 min-h-96">
                <h3 className="font-semibold text-text-dark mb-2">Preview</h3>
                <p className="text-text-secondary">Your font or image preview will appear here.</p>
            </div>
        );
    }

    const showPreview = canAnalyze || analysisResult;

    return (
        <div className="flex flex-col gap-8 w-full">
            <div className="teal-card-raised p-6 w-full flex flex-col justify-center">
                {renderMainContent()}
            </div>
            {showPreview && (
                <div className="teal-card-raised p-6 w-full">
                    {renderPreviewContent()}
                </div>
            )}
        </div>
    );
};

export default AnalysisColumn;


================================================================================
FILE PATH: components\AnalysisResult.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import { createPortal } from 'react-dom';
import type { FontAnalysis } from '../types';
import { CheckIcon, InfoIcon, BusinessIcon, UsageIcon, WeightIcon, LicenseIcon, PairingIcon, AccessibilityIcon, SimilarFontsIcon, VariableFontIcon, ShareIcon, ExportIcon, CopyIcon, ExternalLinkIcon, HistoryIcon } from './Icons';
import { exportAnalysisToPDF } from '../pdfExportService';
import FontSourceBadge from './FontSourceBadge';
import FontDNAModal from './FontDNAModal';
import TypographyContextModal from './TypographyContextModal';

interface AnalysisResultProps {
  result: FontAnalysis;
  onReset: () => void;
  isSharedView?: boolean;
  previewImageBase64?: string;
  isCached?: boolean;
}

const InfoCard: React.FC<{ title: string; children: React.ReactNode; icon: React.ReactNode }> = ({ title, children, icon }) => (
    <div className="teal-card-raised rounded-lg p-4">
        <div className="flex items-center mb-3">
            {icon}
            <h3 className="text-lg font-semibold text-accent">{title}</h3>
        </div>
        {children}
    </div>
);


const AnalysisResult: React.FC<AnalysisResultProps> = ({ result, onReset, isSharedView = false, previewImageBase64, isCached = false }) => {
    const [showExportModal, setShowExportModal] = useState(false);
    const [exportFormat, setExportFormat] = useState('css');
    const [shareUrl, setShareUrl] = useState('');
    const [copied, setCopied] = useState(false);
    const [loadedGoogleFonts, setLoadedGoogleFonts] = useState<Set<string>>(new Set());
    const [isExportingPDF, setIsExportingPDF] = useState(false);
    const [pdfError, setPdfError] = useState<string | null>(null);
    const [showFontDNAModal, setShowFontDNAModal] = useState(false);
    const [showContextModal, setShowContextModal] = useState(false);

    const loadGoogleFont = (fontName: string) => {
        if (!fontName || loadedGoogleFonts.has(fontName)) return;
        const fontUrl = `https://fonts.googleapis.com/css2?family=${fontName.replace(/ /g, '+')}:wght@400;700&display=swap`;
        if (document.querySelector(`link[href="${fontUrl}"]`)) return;

        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = fontUrl;
        document.head.appendChild(link);
        setLoadedGoogleFonts(prev => new Set(prev).add(fontName));
    };

    useEffect(() => {
        result.fontPairings?.forEach(p => loadGoogleFont(p.secondary));
        result.similarFonts?.forEach(f => {
            if (f.source.toLowerCase().includes('google')) {
                loadGoogleFont(f.name);
            }
        });
    }, [result.fontPairings, result.similarFonts]);
    
    const handleShare = () => {
        const jsonString = JSON.stringify(result);
        const encodedData = btoa(jsonString);
        const url = `${window.location.origin}${window.location.pathname}#${encodedData}`;
        setShareUrl(url);
    };

    const handleCopyToClipboard = (textToCopy: string) => {
        navigator.clipboard.writeText(textToCopy).then(() => {
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
        });
    };

    const handleExportPDF = async () => {
        setIsExportingPDF(true);
        setPdfError(null);
        try {
            await exportAnalysisToPDF(result, previewImageBase64);
        } catch (error) {
            console.error('Failed to export PDF:', error);
            const errorMessage = error instanceof Error ? error.message : 'Failed to export PDF. Please try again.';
            setPdfError(errorMessage);
            // Auto-hide error after 5 seconds
            setTimeout(() => setPdfError(null), 5000);
        } finally {
            setIsExportingPDF(false);
        }
    };

    const generateTokens = () => {
        const fontNameSlug = result.fontName.toLowerCase().replace(/\s+/g, '-');
        if (exportFormat === 'css') {
            return `
:root {
  --font-family-${fontNameSlug}: "${result.fontName}", sans-serif;
  /* Recommended Weights */
  ${result.weightRecommendations.map(w => `--font-weight-${fontNameSlug}-${w.split(' ')[0].toLowerCase()}: ${w.match(/\d+/)?.[0] || '400'}`).join(';\n  ')};
}
        `.trim();
        }
        if (exportFormat === 'json') {
            return JSON.stringify({
                [fontNameSlug]: {
                    family: `"${result.fontName}", sans-serif`,
                    weights: result.weightRecommendations.reduce((acc, w) => {
                        acc[w.split(' ')[0].toLowerCase()] = parseInt(w.match(/\d+/)?.[0] || '400', 10);
                        return acc;
                    }, {} as Record<string, number>),
                }
            }, null, 2);
        }
        return '';
    };

    if (result.status === 'not_enough_data') {
        return (
            <div className="text-center p-8 bg-surface rounded-lg border border-border">
                <h2 className="text-2xl font-bold text-accent mb-4">Not Enough Data</h2>
                <p className="text-secondary mb-6">The AI could not confidently analyze the provided file. This can happen with low-resolution images or images with very few characters. Please try a different file.</p>
                <button onClick={onReset} className="px-6 py-2 bg-accent text-surface font-bold rounded-lg hover:opacity-90 transition-opacity">Try Again</button>
            </div>
        );
    }

    return (
        <div className="animate-fade-in space-y-6">
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 p-4 bg-surface rounded-lg border-border">
                <div>
                    <div className="flex items-center gap-2 flex-wrap mb-2">
                         <h2 className="text-3xl font-bold text-primary">{result.fontName}</h2>
                         {result.isVariable && <VariableFontIcon aria-label="Variable Font" title="Variable Font" className="w-6 h-6 text-accent"/>}
                         {isCached && (
                            <span className="inline-flex items-center gap-1 bg-green-500/20 text-green-400 text-xs font-semibold px-2 py-1 rounded-full border border-green-500/30">
                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                                Instant (Cached)
                            </span>
                         )}
                    </div>
                     <p className="text-accent text-lg mb-2">{result.fontType}</p>
                     {result.designer && result.designer.toLowerCase() !== 'unknown designer' && (
                        <p className="text-secondary text-sm mb-2">by {result.designer}</p>
                     )}
                     {result.fontSource && <FontSourceBadge fontSource={result.fontSource} fontFoundry={result.fontFoundry} />}
                </div>
                <div className="flex flex-col gap-2">
                    <div className="flex items-center gap-2 flex-wrap">
                        <button
                            onClick={handleExportPDF}
                            disabled={isExportingPDF}
                            className="px-4 py-2 text-sm bg-accent text-surface font-bold rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2"
                        >
                            <ExportIcon className="w-4 h-4" />
                            {isExportingPDF ? 'Exporting...' : 'Export PDF'}
                        </button>
                        <button
                            onClick={() => setShowFontDNAModal(true)}
                            className="px-4 py-2 text-sm bg-accent/80 text-surface font-bold rounded-lg hover:bg-accent transition-colors flex items-center gap-2"
                            title="Find fonts with similar visual DNA"
                        >
                            <SimilarFontsIcon className="w-4 h-4" />
                            Find Similar
                        </button>
                        <button
                            onClick={() => setShowContextModal(true)}
                            className="px-4 py-2 text-sm bg-teal-medium text-text-light font-bold rounded-lg hover:bg-teal-dark transition-colors flex items-center gap-2"
                            title="View typography trends and historical context"
                        >
                            <HistoryIcon className="w-4 h-4" />
                            See Context
                        </button>
                        <button onClick={() => setShowExportModal(true)} className="px-4 py-2 text-sm bg-secondary/30 text-primary font-semibold rounded-lg hover:bg-secondary/50 transition-colors flex items-center gap-2"><ExportIcon className="w-4 h-4" />Design Tokens</button>
                        <button onClick={handleShare} className="px-4 py-2 text-sm bg-secondary/30 text-primary font-semibold rounded-lg hover:bg-secondary/50 transition-colors flex items-center gap-2"><ShareIcon className="w-4 h-4" />Share</button>
                        {!isSharedView && <button onClick={onReset} className="px-6 py-2 bg-secondary/50 text-primary font-semibold rounded-lg hover:bg-secondary/70 transition-colors">Analyze Another</button>}
                    </div>
                    {pdfError && (
                        <div className="bg-red-500/10 border border-red-500/20 rounded-md p-3">
                            <p className="text-sm text-red-300">{pdfError}</p>
                        </div>
                    )}
                </div>
            </div>
          
            <InfoCard title="Analysis" icon={<InfoIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                <p className="text-text-light leading-normal">{result.analysis}</p>
            </InfoCard>

            {result.historicalContext && (
            <InfoCard title="Historical Context" icon={<HistoryIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                <p className="text-text-light leading-normal text-sm">{result.historicalContext}</p>
            </InfoCard>
            )}

            <InfoCard title="Accessibility & Legibility" icon={<AccessibilityIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                 <p className="text-text-light leading-normal mb-3">{result.accessibility.analysis}</p>
                 <ul className="space-y-2">
                    {result.accessibility.notes.map((note, index) => (
                        <li key={index} className="flex items-start">
                            <CheckIcon aria-hidden="true" className="w-5 h-5 mr-2 mt-0.5 text-accent flex-shrink-0" />
                            <span className="text-text-light">{note}</span>
                        </li>
                    ))}
                 </ul>
            </InfoCard>
            
            {result.fontPairings && result.fontPairings.length > 0 && (
            <InfoCard title="Font Pairing Suggestions" icon={<PairingIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                <div className="space-y-4">
                    {result.fontPairings.map((pairing, index) => {
                        const googleFontUrl = `https://fonts.google.com/specimen/${pairing.secondary.replace(/ /g, '+')}`;
                        return (
                            <div key={index} className="border-t border-border pt-4 first:pt-0 first:border-none">
                                <div className="p-4 rounded-lg bg-paper-light mb-3 border border-text-secondary/20">
                                     <a href={googleFontUrl} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-2 group">
                                        <h4 style={{fontFamily: `'${pairing.secondary}', sans-serif`}} className="text-3xl font-bold text-text-dark leading-tight group-hover:underline">{pairing.secondary}</h4>
                                        <ExternalLinkIcon className="w-5 h-5 text-secondary/70 group-hover:text-accent transition-colors" />
                                    </a>
                                    <p style={{fontFamily: `'${pairing.secondary}', sans-serif`}} className="text-base text-secondary mt-2">The quick brown fox jumps over the lazy dog.</p>
                                </div>
                                <p className="text-text-light text-sm leading-relaxed">{pairing.rationale}</p>
                            </div>
                        )
                    })}
                </div>
            </InfoCard>
            )}

            {result.similarFonts && result.similarFonts.length > 0 && (
            <InfoCard title="Similar Font Alternatives" icon={<SimilarFontsIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                <div className="space-y-4">
                    {result.similarFonts.map((font, index) => {
                        const isGoogleFont = font.source.toLowerCase().includes('google');
                        const googleFontUrl = isGoogleFont ? `https://fonts.google.com/specimen/${font.name.replace(/ /g, '+')}` : undefined;

                        return (
                            <div key={index} className="border-t border-border pt-4 first:pt-0 first:border-none">
                                <div className="flex justify-between items-baseline">
                                    {isGoogleFont ? (
                                        <a href={googleFontUrl} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-2 group">
                                            <h4 style={{ fontFamily: `'${font.name}', sans-serif` }} className="font-semibold text-primary group-hover:underline">{font.name}</h4>
                                            <ExternalLinkIcon className="w-4 h-4 text-secondary/70 group-hover:text-accent transition-colors" />
                                        </a>
                                    ) : (
                                        <h4 className="font-semibold text-primary">{font.name}</h4>
                                    )}
                                    <span className="text-xs text-secondary bg-surface px-2 py-1 rounded">{font.source}</span>
                                </div>
                                <p className="text-text-light text-sm leading-relaxed mt-1">{font.rationale}</p>
                            </div>
                        )
                    })}
                </div>
            </InfoCard>
            )}

            <div className="grid md:grid-cols-2 gap-6">
                <InfoCard title="Recommended Usage" icon={<UsageIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                    <ul className="space-y-2">{result.usageRecommendations.map((rec, index) => (<li key={index} className="flex items-start"><CheckIcon aria-hidden="true" className="w-5 h-5 mr-2 mt-0.5 text-accent flex-shrink-0" /><span className="text-text-light">{rec}</span></li>))}</ul>
                </InfoCard>
                <InfoCard title="Weight Recommendations" icon={<WeightIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                    <ul className="space-y-2">{result.weightRecommendations.map((rec, index) => (<li key={index} className="flex items-start"><CheckIcon aria-hidden="true" className="w-5 h-5 mr-2 mt-0.5 text-accent flex-shrink-0" /><span className="text-text-light">{rec}</span></li>))}</ul>
                </InfoCard>
            </div>

            {result.licenseInfo && (<InfoCard title="License & Usage Information" icon={<LicenseIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                <p className="text-text-light leading-normal text-sm">{result.licenseInfo}</p>
                {result.licensingNotes && (
                    <div className="mt-3 pt-3 border-t border-border">
                        <p className="text-accent font-semibold text-sm mb-1">Commercial Usage Notes:</p>
                        <p className="text-text-light leading-normal text-sm">{result.licensingNotes}</p>
                    </div>
                )}
            </InfoCard>)}

            {/* Character Set Support */}
            {result.characterSets && result.characterSets.length > 0 && (
                <InfoCard title="Character Set Support" icon={
                    <svg className="w-6 h-6 mr-2 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                }>
                    <div className="flex flex-wrap gap-2">
                        {result.characterSets.map((charset, index) => (
                            <span key={index} className="bg-teal-medium/30 text-text-light text-sm font-medium px-3 py-1.5 rounded-full">
                                {charset}
                            </span>
                        ))}
                    </div>
                </InfoCard>
            )}

            {/* Release Year */}
            {result.releaseYear && result.releaseYear.toLowerCase() !== 'unknown' && (
                <div className="text-center text-secondary text-sm py-2">
                    Originally released: <span className="font-semibold text-accent">{result.releaseYear}</span>
                </div>
            )}

            <InfoCard title="Business Suitability" icon={<BusinessIcon aria-hidden="true" className="w-6 h-6 mr-2 text-accent" />}>
                <div className="flex flex-wrap gap-2">{result.businessSuitability.map((biz, index) => (<span key={index} className="bg-accent/20 text-accent text-sm font-medium px-4 py-2 rounded-full">{biz}</span>))}</div>
            </InfoCard>
            
            {shareUrl && createPortal(
                 <div className="fixed inset-0 bg-black/60 flex items-start justify-center z-[9999] animate-fade-in p-4 pt-8 overflow-y-auto" onClick={() => setShareUrl('')}>
                    <div className="bg-surface rounded-lg p-6 w-full max-w-lg border border-border shadow-2xl my-4" onClick={e => e.stopPropagation()}>
                        <h3 className="text-xl font-bold mb-4 text-primary">Share Analysis</h3>
                        <p className="text-secondary mb-4 text-sm">Copy this link to share a read-only version of this report.</p>
                        <div className="flex items-center gap-2">
                           <input type="text" readOnly value={shareUrl} className="w-full bg-background border border-border rounded-md p-2 text-text-dark text-sm truncate"/>
                           <button onClick={() => handleCopyToClipboard(shareUrl)} className={`px-4 py-2 text-sm font-semibold rounded-lg transition-colors flex items-center gap-2 ${copied ? 'bg-green-500 text-primary' : 'bg-accent text-surface'}`}>
                               <CopyIcon className="w-4 h-4"/> {copied ? 'Copied!' : 'Copy'}
                           </button>
                        </div>
                    </div>
                </div>,
                document.body
            )}
             {showExportModal && createPortal(
                 <div className="fixed inset-0 bg-black/60 flex items-start justify-center z-[9999] animate-fade-in p-4 pt-8 overflow-y-auto" onClick={() => setShowExportModal(false)}>
                    <div className="bg-surface rounded-lg p-6 w-full max-w-lg border border-border shadow-2xl my-4" onClick={e => e.stopPropagation()}>
                        <h3 className="text-xl font-bold mb-4 text-primary">Export Design Tokens</h3>
                        <div className="flex gap-2 mb-4 border border-border bg-background/50 p-1 rounded-lg">
                            <button onClick={() => setExportFormat('css')} className={`w-full rounded-md py-1 text-sm font-semibold ${exportFormat === 'css' ? 'bg-accent text-surface' : 'text-secondary hover:bg-border'}`}>CSS</button>
                            <button onClick={() => setExportFormat('json')} className={`w-full rounded-md py-1 text-sm font-semibold ${exportFormat === 'json' ? 'bg-accent text-surface' : 'text-secondary hover:bg-border'}`}>JSON</button>
                        </div>
                        <div className="relative">
                            <pre className="bg-background text-primary/80 p-4 rounded-md text-xs overflow-x-auto"><code className="whitespace-pre-wrap">{generateTokens()}</code></pre>
                            <button onClick={() => handleCopyToClipboard(generateTokens())} className={`absolute top-2 right-2 p-2 rounded-lg transition-colors ${copied ? 'bg-green-500 text-primary' : 'bg-border text-primary hover:bg-accent hover:text-surface'}`} aria-label="Copy to clipboard">
                                {copied ? <CheckIcon className="w-4 h-4"/> : <CopyIcon className="w-4 h-4"/>}
                            </button>
                        </div>
                    </div>
                </div>,
                document.body
            )}

            {/* Font DNA Modal */}
            <FontDNAModal
                isOpen={showFontDNAModal}
                onClose={() => setShowFontDNAModal(false)}
                referenceFont={result}
            />

            {/* Typography Context Modal */}
            <TypographyContextModal
                isOpen={showContextModal}
                onClose={() => setShowContextModal(false)}
                fontAnalysis={result}
            />
        </div>
    );
};

export default AnalysisResult;


================================================================================
FILE PATH: components\BatchCompatibilityMatrix.tsx
================================================================================
import React, { useState } from 'react';
import type { FontAnalysis, BatchCompatibilityResult, PairingScore } from '../types';
import { analyzeBatchCompatibility } from '../services/geminiService';
import Loader from './Loader';

interface BatchCompatibilityMatrixProps {
    isOpen: boolean;
    onClose: () => void;
    availableFonts: FontAnalysis[];
}

const BatchCompatibilityMatrix: React.FC<BatchCompatibilityMatrixProps> = ({
    isOpen,
    onClose,
    availableFonts
}) => {
    const [selectedFonts, setSelectedFonts] = useState<FontAnalysis[]>([]);
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState<string | null>(null);
    const [result, setResult] = useState<BatchCompatibilityResult | null>(null);

    const handleAddFont = (font: FontAnalysis) => {
        if (selectedFonts.length >= 8) {
            setError('Maximum 8 fonts can be analyzed at once');
            return;
        }
        if (!selectedFonts.find(f => f.fontName === font.fontName)) {
            setSelectedFonts([...selectedFonts, font]);
            setError(null);
        }
    };

    const handleRemoveFont = (fontName: string) => {
        setSelectedFonts(selectedFonts.filter(f => f.fontName !== fontName));
        setResult(null);
    };

    const handleAnalyze = async () => {
        if (selectedFonts.length < 2) {
            setError('Select at least 2 fonts to analyze compatibility');
            return;
        }

        setIsLoading(true);
        setError(null);

        try {
            const compatibilityResult = await analyzeBatchCompatibility(selectedFonts);
            setResult(compatibilityResult);
        } catch (err) {
            console.error('Batch compatibility error:', err);
            setError(err instanceof Error ? err.message : 'Failed to analyze compatibility');
        } finally {
            setIsLoading(false);
        }
    };

    const handleReset = () => {
        setSelectedFonts([]);
        setResult(null);
        setError(null);
    };

    const getScoreColor = (score: number): string => {
        if (score >= 8) return 'bg-green-500';
        if (score >= 6) return 'bg-teal-500';
        if (score >= 4) return 'bg-yellow-500';
        return 'bg-red-500';
    };

    const getScoreTextColor = (score: number): string => {
        if (score >= 8) return 'text-green-400';
        if (score >= 6) return 'text-teal-400';
        if (score >= 4) return 'text-yellow-400';
        return 'text-red-400';
    };

    const findPairingScore = (font1: string, font2: string): PairingScore | undefined => {
        if (!result) return undefined;
        return result.pairings.find(
            p => (p.font1 === font1 && p.font2 === font2) ||
                 (p.font1 === font2 && p.font2 === font1)
        );
    };

    if (!isOpen) return null;

    return (
        <div
            className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-fade-in p-4"
            onClick={onClose}
        >
            <div
                className="bg-surface rounded-lg w-full max-w-5xl max-h-[90vh] overflow-hidden border border-border shadow-2xl flex flex-col"
                onClick={e => e.stopPropagation()}
            >
                {/* Header */}
                <div className="p-6 border-b border-border flex-shrink-0">
                    <div className="flex items-center justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-primary">Batch Compatibility Matrix</h2>
                            <p className="text-secondary text-sm mt-1">
                                Analyze how well multiple fonts work together
                            </p>
                        </div>
                        <button
                            onClick={onClose}
                            className="text-secondary hover:text-primary transition-colors p-2"
                            aria-label="Close modal"
                        >
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                {/* Content */}
                <div className="flex-1 overflow-y-auto p-6">
                    {!result ? (
                        <div className="space-y-6">
                            {/* Font Selection */}
                            <div>
                                <h3 className="text-lg font-semibold text-primary mb-3">
                                    Select Fonts to Compare ({selectedFonts.length}/8)
                                </h3>

                                {/* Available Fonts */}
                                {availableFonts.length > 0 ? (
                                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-4">
                                        {availableFonts.map(font => {
                                            const isSelected = selectedFonts.some(f => f.fontName === font.fontName);
                                            return (
                                                <button
                                                    key={font.fontName}
                                                    onClick={() => isSelected ? handleRemoveFont(font.fontName) : handleAddFont(font)}
                                                    className={`p-3 rounded-lg border text-left transition-all ${
                                                        isSelected
                                                            ? 'border-accent bg-accent/20 text-primary'
                                                            : 'border-border bg-teal-dark/50 text-secondary hover:border-accent/50 hover:text-primary'
                                                    }`}
                                                >
                                                    <div className="font-medium truncate">{font.fontName}</div>
                                                    <div className="text-xs opacity-70">{font.fontType}</div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                ) : (
                                    <div className="bg-teal-dark/50 rounded-lg p-6 text-center border border-border">
                                        <p className="text-secondary mb-2">No fonts analyzed yet</p>
                                        <p className="text-sm text-secondary/70">
                                            Analyze fonts in the main view first, then return here to compare them
                                        </p>
                                    </div>
                                )}

                                {/* Selected Fonts Preview */}
                                {selectedFonts.length > 0 && (
                                    <div className="mt-4">
                                        <p className="text-sm text-secondary mb-2">Selected fonts:</p>
                                        <div className="flex flex-wrap gap-2">
                                            {selectedFonts.map(font => (
                                                <span
                                                    key={font.fontName}
                                                    className="bg-accent/20 text-accent text-sm font-medium px-3 py-1.5 rounded-full flex items-center gap-2"
                                                >
                                                    {font.fontName}
                                                    <button
                                                        onClick={() => handleRemoveFont(font.fontName)}
                                                        className="hover:text-red-400 transition-colors"
                                                    >
                                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                                        </svg>
                                                    </button>
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {error && (
                                <div className="bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-center">
                                    <p className="text-red-300">{error}</p>
                                </div>
                            )}

                            {/* Analyze Button */}
                            <div className="flex justify-center">
                                <button
                                    onClick={handleAnalyze}
                                    disabled={selectedFonts.length < 2 || isLoading}
                                    className="px-6 py-3 bg-accent text-surface font-semibold rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isLoading ? (
                                        <span className="flex items-center gap-2">
                                            <Loader />
                                            Analyzing...
                                        </span>
                                    ) : (
                                        `Analyze ${selectedFonts.length} Font${selectedFonts.length !== 1 ? 's' : ''}`
                                    )}
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="space-y-6">
                            {/* Matrix View */}
                            <div>
                                <h3 className="text-lg font-semibold text-primary mb-3">Compatibility Matrix</h3>
                                <div className="overflow-x-auto">
                                    <table className="w-full border-collapse">
                                        <thead>
                                            <tr>
                                                <th className="p-2 text-left text-secondary text-sm border-b border-border"></th>
                                                {result.fonts.map(font => (
                                                    <th key={font} className="p-2 text-center text-secondary text-sm border-b border-border whitespace-nowrap">
                                                        <div className="transform -rotate-45 origin-center h-20 flex items-end justify-center">
                                                            <span className="truncate max-w-[80px]">{font}</span>
                                                        </div>
                                                    </th>
                                                ))}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {result.fonts.map((font1, i) => (
                                                <tr key={font1}>
                                                    <td className="p-2 text-secondary text-sm border-r border-border whitespace-nowrap">
                                                        {font1}
                                                    </td>
                                                    {result.fonts.map((font2, j) => {
                                                        if (i === j) {
                                                            return (
                                                                <td key={font2} className="p-2 text-center bg-teal-dark/30">
                                                                    <span className="text-secondary">-</span>
                                                                </td>
                                                            );
                                                        }
                                                        const pairing = findPairingScore(font1, font2);
                                                        return (
                                                            <td
                                                                key={font2}
                                                                className="p-2 text-center cursor-pointer hover:bg-teal-dark/50 transition-colors"
                                                                title={pairing?.quickNote || ''}
                                                            >
                                                                {pairing && (
                                                                    <span className={`inline-block w-8 h-8 rounded-full ${getScoreColor(pairing.score)} flex items-center justify-center text-surface font-bold text-sm`}>
                                                                        {pairing.score}
                                                                    </span>
                                                                )}
                                                            </td>
                                                        );
                                                    })}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            {/* Top Pairings */}
                            <div className="bg-green-500/10 rounded-lg p-4 border border-green-500/30">
                                <h3 className="text-lg font-semibold text-green-400 mb-3 flex items-center gap-2">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                    </svg>
                                    Best Pairings
                                </h3>
                                <div className="space-y-3">
                                    {result.topPairings.map((pairing, index) => (
                                        <div key={index} className="flex items-start gap-3">
                                            <span className={`${getScoreTextColor(pairing.score)} font-bold text-lg min-w-[2rem]`}>
                                                {pairing.score}
                                            </span>
                                            <div>
                                                <div className="text-primary font-medium">
                                                    {pairing.font1} + {pairing.font2}
                                                </div>
                                                <p className="text-sm text-secondary">{pairing.quickNote}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Worst Pairings */}
                            <div className="bg-red-500/10 rounded-lg p-4 border border-red-500/30">
                                <h3 className="text-lg font-semibold text-red-400 mb-3 flex items-center gap-2">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    Avoid These Pairings
                                </h3>
                                <div className="space-y-3">
                                    {result.worstPairings.map((pairing, index) => (
                                        <div key={index} className="flex items-start gap-3">
                                            <span className={`${getScoreTextColor(pairing.score)} font-bold text-lg min-w-[2rem]`}>
                                                {pairing.score}
                                            </span>
                                            <div>
                                                <div className="text-primary font-medium">
                                                    {pairing.font1} + {pairing.font2}
                                                </div>
                                                <p className="text-sm text-secondary">{pairing.quickNote}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Overall Notes */}
                            <div className="bg-teal-dark/50 rounded-lg p-4 border border-teal-medium">
                                <h3 className="text-lg font-semibold text-accent mb-3 flex items-center gap-2">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    Overall Assessment
                                </h3>
                                <p className="text-text-light leading-relaxed">{result.overallNotes}</p>
                            </div>

                            {/* Reset Button */}
                            <div className="flex justify-center">
                                <button
                                    onClick={handleReset}
                                    className="px-6 py-3 bg-teal-medium text-primary font-semibold rounded-lg hover:bg-teal-dark transition-colors"
                                >
                                    Analyze Different Fonts
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
};

export default BatchCompatibilityMatrix;


================================================================================
FILE PATH: components\CategorySelector.tsx
================================================================================
import React from 'react';

interface CategorySelectorProps {
    title: string;
    categories: string[];
    selected: string[];
    onChange: (selected: string[]) => void;
}

const CategorySelector: React.FC<CategorySelectorProps> = ({ title, categories, selected, onChange }) => {
    const toggleCategory = (category: string) => {
        if (selected.includes(category)) {
            onChange(selected.filter(c => c !== category));
        } else {
            onChange([...selected, category]);
        }
    };

    return (
        <div className="mb-6">
            <label className="block text-sm font-medium text-primary mb-3">
                {title}
            </label>
            <div className="flex flex-wrap gap-2">
                {categories.map(category => {
                    const isSelected = selected.includes(category);
                    return (
                        <button
                            key={category}
                            type="button"
                            onClick={() => toggleCategory(category)}
                            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${
                                isSelected
                                    ? 'bg-accent text-surface'
                                    : 'bg-surface text-secondary border border-border hover:border-accent hover:text-accent'
                            }`}
                        >
                            {category}
                        </button>
                    );
                })}
            </div>
        </div>
    );
};

export default CategorySelector;


================================================================================
FILE PATH: components\FileUpload.tsx
================================================================================
import React, { useCallback, useState } from 'react';
import { UploadIcon } from './Icons';

interface FileUploadProps {
  onFileSelect: (file: File) => void;
  file: File | null;
}

const acceptedTypes = ".png, .jpg, .jpeg, .webp, .ttf, .otf, .woff, .woff2";

const FileUpload: React.FC<FileUploadProps> = ({ onFileSelect, file }) => {
  const [isDragging, setIsDragging] = useState(false);
  const fileInputRef = React.useRef<HTMLInputElement>(null);

  const handleDragEnter = (e: React.DragEvent<HTMLLabelElement>) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(true);
  };

  const handleDragLeave = (e: React.DragEvent<HTMLLabelElement>) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);
  };

  const handleDragOver = (e: React.DragEvent<HTMLLabelElement>) => {
    e.preventDefault();
    e.stopPropagation();
  };

  const handleDrop = (e: React.DragEvent<HTMLLabelElement>) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);

    const files = e.dataTransfer.files;
    if (files && files.length > 0) {
      onFileSelect(files[0]);
    }
  };

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files;
    if (files && files.length > 0) {
      onFileSelect(files[0]);
    }
  };
  
  const handleKeyDown = (e: React.KeyboardEvent<HTMLLabelElement>) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      fileInputRef.current?.click();
    }
  };

  return (
    <div className="w-full">
      <label
        htmlFor="file-upload"
        tabIndex={0}
        className={`relative flex flex-col items-center justify-center w-full min-h-40 p-4 rounded-lg cursor-pointer transition-all duration-300 paper-upload-box ${isDragging ? 'border-accent' : ''} focus:outline-none focus-visible:ring-2 focus-visible:ring-accent`}
        onDragEnter={handleDragEnter}
        onDragLeave={handleDragLeave}
        onDragOver={handleDragOver}
        onDrop={handleDrop}
        onKeyDown={handleKeyDown}
      >
        <div className="flex flex-col items-center justify-center p-6 text-center">
            <UploadIcon className="w-10 h-10 mb-4 text-text-secondary opacity-60" />
            <p className="mb-2 text-sm text-text-dark">
            <span className="font-semibold text-accent">Click to upload</span>, drag and drop, or paste an image
            </p>
            <p className="text-xs text-text-secondary">Font files or images (PNG, JPG)</p>
        </div>
        <input ref={fileInputRef} id="file-upload" type="file" className="hidden" accept={acceptedTypes} onChange={handleFileChange} />
        {file && (
             <div className="absolute bottom-2 left-2 right-2 bg-teal-dark/90 backdrop-blur-sm p-2 rounded-md text-center text-xs text-accent truncate border border-teal-medium">
                {file.name}
            </div>
        )}
      </label>
    </div>
  );
};

export default FileUpload;


================================================================================
FILE PATH: components\FontDNAModal.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import { createPortal } from 'react-dom';
import type { FontAnalysis, FontDNAResult, FontDNAMatch } from '../types';
import { findSimilarFonts } from '../services/geminiService';
import { ExternalLinkIcon, CopyIcon, CheckIcon } from './Icons';
import Loader from './Loader';

interface FontDNAModalProps {
    isOpen: boolean;
    onClose: () => void;
    referenceFont: FontAnalysis;
}

const FontDNAModal: React.FC<FontDNAModalProps> = ({ isOpen, onClose, referenceFont }) => {
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState<string | null>(null);
    const [result, setResult] = useState<FontDNAResult | null>(null);
    const [loadedGoogleFonts, setLoadedGoogleFonts] = useState<Set<string>>(new Set());
    const [copiedIndex, setCopiedIndex] = useState<number | null>(null);

    const loadGoogleFont = (fontName: string) => {
        if (!fontName || loadedGoogleFonts.has(fontName)) return;
        const fontUrl = `https://fonts.googleapis.com/css2?family=${fontName.replace(/ /g, '+')}:wght@400;700&display=swap`;
        if (document.querySelector(`link[href="${fontUrl}"]`)) return;

        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = fontUrl;
        document.head.appendChild(link);
        setLoadedGoogleFonts(prev => new Set(prev).add(fontName));
    };

    useEffect(() => {
        if (isOpen && !result && !isLoading) {
            setIsLoading(true);
            setError(null);

            findSimilarFonts(referenceFont)
                .then(dnaResult => {
                    setResult(dnaResult);
                    // Load Google Fonts for preview
                    dnaResult.matches.forEach(match => {
                        if (match.source.toLowerCase().includes('google')) {
                            loadGoogleFont(match.fontName);
                        }
                    });
                })
                .catch(err => {
                    console.error('Font DNA matching error:', err);
                    setError(err.message || 'Failed to find similar fonts');
                })
                .finally(() => {
                    setIsLoading(false);
                });
        }
    }, [isOpen, referenceFont, result, isLoading]);

    const handleCopyFontName = (fontName: string, index: number) => {
        navigator.clipboard.writeText(fontName).then(() => {
            setCopiedIndex(index);
            setTimeout(() => setCopiedIndex(null), 2000);
        });
    };

    const getScoreColor = (score: number) => {
        if (score >= 80) return 'text-green-400 bg-green-500/20 border-green-500/40';
        if (score >= 60) return 'text-yellow-400 bg-yellow-500/20 border-yellow-500/40';
        return 'text-orange-400 bg-orange-500/20 border-orange-500/40';
    };

    if (!isOpen) return null;

    const modalContent = (
        <div
            className="fixed inset-0 bg-black/60 flex items-start justify-center z-[9999] animate-fade-in p-4 pt-8 overflow-y-auto"
            onClick={onClose}
        >
            <div
                className="bg-surface rounded-lg w-full max-w-4xl max-h-[85vh] overflow-hidden border border-border shadow-2xl flex flex-col my-4"
                onClick={e => e.stopPropagation()}
            >
                {/* Header */}
                <div className="p-6 border-b border-border flex-shrink-0">
                    <div className="flex items-center justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-primary">Font DNA Matching</h2>
                            <p className="text-secondary text-sm mt-1">
                                Finding fonts similar to <span className="text-accent font-semibold">{referenceFont.fontName}</span>
                            </p>
                        </div>
                        <button
                            onClick={onClose}
                            className="text-secondary hover:text-primary transition-colors p-2"
                            aria-label="Close modal"
                        >
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                {/* Content */}
                <div className="flex-1 overflow-y-auto p-6">
                    {isLoading && (
                        <div className="flex flex-col items-center justify-center py-12">
                            <Loader />
                            <p className="text-secondary mt-4">Analyzing font DNA and finding matches...</p>
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-center">
                            <p className="text-red-300">{error}</p>
                            <button
                                onClick={() => {
                                    setError(null);
                                    setResult(null);
                                }}
                                className="mt-3 px-4 py-2 bg-accent text-surface font-semibold rounded-lg hover:opacity-90 transition-opacity"
                            >
                                Try Again
                            </button>
                        </div>
                    )}

                    {result && (
                        <div className="space-y-6">
                            {/* DNA Characteristics */}
                            <div className="bg-teal-dark/50 rounded-lg p-4 border border-teal-medium">
                                <h3 className="text-lg font-semibold text-accent mb-3">Font DNA Characteristics</h3>
                                <div className="flex flex-wrap gap-2 mb-4">
                                    {result.characteristics.map((char, index) => (
                                        <span
                                            key={index}
                                            className="bg-accent/20 text-accent text-sm font-medium px-3 py-1.5 rounded-full"
                                        >
                                            {char}
                                        </span>
                                    ))}
                                </div>
                                <p className="text-text-light text-sm leading-relaxed">{result.analysisNotes}</p>
                            </div>

                            {/* Matches */}
                            <div>
                                <h3 className="text-lg font-semibold text-primary mb-4">
                                    {result.totalMatches} Similar Fonts Found
                                </h3>
                                <div className="space-y-4">
                                    {result.matches.map((match, index) => (
                                        <FontDNAMatchCard
                                            key={index}
                                            match={match}
                                            index={index}
                                            onCopy={() => handleCopyFontName(match.fontName, index)}
                                            isCopied={copiedIndex === index}
                                            getScoreColor={getScoreColor}
                                            loadGoogleFont={loadGoogleFont}
                                        />
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );

    return createPortal(modalContent, document.body);
};

interface FontDNAMatchCardProps {
    match: FontDNAMatch;
    index: number;
    onCopy: () => void;
    isCopied: boolean;
    getScoreColor: (score: number) => string;
    loadGoogleFont: (fontName: string) => void;
}

const FontDNAMatchCard: React.FC<FontDNAMatchCardProps> = ({
    match,
    index,
    onCopy,
    isCopied,
    getScoreColor,
    loadGoogleFont
}) => {
    const isGoogleFont = match.source.toLowerCase().includes('google');

    // Load font if it's from Google Fonts
    React.useEffect(() => {
        if (isGoogleFont) {
            loadGoogleFont(match.fontName);
        }
    }, [match.fontName, isGoogleFont, loadGoogleFont]);

    return (
        <div className="bg-teal-dark/30 rounded-lg p-4 border border-teal-medium hover:border-accent/50 transition-colors">
            <div className="flex items-start justify-between gap-4">
                <div className="flex-1">
                    {/* Font Name and Score */}
                    <div className="flex items-center gap-3 mb-2">
                        <h4
                            className="text-xl font-bold text-primary"
                            style={isGoogleFont ? { fontFamily: `'${match.fontName}', sans-serif` } : undefined}
                        >
                            {match.fontName}
                        </h4>
                        <span className={`text-sm font-bold px-2 py-1 rounded border ${getScoreColor(match.matchScore)}`}>
                            {match.matchScore}%
                        </span>
                        {match.isPremium && (
                            <span className="text-xs font-semibold px-2 py-1 rounded bg-yellow-500/20 text-yellow-300 border border-yellow-500/40">
                                Premium
                            </span>
                        )}
                    </div>

                    {/* Source Badge */}
                    <div className="flex items-center gap-2 mb-3">
                        <span className="text-xs font-medium px-2 py-1 rounded bg-secondary/30 text-secondary">
                            {match.source}
                        </span>
                        <button
                            onClick={onCopy}
                            className="text-xs flex items-center gap-1 text-secondary hover:text-accent transition-colors"
                            title="Copy font name"
                        >
                            {isCopied ? <CheckIcon className="w-3 h-3" /> : <CopyIcon className="w-3 h-3" />}
                            {isCopied ? 'Copied!' : 'Copy'}
                        </button>
                        {match.directLink && (
                            <a
                                href={match.directLink}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-xs flex items-center gap-1 text-secondary hover:text-accent transition-colors"
                            >
                                <ExternalLinkIcon className="w-3 h-3" />
                                View
                            </a>
                        )}
                    </div>

                    {/* Preview (for Google Fonts) */}
                    {isGoogleFont && (
                        <div className="bg-paper-light rounded p-3 mb-3">
                            <p
                                className="text-lg text-text-dark"
                                style={{ fontFamily: `'${match.fontName}', sans-serif` }}
                            >
                                The quick brown fox jumps over the lazy dog
                            </p>
                        </div>
                    )}

                    {/* Details */}
                    <div className="space-y-2 text-sm">
                        <div>
                            <span className="text-accent font-semibold">Visual Similarity: </span>
                            <span className="text-text-light">{match.visualSimilarity}</span>
                        </div>
                        <div>
                            <span className="text-accent font-semibold">Key Differences: </span>
                            <span className="text-text-light">{match.differingCharacteristics}</span>
                        </div>
                        <div>
                            <span className="text-accent font-semibold">Best For: </span>
                            <span className="text-text-light">{match.bestUseCase}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
};

export default FontDNAModal;


================================================================================
FILE PATH: components\FontPreview.tsx
================================================================================
import React, { useState, useEffect, forwardRef, useLayoutEffect, useRef } from 'react';
import type { VariableAxis } from '../types';
import { getAxisDescription } from '../utils/fontUtils';
import { TooltipInfoIcon, LineChartIcon } from './Icons';

declare var opentype: any;

interface FontPreviewProps {
  file: File | null;
  googleFontName?: string;
  initialSentence: string;
  isGeneratingSentence: boolean;
  onFontParsed: (font: any) => void;
  backgroundColor: string;
  textColor: string;
  onColorChange: (type: 'bg' | 'text', value: string) => void;
}

const FontPreview = forwardRef<HTMLDivElement, FontPreviewProps>(({ file, googleFontName, initialSentence, isGeneratingSentence, onFontParsed, backgroundColor, textColor, onColorChange }, ref) => {
  const [fontFamily, setFontFamily] = useState<string | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [previewText, setPreviewText] = useState(initialSentence);
  const [isGoogleFontLoading, setIsGoogleFontLoading] = useState<boolean>(false);
  
  const [lineHeight, setLineHeight] = useState(1.1);
  const [letterSpacing, setLetterSpacing] = useState(0);

  const [weightAxis, setWeightAxis] = useState<VariableAxis | null>(null);
  const [variableAxes, setVariableAxes] = useState<VariableAxis[]>([]);
  const [axisValues, setAxisValues] = useState<Record<string, number>>({});
  
  const [parsedFont, setParsedFont] = useState<any>(null);
  const [showMetrics, setShowMetrics] = useState<boolean>(false);
  const [metricLines, setMetricLines] = useState<Record<string, number>>({});

  const charSetContainerRef = useRef<HTMLDivElement>(null);
  const upperCaseRef = useRef<HTMLParagraphElement>(null);
  const lowerCaseRef = useRef<HTMLParagraphElement>(null);
  const symbolsRef = useRef<HTMLParagraphElement>(null);
  const metricsTargetRef = useRef<HTMLParagraphElement>(null);

  useEffect(() => { setPreviewText(initialSentence); }, [initialSentence]);

  const resetState = () => {
    setError(null);
    setFontFamily(null);
    setWeightAxis(null);
    setVariableAxes([]);
    setAxisValues({});
    setParsedFont(null);
    setShowMetrics(false);
    setIsGoogleFontLoading(false);
  };

  useEffect(() => {
    resetState();

    if (googleFontName) {
        const loadFont = async () => {
            setIsGoogleFontLoading(true);
            try {
                const sanitizedFontName = googleFontName.replace(/ /g, '+');
                const fontUrl = `https://fonts.googleapis.com/css2?family=${sanitizedFontName}:ital,wght@0,100..900;1,100..900&display=swap`;

                if (!document.querySelector(`link[href="${fontUrl}"]`)) {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = fontUrl;
                    
                    const promise = new Promise((resolve, reject) => {
                        link.onload = resolve;
                        link.onerror = () => reject(new Error('Failed to load font stylesheet.'));
                    });

                    document.head.appendChild(link);
                    await promise;
                }
                
                await document.fonts.load(`1em "${googleFontName}"`);
                
                if (document.fonts.check(`1em "${googleFontName}"`)) {
                    setFontFamily(`'${googleFontName}', sans-serif`);
                } else {
                    throw new Error(`Font "${googleFontName}" could not be activated after loading. It might not exist on Google Fonts.`);
                }
            } catch (err) {
                console.error("Failed to load Google Font:", err);
                setError(`Could not load Google Font: "${googleFontName}". Please check the name and your network connection.`);
            } finally {
                setIsGoogleFontLoading(false);
            }
        };
        loadFont();
    } else if (file) {
        const uniqueFontFamily = `font-preview-${Date.now()}`;
        const reader = new FileReader();
        const style = document.createElement('style');
        let objectUrl: string | null = null;
        
        reader.onload = (e) => {
          const arrayBuffer = e.target?.result as ArrayBuffer;
          if (!arrayBuffer) {
            setError("Could not read the font file.");
            return;
          }
          try {
            const font = opentype.parse(arrayBuffer);
            onFontParsed(font);
            setParsedFont(font);

            if (font.tables.fvar && font.tables.fvar.axes) {
                const allAxes: VariableAxis[] = font.tables.fvar.axes;
                const wghtAxis = allAxes.find(axis => axis.tag === 'wght');
                const otherAxes = allAxes.filter(axis => axis.tag !== 'wght');
                setWeightAxis(wghtAxis || null);
                setVariableAxes(otherAxes);

                const initialValues: Record<string, number> = {};
                allAxes.forEach(axis => { initialValues[axis.tag] = axis.defaultValue; });
                setAxisValues(initialValues);
            }
          } catch (err) { console.warn("Could not parse font file.", err); }
          
          const blob = new Blob([arrayBuffer], { type: file.type });
          objectUrl = URL.createObjectURL(blob);

          style.textContent = `@font-face { font-family: '${uniqueFontFamily}'; src: url('${objectUrl}'); }`;
          document.head.appendChild(style);
          setFontFamily(uniqueFontFamily);
        };
        
        reader.onerror = () => setError("Could not load the font file.");
        reader.readAsArrayBuffer(file);

        return () => {
          if (style.parentNode) {
            document.head.removeChild(style);
          }
          if (objectUrl) {
            URL.revokeObjectURL(objectUrl);
          }
        }
    } else {
        setFontFamily(null);
    }
}, [file, googleFontName, onFontParsed]);


  useLayoutEffect(() => {
    const container = charSetContainerRef.current;
    if (!container) return;
    const adjustFontSizes = () => {
        requestAnimationFrame(() => {
            if (!container) return;
            const containerWidth = container.clientWidth;
            if (containerWidth === 0) return;
            [upperCaseRef.current, lowerCaseRef.current, symbolsRef.current, metricsTargetRef.current].forEach(el => {
                if (!el) return;
                el.style.whiteSpace = 'nowrap';
                el.style.fontSize = '100px';
                if (el.scrollWidth > 0) {
                    const ideal = (containerWidth / el.scrollWidth) * 100;
                    el.style.fontSize = `${Math.max(10, Math.min(ideal, 120))}px`;
                    el.style.lineHeight = '1.2';
                }
                el.style.whiteSpace = 'normal';
            });
        });
    };
    const observer = new ResizeObserver(adjustFontSizes);
    observer.observe(container);
    adjustFontSizes();
    return () => observer.disconnect();
  }, [fontFamily]);

  useLayoutEffect(() => {
    if (showMetrics && parsedFont && metricsTargetRef.current) {
        const el = metricsTargetRef.current;
        const fontSize = parseFloat(window.getComputedStyle(el).fontSize);
        const scale = fontSize / parsedFont.unitsPerEm;
        setMetricLines({
            ascender: (parsedFont.ascender * scale),
            capHeight: (parsedFont.tables.os2.sCapHeight * scale),
            xHeight: (parsedFont.tables.os2.sxHeight * scale),
            descender: (parsedFont.descender * scale),
        });
    }
  }, [showMetrics, parsedFont, fontFamily]);

  const handleAxisChange = (tag: string, value: number) => setAxisValues(prev => ({ ...prev, [tag]: value }));
  const handleResetControls = () => {
    setLineHeight(1.1);
    setLetterSpacing(0);
    const initialValues: Record<string, number> = {};
    if (weightAxis) initialValues[weightAxis.tag] = weightAxis.defaultValue;
    variableAxes.forEach(axis => { initialValues[axis.tag] = axis.defaultValue; });
    setAxisValues(initialValues);
  };
  
  if (isGoogleFontLoading) return <div className="flex items-center justify-center h-full min-h-[200px] text-secondary">Loading Google Font "{googleFontName}"...</div>;
  if (error) return <div className="flex items-center justify-center h-full text-danger p-4 text-center">{error}</div>;
  if (!fontFamily) return <div className="flex items-center justify-center h-full">Loading font preview...</div>;

  const fontVariationSettings = Object.entries(axisValues).map(([tag, value]) => `'${tag}' ${value}`).join(', ');
  const sampleStyle: React.CSSProperties = { fontFamily, fontVariationSettings, WebkitFontSmoothing: 'antialiased', MozOsxFontSmoothing: 'grayscale', color: textColor };

  return (
    <div ref={ref} style={{ backgroundColor }} className="text-primary p-4 rounded-lg space-y-4">
        <div className="flex justify-between items-center border-b border-border pb-4">
            <h3 className="text-lg font-bold text-accent">Font Preview</h3>
            <div className="flex items-center gap-2">
                <div className="flex items-center gap-2">
                    <label htmlFor="bg-color" className="text-xs text-secondary">BG</label>
                    <input id="bg-color" type="color" value={backgroundColor} onChange={e => onColorChange('bg', e.target.value)} className="w-6 h-6 bg-transparent border-none rounded cursor-pointer" />
                </div>
                <div className="flex items-center gap-2">
                    <label htmlFor="text-color" className="text-xs text-secondary">Text</label>
                    <input id="text-color" type="color" value={textColor} onChange={e => onColorChange('text', e.target.value)} className="w-6 h-6 bg-transparent border-none rounded cursor-pointer" />
                </div>
            </div>
        </div>
        
        <div className="relative">
             <label htmlFor="preview-text-input" className="text-sm font-semibold text-secondary">Custom Preview Text</label>
             <textarea id="preview-text-input" value={previewText} onChange={(e) => setPreviewText(e.target.value)} placeholder="Type your own preview text..."
                className="mt-2 w-full bg-surface border border-border rounded-md p-2 text-primary focus:ring-2 focus:ring-accent focus:border-accent transition resize-none" rows={2} style={{ color: textColor, backgroundColor: 'var(--surface-color)' }}/>
            {isGeneratingSentence && (<div role="status" aria-live="polite" className="absolute bottom-2 right-2 text-xs text-secondary animate-pulse">Generating sentence...</div>)}
        </div>

        <div className="border-t border-b border-border py-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                <div>
                    <label htmlFor="line-height-slider" className="flex justify-between text-sm font-semibold text-secondary"><span>Line Height</span><span className="font-mono text-accent">{lineHeight.toFixed(2)}</span></label>
                    <input id="line-height-slider" type="range" min="0.8" max="3" step="0.05" value={lineHeight} onChange={(e) => setLineHeight(parseFloat(e.target.value))} className="w-full h-2 bg-surface rounded-lg appearance-none cursor-pointer accent-accent" aria-label="Adjust line height"/>
                </div>
                <div>
                    <label htmlFor="letter-spacing-slider" className="flex justify-between text-sm font-semibold text-secondary"><span>Letter Spacing</span><span className="font-mono text-accent">{letterSpacing.toFixed(3)} em</span></label>
                    <input id="letter-spacing-slider" type="range" min="-0.1" max="0.5" step="0.005" value={letterSpacing} onChange={(e) => setLetterSpacing(parseFloat(e.target.value))} className="w-full h-2 bg-surface rounded-lg appearance-none cursor-pointer accent-accent" aria-label="Adjust letter spacing" />
                </div>
            </div>
            {parsedFont && (
                <div className="mt-4 pt-4 border-t border-border/50">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        {weightAxis && (
                            <div className="md:col-span-2">
                                <label htmlFor="weight-slider" className="flex justify-between text-sm font-semibold text-secondary"><span>Weight</span><span className="font-mono text-accent">{axisValues[weightAxis.tag]}</span></label>
                                <input id="weight-slider" type="range" min={weightAxis.minValue} max={weightAxis.maxValue} step="1" value={axisValues[weightAxis.tag] || weightAxis.defaultValue} onChange={(e) => handleAxisChange(weightAxis.tag, parseFloat(e.target.value))} className="w-full h-2 bg-surface rounded-lg appearance-none cursor-pointer accent-accent mt-1" aria-label="Adjust font weight"/>
                            </div>
                        )}
                        {variableAxes.map(axis => (
                            <div key={axis.tag}>
                                <label htmlFor={`${axis.tag}-slider`} className="flex justify-between items-center text-sm font-semibold text-secondary">
                                    <div className="flex items-center gap-1.5">
                                        <span>{axis.name}</span>
                                        <div className="relative group flex items-center">
                                            <TooltipInfoIcon tabIndex={0} className="w-4 h-4 text-secondary/70 cursor-help focus:outline-none focus-visible:ring-2 focus-visible:ring-accent rounded-full" aria-label={`More info about ${axis.name}`} />
                                            <div role="tooltip" className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs p-2 text-xs bg-background border border-border text-primary rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-opacity duration-300 pointer-events-none z-10">{getAxisDescription(axis.tag)}</div>
                                        </div>
                                    </div>
                                    <span className="font-mono text-accent">{axisValues[axis.tag]}</span>
                                </label>
                                <input id={`${axis.tag}-slider`} type="range" min={axis.minValue} max={axis.maxValue} step="1" value={axisValues[axis.tag] || axis.defaultValue} onChange={(e) => handleAxisChange(axis.tag, parseFloat(e.target.value))} className="w-full h-2 bg-surface rounded-lg appearance-none cursor-pointer accent-accent mt-1" aria-label={`Adjust ${axis.name}`}/>
                            </div>
                        ))}
                    </div>
                    <div className="flex justify-end gap-4 mt-4">
                        <button onClick={() => setShowMetrics(!showMetrics)} className={`px-4 py-2 text-xs font-semibold rounded-lg transition-colors flex items-center gap-2 ${showMetrics ? 'bg-accent/30 text-accent' : 'bg-secondary/50 text-primary'} hover:bg-secondary/70`}><LineChartIcon className="w-4 h-4"/>Metrics</button>
                        {(weightAxis || variableAxes.length > 0) && <button onClick={handleResetControls} className="px-4 py-2 text-xs bg-secondary/50 text-primary font-semibold rounded-lg hover:bg-secondary/70 transition-colors">Reset Controls</button>}
                    </div>
                </div>
            )}
        </div>
        
        <div style={sampleStyle} className="break-words pt-4">
            <p style={{ fontSize: 'clamp(2rem, 8vw, 4rem)', lineHeight, letterSpacing: `${letterSpacing}em` }} className="mb-6 overflow-hidden break-words">{previewText}</p>
            <div ref={charSetContainerRef} className="space-y-2 text-secondary break-all">
                <div className="relative">
                    {showMetrics && parsedFont && <div className="absolute inset-0 z-10 overflow-hidden">
                        <div className="absolute w-full border-b border-dashed border-cyan-400/50" style={{ top: `calc(50% - ${metricLines.ascender || 0}px)` }}><span className="text-xs text-cyan-400/80 bg-background/50 px-1">Ascender</span></div>
                        <div className="absolute w-full border-b border-dashed border-green-400/50" style={{ top: `calc(50% - ${metricLines.capHeight || 0}px)` }}><span className="text-xs text-green-400/80 bg-background/50 px-1">Cap Height</span></div>
                        <div className="absolute w-full border-b border-dashed border-yellow-400/50" style={{ top: `calc(50% - ${metricLines.xHeight || 0}px)` }}><span className="text-xs text-yellow-400/80 bg-background/50 px-1">x-Height</span></div>
                        <div className="absolute w-full border-b border-dashed border-red-400/50" style={{ top: '50%' }}><span className="text-xs text-red-400/80 bg-background/50 px-1">Baseline</span></div>
                        <div className="absolute w-full border-b border-dashed border-purple-400/50" style={{ top: `calc(50% - ${metricLines.descender || 0}px)` }}><span className="text-xs text-purple-400/80 bg-background/50 px-1">Descender</span></div>
                    </div>}
                    <p ref={metricsTargetRef}>Abc Xyz</p>
                </div>
                <p ref={upperCaseRef}>ABCDEFGHIJKLMNOPQRSTUVWXYZ</p>
                <p ref={lowerCaseRef}>abcdefghijklmnopqrstuvwxyz</p>
                <p ref={symbolsRef}>0123456789 `!@#$%^&amp;*()_+-=[]\{}|;':",./&lt;&gt;?</p>
            </div>
        </div>
    </div>
  );
});

export default FontPreview;

================================================================================
FILE PATH: components\FontSourceBadge.tsx
================================================================================
import React from 'react';
import type { FontSource } from '../types';

interface FontSourceBadgeProps {
  fontSource: FontSource | undefined;
  fontFoundry?: string;
  size?: 'sm' | 'md' | 'lg';
}

const FontSourceBadge: React.FC<FontSourceBadgeProps> = ({
  fontSource,
  fontFoundry,
  size = 'md'
}) => {
  const getSourceConfig = () => {
    switch (fontSource) {
      case 'google-fonts':
        return {
          label: 'Google Fonts',
          bgColor: 'bg-blue-500/20',
          textColor: 'text-blue-300',
          borderColor: 'border-blue-500/40',
          icon: (
            <svg className="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12.01 12.01c0-3.31 2.69-6 6-6V3.01c-5.52 0-10 4.48-10 10s4.48 10 10 10v-3c-3.31 0-6-2.69-6-6z"/>
              <path d="M21.01 3v3c0 3.31-2.69 6-6 6h-3v2h3c2.76 0 5-2.24 5-5V3h-3z"/>
              <circle cx="12.01" cy="12.01" r="2"/>
            </svg>
          )
        };
      case 'adobe-fonts':
        return {
          label: 'Adobe Fonts',
          bgColor: 'bg-red-500/20',
          textColor: 'text-red-300',
          borderColor: 'border-red-500/40',
          icon: (
            <svg className="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M13.966 22.624l-1.69-4.281H8.122l3.892-9.144 5.662 13.425zM8.884 1.376H0v21.248zm15.116 0h-8.884L24 22.624Z"/>
            </svg>
          )
        };
      case 'myfonts':
        return {
          label: 'MyFonts',
          bgColor: 'bg-orange-500/20',
          textColor: 'text-orange-300',
          borderColor: 'border-orange-500/40',
          icon: (
            <svg className="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
          )
        };
      case 'fontshare':
        return {
          label: 'Fontshare',
          bgColor: 'bg-indigo-500/20',
          textColor: 'text-indigo-300',
          borderColor: 'border-indigo-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
            </svg>
          )
        };
      case 'font-squirrel':
        return {
          label: 'Font Squirrel',
          bgColor: 'bg-amber-500/20',
          textColor: 'text-amber-300',
          borderColor: 'border-amber-500/40',
          icon: (
            <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm0 18a8 8 0 118-8 8 8 0 01-8 8zm3-11h-2V7h-2v2H9v2h2v2h2v-2h2z"/>
            </svg>
          )
        };
      case 'dafont':
        return {
          label: 'DaFont',
          bgColor: 'bg-yellow-500/20',
          textColor: 'text-yellow-300',
          borderColor: 'border-yellow-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
            </svg>
          )
        };
      case 'fontesk':
        return {
          label: 'Fontesk',
          bgColor: 'bg-cyan-500/20',
          textColor: 'text-cyan-300',
          borderColor: 'border-cyan-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
            </svg>
          )
        };
      case 'velvetyne':
        return {
          label: 'Velvetyne',
          bgColor: 'bg-pink-500/20',
          textColor: 'text-pink-300',
          borderColor: 'border-pink-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
          )
        };
      case 'league-of-moveable-type':
        return {
          label: 'League of Moveable Type',
          bgColor: 'bg-emerald-500/20',
          textColor: 'text-emerald-300',
          borderColor: 'border-emerald-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
            </svg>
          )
        };
      case 'the-northern-block':
        return {
          label: 'The Northern Block',
          bgColor: 'bg-slate-500/20',
          textColor: 'text-slate-300',
          borderColor: 'border-slate-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
            </svg>
          )
        };
      case 'atipo':
        return {
          label: 'Atipo',
          bgColor: 'bg-violet-500/20',
          textColor: 'text-violet-300',
          borderColor: 'border-violet-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/>
            </svg>
          )
        };
      case 'uploaded-file':
        return {
          label: 'Uploaded Font',
          bgColor: 'bg-green-500/20',
          textColor: 'text-green-300',
          borderColor: 'border-green-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
          )
        };
      case 'image':
        return {
          label: 'Image Analysis',
          bgColor: 'bg-purple-500/20',
          textColor: 'text-purple-300',
          borderColor: 'border-purple-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          )
        };
      default:
        return {
          label: 'Other Source',
          bgColor: 'bg-gray-500/20',
          textColor: 'text-gray-300',
          borderColor: 'border-gray-500/40',
          icon: (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          )
        };
    }
  };

  const sizeClasses = {
    sm: 'text-xs px-2 py-1',
    md: 'text-sm px-3 py-1.5',
    lg: 'text-base px-4 py-2'
  };

  const config = getSourceConfig();

  return (
    <div className="flex flex-wrap gap-2 items-center">
      <span
        className={`inline-flex items-center gap-1.5 ${config.bgColor} ${config.textColor} ${sizeClasses[size]} rounded-full border ${config.borderColor} font-semibold`}
      >
        {config.icon}
        {config.label}
      </span>
      {fontFoundry && fontFoundry.toLowerCase() !== 'unknown foundry' && (
        <span
          className="inline-flex items-center gap-1.5 bg-teal-500/20 text-teal-300 text-sm px-3 py-1.5 rounded-full border border-teal-500/40 font-semibold"
          title="Font Foundry"
        >
          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
          </svg>
          {fontFoundry}
        </span>
      )}
    </div>
  );
};

export default FontSourceBadge;


================================================================================
FILE PATH: components\FontSuggestionCard.tsx
================================================================================
import React, { useEffect, useState } from 'react';
import type { FontSuggestion } from '../types';

interface FontSuggestionCardProps {
    suggestion: FontSuggestion;
    onAnalyze: (fontName: string) => void;
}

const FontSuggestionCard: React.FC<FontSuggestionCardProps> = ({ suggestion, onAnalyze }) => {
    const [fontLoaded, setFontLoaded] = useState(false);

    useEffect(() => {
        // Load the Google Font dynamically
        const fontFamily = suggestion.fontName;
        const link = document.createElement('link');
        link.href = `https://fonts.googleapis.com/css2?family=${fontFamily.replace(/ /g, '+')}:wght@400;700&display=swap`;
        link.rel = 'stylesheet';
        document.head.appendChild(link);

        link.onload = () => setFontLoaded(true);

        return () => {
            // Cleanup on unmount (optional, can keep fonts loaded for performance)
            // document.head.removeChild(link);
        };
    }, [suggestion.fontName]);

    const getScoreColor = (score: number): string => {
        if (score >= 8) return 'text-green-400';
        if (score >= 6) return 'text-yellow-400';
        return 'text-orange-400';
    };

    const getScoreBgColor = (score: number): string => {
        if (score >= 8) return 'bg-green-400/10 border-green-400/20';
        if (score >= 6) return 'bg-yellow-400/10 border-yellow-400/20';
        return 'bg-orange-400/10 border-orange-400/20';
    };

    return (
        <div className="bg-surface border border-border rounded-lg p-6 hover:border-accent transition-colors">
            {/* Header with font name and score */}
            <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                    <h3 className="text-lg font-semibold text-text-light mb-1">
                        {suggestion.fontName}
                    </h3>
                    <p className="text-xs text-teal-light uppercase tracking-wide">
                        {suggestion.category}
                    </p>
                </div>
                <div className={`flex items-center gap-2 px-3 py-1.5 rounded-md border ${getScoreBgColor(suggestion.matchScore)}`}>
                    <span className={`text-2xl font-bold ${getScoreColor(suggestion.matchScore)}`}>
                        {suggestion.matchScore}
                    </span>
                    <span className="text-xs text-teal-light">/10</span>
                </div>
            </div>

            {/* Font Preview */}
            <div className="bg-paper-light rounded-md p-6 mb-4 border border-text-secondary/20" style={{ minHeight: '120px' }}>
                <p
                    className="text-text-dark text-3xl leading-relaxed"
                    style={{
                        fontFamily: fontLoaded ? `'${suggestion.fontName}', sans-serif` : 'sans-serif',
                        opacity: fontLoaded ? 1 : 0.5
                    }}
                >
                    {suggestion.previewText || 'The quick brown fox jumps over the lazy dog'}
                </p>
                <p
                    className="text-text-secondary text-sm mt-2"
                    style={{
                        fontFamily: fontLoaded ? `'${suggestion.fontName}', sans-serif` : 'sans-serif',
                        opacity: fontLoaded ? 1 : 0.5
                    }}
                >
                    ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz 0123456789
                </p>
            </div>

            {/* Rationale */}
            <div className="mb-4">
                <h4 className="text-sm font-medium text-text-light mb-2">Why this font?</h4>
                <p className="text-sm text-teal-light leading-relaxed">
                    {suggestion.rationale}
                </p>
            </div>

            {/* Use Cases */}
            <div className="mb-4">
                <h4 className="text-sm font-medium text-text-light mb-2">Recommended for:</h4>
                <div className="flex flex-wrap gap-2">
                    {suggestion.useCases.map((useCase, index) => (
                        <span
                            key={index}
                            className="px-2.5 py-1 bg-accent/20 text-accent text-xs rounded-md border border-accent/30 font-medium"
                        >
                            {useCase}
                        </span>
                    ))}
                </div>
            </div>

            {/* Actions */}
            <div className="flex gap-3 pt-4 border-t border-teal-medium">
                <button
                    onClick={() => onAnalyze(suggestion.fontName)}
                    className="flex-1 px-4 py-2 bg-accent text-text-light font-medium rounded-md hover:opacity-90 transition-opacity"
                >
                    Analyze Font
                </button>
                <a
                    href={`https://fonts.google.com/specimen/${suggestion.fontName.replace(/ /g, '+')}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="flex-1 px-4 py-2 bg-teal-medium border border-accent text-text-light font-medium rounded-md hover:bg-accent transition-colors text-center"
                >
                    View on Google Fonts
                </a>
            </div>
        </div>
    );
};

export default FontSuggestionCard;


================================================================================
FILE PATH: components\FontSuggestionView.tsx
================================================================================
import React, { useState } from 'react';
import type { FontSuggestionResult } from '../types';
import { suggestFonts } from '../services/geminiService';
import { getPopularGoogleFonts } from '../services/googleFontsService';
import CategorySelector from './CategorySelector';
import FontSuggestionCard from './FontSuggestionCard';
import Loader from './Loader';

interface FontSuggestionViewProps {
    onAnalyzeFont: (fontName: string) => void;
}

// Category options
const USAGE_TYPES = ['Headers', 'Body Text', 'Display', 'Logo', 'UI Elements', 'Monospace'];
const BUSINESS_TYPES = ['Corporate', 'Creative', 'Tech', 'Healthcare', 'Education', 'Retail', 'Finance', 'Hospitality', 'Non-profit'];
const THEMES = ['Modern', 'Classic', 'Elegant', 'Playful', 'Bold', 'Minimal', 'Vintage', 'Industrial', 'Nature-inspired', 'Futuristic'];
const FONT_CATEGORIES = ['Serif', 'Sans-Serif', 'Display', 'Handwriting', 'Monospace'];

const FontSuggestionView: React.FC<FontSuggestionViewProps> = ({ onAnalyzeFont }) => {
    const [description, setDescription] = useState('');
    const [selectedUsageTypes, setSelectedUsageTypes] = useState<string[]>([]);
    const [selectedBusinessTypes, setSelectedBusinessTypes] = useState<string[]>([]);
    const [selectedThemes, setSelectedThemes] = useState<string[]>([]);
    const [selectedFontCategories, setSelectedFontCategories] = useState<string[]>([]);
    const [isSearching, setIsSearching] = useState(false);
    const [results, setResults] = useState<FontSuggestionResult | null>(null);
    const [error, setError] = useState<string | null>(null);

    const handleSearch = async () => {
        // Validation
        if (!description.trim() && selectedUsageTypes.length === 0 && selectedBusinessTypes.length === 0 && selectedThemes.length === 0 && selectedFontCategories.length === 0) {
            setError('Please provide a description or select at least one category.');
            return;
        }

        setIsSearching(true);
        setError(null);
        setResults(null);

        try {
            // Fetch Google Fonts list
            const fonts = await getPopularGoogleFonts(800);
            const fontNames = fonts.map(f => f.family);

            // Build request
            const request = {
                description: description.trim(),
                usageTypes: selectedUsageTypes,
                businessTypes: selectedBusinessTypes,
                themes: selectedThemes,
                fontCategories: selectedFontCategories.map(c => c.toLowerCase().replace('-', '')),
                maxResults: 5
            };

            // Call AI service
            const suggestionsResult = await suggestFonts(request, fontNames);
            setResults(suggestionsResult);

        } catch (err) {
            console.error('Error getting font suggestions:', err);
            setError(err instanceof Error ? err.message : 'Failed to get font suggestions. Please try again.');
        } finally {
            setIsSearching(false);
        }
    };

    const handleClear = () => {
        setDescription('');
        setSelectedUsageTypes([]);
        setSelectedBusinessTypes([]);
        setSelectedThemes([]);
        setSelectedFontCategories([]);
        setResults(null);
        setError(null);
    };

    return (
        <div className="max-w-6xl mx-auto p-6">
            {/* Header */}
            <div className="mb-8 text-center">
                <h1 className="text-3xl heading-embossed mb-2">Find Perfect Fonts</h1>
                <p className="text-text-dark">
                    Describe your project and let AI recommend the best Google Fonts
                </p>
            </div>

            {/* Search Form */}
            <div className="teal-card-raised p-6 mb-8">
                {/* Text Input */}
                <div className="mb-6">
                    <label htmlFor="description" className="block text-sm font-medium text-text-light mb-2">
                        Project Description
                    </label>
                    <textarea
                        id="description"
                        value={description}
                        onChange={(e) => setDescription(e.target.value)}
                        placeholder="Describe your project, e.g., 'I need fonts for a luxury hotel website with elegant headers and readable body text'"
                        className="w-full warm-input border border-border p-3 text-text-dark placeholder-text-secondary focus:ring-2 focus:ring-accent focus:border-accent transition resize-none"
                        rows={4}
                        maxLength={500}
                    />
                    <div className="flex justify-between items-center mt-1">
                        <p className="text-xs text-teal-light">
                            Be specific about your needs for better results
                        </p>
                        <p className="text-xs text-teal-light">
                            {description.length}/500
                        </p>
                    </div>
                </div>

                {/* Category Selectors */}
                <CategorySelector
                    title="Usage Types"
                    categories={USAGE_TYPES}
                    selected={selectedUsageTypes}
                    onChange={setSelectedUsageTypes}
                />

                <CategorySelector
                    title="Business Types"
                    categories={BUSINESS_TYPES}
                    selected={selectedBusinessTypes}
                    onChange={setSelectedBusinessTypes}
                />

                <CategorySelector
                    title="Themes & Mood"
                    categories={THEMES}
                    selected={selectedThemes}
                    onChange={setSelectedThemes}
                />

                <CategorySelector
                    title="Font Categories"
                    categories={FONT_CATEGORIES}
                    selected={selectedFontCategories}
                    onChange={setSelectedFontCategories}
                />

                {/* Action Buttons */}
                <div className="flex gap-3 pt-4 border-t border-border">
                    <button
                        onClick={handleSearch}
                        disabled={isSearching}
                        className="flex-1 px-6 py-3 bg-accent text-text-light font-semibold rounded-md hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity"
                    >
                        {isSearching ? 'Searching...' : 'Get Font Suggestions'}
                    </button>
                    <button
                        onClick={handleClear}
                        disabled={isSearching}
                        className="px-6 py-3 bg-teal-medium border border-teal-light text-text-light font-medium rounded-md hover:bg-accent hover:text-text-light disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    >
                        Clear All
                    </button>
                </div>

                {/* Error Display */}
                {error && (
                    <div className="mt-4 bg-red-500/10 border border-red-500/20 rounded-md p-3">
                        <p className="text-sm text-red-300">{error}</p>
                    </div>
                )}
            </div>

            {/* Loading State */}
            {isSearching && (
                <div className="flex flex-col items-center justify-center py-12">
                    <Loader />
                    <p className="text-text-dark mt-4">Analyzing fonts and finding perfect matches...</p>
                </div>
            )}

            {/* Results */}
            {results && !isSearching && (
                <div>
                    {/* Search Summary */}
                    <div className="mb-6 p-4 bg-accent/10 border border-accent/20 rounded-md">
                        <h2 className="text-sm font-semibold text-accent mb-1">Search Summary</h2>
                        <p className="text-sm text-text-dark">{results.searchSummary}</p>
                        {results.additionalNotes && (
                            <p className="text-sm text-text-secondary mt-2 italic">
                                {results.additionalNotes}
                            </p>
                        )}
                    </div>

                    {/* Font Cards Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {results.suggestions.map((suggestion, index) => (
                            <FontSuggestionCard
                                key={index}
                                suggestion={suggestion}
                                onAnalyze={onAnalyzeFont}
                            />
                        ))}
                    </div>

                    {results.suggestions.length === 0 && (
                        <div className="text-center py-12">
                            <p className="text-text-dark">
                                No font suggestions found. Try adjusting your criteria.
                            </p>
                        </div>
                    )}
                </div>
            )}

            {/* Empty State */}
            {!results && !isSearching && !error && (
                <div className="text-center py-12 bg-paper-light border border-border rounded-lg">
                    <svg className="w-16 h-16 mx-auto text-text-secondary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p className="text-text-dark text-lg mb-2">
                        Ready to find your perfect fonts?
                    </p>
                    <p className="text-text-secondary text-sm max-w-md mx-auto">
                        Describe your project or select categories above, then click "Get Font Suggestions" to receive AI-powered recommendations
                    </p>
                </div>
            )}
        </div>
    );
};

export default FontSuggestionView;


================================================================================
FILE PATH: components\GlyphComparisonModal.tsx
================================================================================
import React from 'react';
import type { GlyphComparisonResult } from '../types';
import { CloseIcon } from './Icons';

interface GlyphComparisonModalProps {
  comparison: GlyphComparisonResult;
  onClose: () => void;
  font1Name: string;
  font2Name: string;
}

const getScoreColor = (score: number): string => {
  if (score >= 8) return 'text-green-500';
  if (score >= 5) return 'text-yellow-500';
  return 'text-red-500';
};

const getScoreBgColor = (score: number): string => {
  if (score >= 8) return 'bg-green-500/20';
  if (score >= 5) return 'bg-yellow-500/20';
  return 'bg-red-500/20';
};

const GlyphComparisonModal: React.FC<GlyphComparisonModalProps> = ({
  comparison,
  onClose,
  font1Name,
  font2Name,
}) => {
  return (
    <div
      className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-fade-in p-4"
      onClick={onClose}
    >
      <div
        className="bg-surface rounded-lg w-full max-w-5xl max-h-[90vh] border border-border shadow-2xl flex flex-col"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-border">
          <div>
            <h2 className="text-2xl font-bold text-primary mb-2">Glyph Comparison</h2>
            <p className="text-secondary text-sm">
              Comparing <span className="text-accent font-semibold">{font1Name}</span> vs{' '}
              <span className="text-accent font-semibold">{font2Name}</span>
            </p>
          </div>
          <button
            onClick={onClose}
            className="text-secondary hover:text-primary transition-colors"
            aria-label="Close"
          >
            <CloseIcon className="w-6 h-6" />
          </button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-6">
          {/* Overall Assessment */}
          <div className="bg-background/50 rounded-lg p-4 border border-border mb-6">
            <h3 className="text-lg font-bold text-accent mb-3">Overall Assessment</h3>
            <p className="text-secondary leading-relaxed">{comparison.overallAssessment}</p>
          </div>

          {/* Character Comparisons */}
          <div className="space-y-4">
            <h3 className="text-lg font-bold text-accent mb-3">Character Analysis</h3>
            {comparison.comparisons.map((glyph, index) => (
              <div
                key={index}
                className="bg-background border border-border rounded-lg p-5"
              >
                {/* Character Header */}
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center gap-4">
                    <div className="text-5xl font-bold text-primary bg-surface px-4 py-2 rounded border border-border">
                      {glyph.character}
                    </div>
                    <div>
                      <h4 className="text-xl font-bold text-primary">
                        Character: '{glyph.character}'
                      </h4>
                      <div className="flex items-center gap-2 mt-1">
                        <span className="text-sm text-secondary">Readability Score:</span>
                        <span
                          className={`text-lg font-bold ${getScoreColor(glyph.readabilityScore)}`}
                        >
                          {glyph.readabilityScore}/10
                        </span>
                        <span
                          className={`px-2 py-1 rounded text-xs font-semibold ${getScoreColor(
                            glyph.readabilityScore
                          )} ${getScoreBgColor(glyph.readabilityScore)}`}
                        >
                          {glyph.readabilityScore >= 8
                            ? 'Excellent'
                            : glyph.readabilityScore >= 5
                            ? 'Good'
                            : 'Poor'}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Side-by-side Analysis */}
                <div className="grid md:grid-cols-2 gap-4 mb-4">
                  <div className="bg-surface/50 rounded-lg p-4 border border-border">
                    <h5 className="font-semibold text-accent mb-2 text-sm">
                      {font1Name}
                    </h5>
                    <p className="text-secondary text-sm leading-relaxed">
                      {glyph.font1Analysis}
                    </p>
                  </div>
                  <div className="bg-surface/50 rounded-lg p-4 border border-border">
                    <h5 className="font-semibold text-accent mb-2 text-sm">
                      {font2Name}
                    </h5>
                    <p className="text-secondary text-sm leading-relaxed">
                      {glyph.font2Analysis}
                    </p>
                  </div>
                </div>

                {/* Differences */}
                {glyph.differences && glyph.differences.length > 0 && (
                  <div className="bg-surface/30 rounded-lg p-4">
                    <h5 className="font-semibold text-primary mb-2 text-sm">
                      Key Differences
                    </h5>
                    <ul className="space-y-1">
                      {glyph.differences.map((diff, diffIndex) => (
                        <li
                          key={diffIndex}
                          className="text-secondary text-sm flex items-start"
                        >
                          <span className="text-accent mr-2">â€¢</span>
                          <span>{diff}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>

        {/* Footer */}
        <div className="p-4 border-t border-border flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-accent text-surface font-bold rounded-lg hover:opacity-90 transition-opacity"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default GlyphComparisonModal;


================================================================================
FILE PATH: components\GoogleFontSearch.tsx
================================================================================
import React, { useState, useEffect, useRef } from 'react';
import { getGoogleFonts } from '../services/googleFontsService';

interface GoogleFontSearchProps {
  value: string;
  onChange: (value: string) => void;
}

const GoogleFontSearch: React.FC<GoogleFontSearchProps> = ({ value, onChange }) => {
  const [inputValue, setInputValue] = useState(value);
  const [suggestions, setSuggestions] = useState<string[]>([]);
  const [fontList, setFontList] = useState<string[]>([]);
  const [showSuggestions, setShowSuggestions] = useState(false);
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    getGoogleFonts().then(setFontList);
  }, []);

  useEffect(() => {
    setInputValue(value);
  }, [value]);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {
        setShowSuggestions(false);
      }
    };
    document.addEventListener('mousedown', handleClickOutside);
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, []);

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const text = e.target.value;
    setInputValue(text);
    if (text) {
      setSuggestions(
        fontList.filter(font => font.toLowerCase().includes(text.toLowerCase())).slice(0, 10)
      );
      setShowSuggestions(true);
    } else {
      setSuggestions([]);
      setShowSuggestions(false);
    }
  };

  const handleSuggestionClick = (fontName: string) => {
    onChange(fontName);
    setInputValue(fontName);
    setShowSuggestions(false);
  };

  return (
    <div className="w-full relative" ref={containerRef}>
      <label htmlFor="google-font-input" className="block text-sm font-medium text-secondary mb-2">
        Enter a Google Font Name
      </label>
      <input
        id="google-font-input"
        type="text"
        value={inputValue}
        onChange={handleInputChange}
        onFocus={() => inputValue && suggestions.length > 0 && setShowSuggestions(true)}
        placeholder="e.g., Roboto, Lato, Montserrat"
        className="w-full bg-background border border-border rounded-md p-3 text-primary focus:ring-2 focus:ring-accent focus:border-accent transition"
        autoComplete="off"
      />
      {showSuggestions && suggestions.length > 0 && (
        <ul className="absolute z-20 w-full mt-1 bg-surface border border-border rounded-md shadow-lg max-h-60 overflow-y-auto">
          {suggestions.map(font => (
            <li
              key={font}
              onClick={() => handleSuggestionClick(font)}
              onMouseDown={(e) => e.preventDefault()} // Prevents onBlur from firing before onClick
              className="cursor-pointer p-3 text-secondary hover:bg-accent hover:text-surface transition-colors"
            >
              {font}
            </li>
          ))}
        </ul>
      )}
       <p className="text-xs text-secondary/70 mt-2">
        Note: Analysis for Google Fonts will not include variable font controls or embedded license metadata.
      </p>
    </div>
  );
};

export default GoogleFontSearch;


================================================================================
FILE PATH: components\HistoryPanel.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import type { FontAnalysis } from '../types';
import { getHistory, deleteFromHistory, clearHistory, formatTimeAgo, type HistoryItem } from '../historyService';
import { CloseIcon, HistoryIcon } from './Icons';

interface HistoryPanelProps {
  isOpen: boolean;
  onClose: () => void;
  onLoadAnalysis: (analysis: FontAnalysis) => void;
}

const TrashIcon = (props: React.SVGProps<SVGSVGElement>) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
  </svg>
);

const HistoryPanel: React.FC<HistoryPanelProps> = ({ isOpen, onClose, onLoadAnalysis }) => {
  const [history, setHistory] = useState<HistoryItem[]>([]);
  const [hoveredItemId, setHoveredItemId] = useState<string | null>(null);

  useEffect(() => {
    if (isOpen) {
      // Load history when panel opens
      setHistory(getHistory());
    }
  }, [isOpen]);

  const handleDelete = (id: string, event: React.MouseEvent) => {
    event.stopPropagation();
    deleteFromHistory(id);
    setHistory(getHistory());
  };

  const handleClearAll = () => {
    if (window.confirm('Are you sure you want to clear all history?')) {
      clearHistory();
      setHistory([]);
    }
  };

  const handleLoadAnalysis = (item: HistoryItem) => {
    onLoadAnalysis(item.analysis);
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4"
      onClick={onClose}
    >
      <div
        className="paper-modal rounded-lg w-full max-w-3xl max-h-[80vh] shadow-2xl flex flex-col"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-border">
          <div className="flex items-center gap-3">
            <HistoryIcon className="w-6 h-6 text-accent" />
            <h2 className="text-2xl font-bold text-text-light">Analysis History</h2>
          </div>
          <button
            onClick={onClose}
            className="text-secondary hover:text-primary transition-colors"
            aria-label="Close"
          >
            <CloseIcon className="w-6 h-6" />
          </button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-6">
          {history.length === 0 ? (
            <div className="text-center py-12">
              <HistoryIcon className="w-16 h-16 text-secondary/50 mx-auto mb-4" />
              <p className="text-secondary text-lg">No analysis history yet</p>
              <p className="text-secondary/70 text-sm mt-2">
                Your font analyses will appear here
              </p>
            </div>
          ) : (
            <div className="space-y-3">
              {history.map((item) => (
                <div
                  key={item.id}
                  className="paper-card-inset rounded-lg p-4 hover:shadow-lg transition-all cursor-pointer relative group"
                  onClick={() => handleLoadAnalysis(item)}
                  onMouseEnter={() => setHoveredItemId(item.id)}
                  onMouseLeave={() => setHoveredItemId(null)}
                >
                  <div className="flex gap-4">
                    {/* Thumbnail */}
                    <div className="flex-shrink-0 w-32 h-24 bg-surface rounded border border-border/50 overflow-hidden flex items-center justify-center">
                      {item.thumbnail ? (
                        <img
                          src={item.thumbnail}
                          alt={item.analysis.fontName}
                          className="w-full h-full object-cover"
                        />
                      ) : (
                        <div className="text-secondary/50 text-center p-2">
                          <HistoryIcon className="w-8 h-8 mx-auto mb-1" />
                          <p className="text-xs">No preview</p>
                        </div>
                      )}
                    </div>

                    {/* Info */}
                    <div className="flex-1 min-w-0">
                      <div className="flex items-start justify-between gap-2">
                        <div className="flex-1 min-w-0">
                          <h3 className="text-lg font-bold text-text-dark truncate">
                            {item.analysis.fontName}
                          </h3>
                          <p className="text-accent text-sm">
                            {item.analysis.fontType}
                          </p>
                        </div>
                        <span className="text-xs text-secondary/70 flex-shrink-0">
                          {formatTimeAgo(item.timestamp)}
                        </span>
                      </div>
                      <p className="text-secondary text-sm mt-2 line-clamp-2">
                        {item.analysis.analysis}
                      </p>
                    </div>

                    {/* Delete button (shown on hover) */}
                    {hoveredItemId === item.id && (
                      <button
                        onClick={(e) => handleDelete(item.id, e)}
                        className="absolute top-2 right-2 bg-danger text-primary p-2 rounded-lg hover:opacity-90 transition-opacity"
                        aria-label="Delete"
                      >
                        <TrashIcon className="w-4 h-4" />
                      </button>
                    )}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Footer */}
        {history.length > 0 && (
          <div className="p-4 border-t border-border flex justify-between items-center">
            <span className="text-sm text-secondary">
              {history.length} {history.length === 1 ? 'item' : 'items'}
            </span>
            <button
              onClick={handleClearAll}
              className="px-4 py-2 text-sm bg-danger/80 text-primary font-semibold rounded-lg hover:bg-danger transition-colors"
            >
              Clear All History
            </button>
          </div>
        )}
      </div>
    </div>
  );
};

export default HistoryPanel;


================================================================================
FILE PATH: components\Icons.tsx
================================================================================
import React from 'react';

export const UploadIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM21 6.75l-3.75-3.75L15.19 5.19l3.75 3.75L21 6.75z" />
    </svg>
);

export const CadmusLogoIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300" {...props}>
        <g>
            <path fill="#fa7900" stroke="#fa7900" strokeWidth="2.79782" strokeLinecap="round" strokeLinejoin="round" d="m 138.95368,109.09801 v 20.69654 h 7.35104 v -20.69654 z" />
            <path fill="#314c48" stroke="#314c48" strokeWidth="1.9458" strokeLinecap="square" d="m 105.77949,157.5163 h 3.35859 l -0.008,12.0222 c -0.003,4.08627 1.06354,6.43728 4.86992,6.43728 l 7.16499,-4.31019 v -1.11952 c -1.67929,0.89563 -3.47053,1.73526 -4.75799,1.67929 -1.34343,-0.11184 -2.23905,-1.11953 -2.23905,-3.91834 l 0.008,-10.79072 h 5.10235 l 0.50378,-1.71828 h -5.60613 l -0.008,-15.7031 h -1.11952 c -1.51136,3.97433 -3.23935,14.63954 -7.26964,15.7031 z" />
            <path fill="#314c48" stroke="#314c48" strokeWidth="1.9458" strokeLinecap="square" d="m 76.308448,152.96949 c 2.015163,-1.95917 4.422154,-2.23905 4.422154,0.2799 v 17.74449 c 0,2.23907 0.503779,4.9819 3.806396,4.9819 l 5.653614,-4.31019 v -1.11952 c -2.015144,1.95918 -4.422135,2.23906 -4.422135,-0.27989 v -15.44946 c 0.783665,-2.12711 2.966746,-4.19824 5.317769,-4.19824 3.302599,0 4.757978,2.8548 4.757978,9.2361 v 11.1393 c 0,2.23907 0.50377,4.9819 3.80638,4.9819 l 5.653616,-4.31019 v -1.11952 c -2.01514,1.95918 -4.42214,2.23906 -4.42214,-0.27989 v -13.26639 c 0,-4.81397 -1.623306,-9.12417 -7.500822,-9.12417 -3.190646,0 -6.381293,2.46298 -7.612781,4.98192 v -0.33586 c 0,-2.23905 -0.503789,-4.98189 -3.806387,-4.98189 l -5.653642,4.31018 z" />
            <path fill="#314c48" stroke="#314c48" strokeWidth="1.9458" strokeLinecap="square" d="m 61.653613,176.53556 c 7.164969,0 13.434341,-5.70962 13.434341,-14.55387 0,-8.84427 -6.269372,-14.55385 -13.434341,-14.55385 -7.164978,0 -13.434331,5.70958 -13.434331,14.55385 0,8.84425 6.269353,14.55387 13.434331,14.55387 z m -8.396457,-14.55387 c 0,-9.06818 4.36616,-13.43435 8.396457,-13.43435 4.030297,0 8.396457,4.36617 8.396457,13.43435 0,9.06816 -4.36616,13.43433 -8.396457,13.43433 -4.030297,0 -8.396457,-4.36617 -8.396457,-13.43433 z" />
            <path fill="#314c48" stroke="#314c48" strokeWidth="2.6559" strokeLinecap="square" d="m 22.33877,122.45868 v 0.76404 c 1.451671,0.0765 3.820194,2.13932 3.820194,5.57749 v 40.79962 c 0,3.43816 -2.368523,5.50107 -3.820194,5.57747 v 0.76403 h 15.280758 v -0.76403 c -1.451671,-0.0765 -3.820185,-2.13931 -3.820185,-5.57747 v -18.9221 h 6.265107 c 2.062898,0 3.590978,0.61123 4.202206,3.05615 h 0.764045 v -7.64038 h -0.764045 c -0.611228,2.44492 -2.139308,3.05616 -4.202206,3.05616 h -6.265107 v -25.16289 h 8.022392 c 7.029151,0.0764 9.397664,1.83368 11.919003,6.1887 l 0.764026,-0.0765 -3.132549,-7.6404 z" />
            <path fill="#fa7900" d="m 158.69074,145.44894 v 3.48362 h -3.47953 v 2.14562 h 3.47953 v 2.30678 a 1.07078,1.07078 45 0 0 1.07078,1.07078 h 1.07078 v -3.37756 h 4.04196 l -0.65625,-1.07281 v -1.07281 h -3.38571 v -2.539 a 0.94462475,0.94462475 45 0 0 -0.94462,-0.94462 z" transform="matrix(3.2103166,0,0,3.2103166,-370.24281,-331.44864)" />
            <path fill="#314c48" stroke="#314c48" strokeWidth="2.76486" strokeLinecap="round" strokeLinejoin="round" d="m 139.05828,170.08063 v 20.53695 h 7.26293 v -20.53695 h -2.02488 -3.22647 z" />
            <path fill="#314c48" d="m 146.07979,153.56015 v 10.84304 h -3.43754 c -1.89852,0 -3.43755,-1.53903 -3.43755,-3.43755 v -7.40549 h -11.17039 v -3.44406 l -1.32008,-3.44406 h 12.49047 c 1.1536,0.50623 2.31933,0.70059 3.09648,1.67193 0.77716,0.97141 0,2.33146 1.16573,3.49719 1.1657,1.16573 2.61288,1.719 2.61288,1.719 z" />
            <path fill="#fa7900" strokeWidth="2.64615" d="m 276.21993,144.3539 c -4.22162,0 -5.27702,5.27702 -5.73876,6.92608 v -5.93663 h -13.45638 v 7.65167 c 2.44062,0 3.1662,1.12136 3.23217,3.10025 v 0 9.63055 c 0,0.066 0,0.13192 0,0.19788 0,2.63851 -0.46174,3.62795 -3.23217,3.62795 v 7.65167 h 16.75452 v -7.65167 c -2.57255,0 -3.29814,-1.12136 -3.29814,-3.16621 v -10.02633 c 0,-1.78099 0.26386,-3.62794 1.38522,-3.62794 1.31926,0 1.31926,2.17677 4.68335,2.17677 2.50658,0 4.35354,-2.1108 4.35354,-5.67279 0,-2.50659 -0.92349,-4.88125 -4.68335,-4.88125 z" />
            <path fill="#fa7900" strokeWidth="2.64615" d="m 246.51835,141.64943 c 3.10024,0 5.60682,-2.70447 5.60682,-5.73875 -0.066,-3.23216 -2.63851,-5.73876 -5.80472,-5.73876 -3.10024,0.066 -5.67279,2.63852 -5.60681,5.73876 0.066,3.29814 2.57253,5.73875 5.80471,5.73875 z" />
            <path fill="#fa7900" strokeWidth="2.64615" d="m 251.49791,166.38544 v -21.04209 h -13.45639 v 7.71763 c 2.44062,0 3.16622,1.0554 3.23218,3.03429 v 0 9.69651 c 0,0.066 0,0.066 0,0.13192 0,2.70447 -0.46174,3.69392 -3.23218,3.69392 v 7.65166 h 16.75453 v -7.65166 c -2.57255,0 -3.29814,-1.18733 -3.29814,-3.23218 z" />
            <path fill="#fa7900" strokeWidth="2.64615" d="m 235.12658,152.99502 v -7.65167 h -13.52235 v 4.02372 c -0.92348,-2.3087 -4.4195,-5.07913 -9.69652,-5.07913 -9.10285,0 -15.17141,7.51975 -15.17141,17.28223 0,9.76247 6.06856,16.62259 15.17141,16.62259 5.60683,0 8.90497,-3.56198 10.02634,-5.21105 l 0.13191,4.22161 h 13.06062 v -7.65167 c -2.50658,0 -3.23217,-1.12136 -3.29813,-3.23216 v -9.49864 c 0,-2.77043 0.46173,-3.82583 3.29813,-3.82583 z m -13.52235,8.57515 c 0,4.22161 -2.70447,8.04745 -7.12397,8.04745 -4.15565,0 -7.25589,-3.49603 -7.25589,-8.3113 0,-4.94721 3.10024,-8.37727 7.25589,-8.37727 4.4195,0 7.12397,3.62796 7.12397,8.37727 z" />
            <path fill="#fa7900" strokeWidth="2.57758" d="m 186.96587,122.70564 h -22.95501 v 8.01136 h 0.72559 c 1.5831,0 3.23218,0.12517 3.23218,2.37836 v 33.78421 c 0,0.81365 -0.26386,1.37695 -0.59367,1.75249 -0.65963,0.56329 -1.64907,0.62588 -2.63851,0.62588 h -0.72559 v 8.01134 h 18.93129 v -8.01134 h -0.79156 c -1.5831,0 -3.16621,-0.12518 -3.16621,-2.37837 v -12.7113 h 7.98149 c 8.04745,0 15.10545,-6.52249 15.10545,-15.03455 0,-8.19912 -6.79415,-16.42808 -15.10545,-16.42808 z m -1.64907,23.57646 h -6.33242 V 130.717 h 6.33242 c 3.43007,0 5.47491,5.2247 5.47491,8.41672 0,3.19202 -2.11081,7.14838 -5.47491,7.14838 z" />
        </g>
    </svg>
);

// Alternative: Small icon-only logo for compact spaces
export const FontPairIconSmall = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300" {...props}>
        <g>
            <path fill="#fa7900" stroke="#fa7900" strokeWidth="8.64027" strokeLinecap="round" strokeLinejoin="round" d="m 138.46223,24 v 63.915379 h 22.7016 V 24 Z" />
            <path fill="#fa7900" d="m 158.69074,145.44894 v 3.48362 h -3.47953 v 2.14562 h 3.47953 v 2.30678 a 1.07078,1.07078 45 0 0 1.07078,1.07078 h 1.07078 v -3.37756 h 4.04196 l -0.65625,-1.07281 v -1.07281 h -3.38571 v -2.539 a 0.94462475,0.94462475 45 0 0 -0.94462,-0.94462 z" transform="matrix(9.9141502,0,0,9.9141502,-1434.0464,-1336.5031)" />
            <path fill="#314c48" stroke="#314c48" strokeWidth="8.53847" strokeLinecap="round" strokeLinejoin="round" d="m 138.78526,212.32748 v 63.42253 h 22.42947 v -63.42253 h -6.25326 -9.96404 z" />
            <path fill="#314c48" d="m 160.8323,151.07818 v 3.37756 h -1.07078 c -0.59138,0 -1.07078,-0.4794 -1.07078,-1.07078 v -2.30678 h -3.47953 v -1.07281 l -0.4112,-1.07281 h 3.89073 c 0.35934,0.15769 0.72246,0.21823 0.96454,0.5208 0.24208,0.30259 0,0.72624 0.36312,1.08936 0.36311,0.36312 0.8139,0.53546 0.8139,0.53546 z" transform="matrix(9.9141502,0,0,9.9141502,-1434.0464,-1336.5031)" />
        </g>
    </svg>
);

export const CheckIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" {...props}>
        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clipRule="evenodd" />
    </svg>
);

export const InfoIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
    </svg>
);

export const TooltipInfoIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
    </svg>
);

export const BusinessIcon = (props: React.SVGProps<SVGSVGElement>) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M20.25 14.15v4.098a2.25 2.25 0 01-2.25 2.25h-5.398a2.25 2.25 0 01-2.25-2.25v-4.098m10.098-10.744A2.25 2.25 0 0018 3.75h-2.25a2.25 2.25 0 00-2.25 2.25v2.25m3.75 1.5H5.625c-.621 0-1.125.504-1.125 1.125v6.086c0 .621.504 1.125 1.125 1.125h5.25c.621 0 1.125-.504 1.125-1.125v-2.086m-1.125-6.086A2.25 2.25 0 009.75 5.25H7.5A2.25 2.25 0 005.25 7.5v2.25m5.25-1.5h-5.25" />
  </svg>
);

export const UsageIcon = (props: React.SVGProps<SVGSVGElement>) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
  </svg>
);

export const WeightIcon = (props: React.SVGProps<SVGSVGElement>) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l7.5-7.5 7.5 7.5M4.5 6l7.5 7.5 7.5-7.5" />
  </svg>
);

export const LicenseIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
    </svg>
);

export const PairingIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6.75h-7.5a2.25 2.25 0 00-2.25 2.25v7.5a2.25 2.25 0 002.25 2.25h7.5a2.25 2.25 0 002.25-2.25v-7.5a2.25 2.25 0 00-2.25-2.25z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75V5.25a2.25 2.25 0 012.25-2.25h7.5a2.25 2.25 0 012.25 2.25v7.5a2.25 2.25 0 01-2.25 2.25H18" />
    </svg>
);

export const GithubIcon = (props: React.SVGProps<SVGSVGElement>) => (
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" {...props}>
    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
  </svg>
);

export const AccessibilityIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 1.5a.75.75 0 01.75.75V3a.75.75 0 01-1.5 0V2.25A.75.75 0 0112 1.5zM18.75 6a.75.75 0 000-1.06l-.75-.75a.75.75 0 00-1.06 0L15.67 5.47a.75.75 0 001.06 1.06l1.27-1.27.75.75a.75.75 0 001.06 0zM21 12a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 01.75.75zM16.94 18.33l1.27 1.27a.75.75 0 001.06-1.06l-.75-.75a.75.75 0 00-1.06 0l-.75.75a.75.75 0 000 1.06zM12 22.5a.75.75 0 01-.75-.75v-1.5a.75.75 0 011.5 0v1.5a.75.75 0 01-.75.75zM5.47 16.94l-1.27 1.27a.75.75 0 001.06 1.06l.75-.75a.75.75 0 000-1.06l-.75-.75a.75.75 0 00-1.06 0zM3 12a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM7.06 5.67l-1.27-1.27a.75.75 0 00-1.06 1.06l.75.75a.75.75 0 001.06 0l.75-.75a.75.75 0 000-1.06zM12 12a4.5 4.5 0 100-9 4.5 4.5 0 000 9z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
);

export const SimilarFontsIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 17.25c0-2.083.8-4.125 2.25-5.625S21.75 9.75 21.75 9.75c0-2.083-.8-4.125-2.25-5.625S15.75 2.25 15.75 2.25c-2.083 0-4.125.8-5.625 2.25S7.5 7.667 7.5 9.75s.8 4.125 2.25 5.625 3.542 2.25 5.625 2.25zM2.25 15.75c0-2.083.8-4.125 2.25-5.625S8.25 8.25 8.25 8.25s3.542-.8 5.625-2.25S17.25 2.25 17.25 2.25" />
    </svg>
);

export const VariableFontIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
    </svg>
);

export const ShareIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.195.025.39.044.588.05H11.25a2.25 2.25 0 012.25 2.25v.143c.016.02.032.04.048.062l4.473 4.473a2.25 2.25 0 01-3.182 3.182l-4.473-4.473a2.25 2.25 0 01-.062-.048v-1.109a2.25 2.25 0 01-2.25-2.25H7.217z" />
    </svg>
);

export const ExportIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
    </svg>
);

export const CopyIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" />
    </svg>
);

export const ExternalLinkIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-4.5 0V6.375c0-.621.504-1.125 1.125-1.125h4.125" />
    </svg>
);

export const HistoryIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.185 0 4.236.668 6 1.848 1.764-1.18 3.815-1.848 6-1.848A8.987 8.987 0 0121 18.262V4.262A8.967 8.967 0 0018 3.75c-2.185 0-4.236.668-6 1.848V6.042z" />
    </svg>
);

export const SparklesIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 21.75l-.648-1.188a2.25 2.25 0 01-1.47-1.47L12.94 18.75l1.188-.648a2.25 2.25 0 011.47-1.47L16.25 15l.648 1.188a2.25 2.25 0 011.47 1.47L19.56 18.75l-1.188.648a2.25 2.25 0 01-1.47 1.47z" />
    </svg>
);

export const LineChartIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h12M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-12a2.25 2.25 0 01-2.25-2.25V3M3.75 16.5h16.5" />
    </svg>
);

export const StarIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" {...props}>
      <path fillRule="evenodd" d="M10.868 2.884c.321-.662 1.134-.662 1.456 0l1.86 3.834 4.226.615c.732.107 1.025.998.494 1.513l-3.058 2.981.722 4.21c.124.729-.64 1.284-1.288.944l-3.78-1.987-3.78 1.987c-.648.34-1.412-.215-1.288-.944l.722-4.21L2.188 8.846c-.53-.515-.238-1.406.494-1.513l4.226-.615 1.86-3.834z" clipRule="evenodd" />
    </svg>
);

export const CloseIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
    </svg>
);

export const SettingsIcon = (props: React.SVGProps<SVGSVGElement>) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
);


================================================================================
FILE PATH: components\LicenseKeyScreen.tsx
================================================================================
import React, { useState } from 'react';
import { CadmusLogoIcon, CheckIcon } from './Icons';
import {
    validateLicenseKey,
    isValidLicenseFormat,
    formatLicenseKey,
    type ValidationResult
} from '../services/licenseService';

interface LicenseKeyScreenProps {
    onLicenseValidated: () => void;
}

const LicenseKeyScreen: React.FC<LicenseKeyScreenProps> = ({ onLicenseValidated }) => {
    const [licenseKey, setLicenseKey] = useState('');
    const [isValidating, setIsValidating] = useState(false);
    const [error, setError] = useState<string | null>(null);
    const [validationResult, setValidationResult] = useState<ValidationResult | null>(null);

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        setError(null);
        setValidationResult(null);

        // Basic client-side validation
        if (!licenseKey.trim()) {
            setError('Please enter a license key');
            return;
        }

        // Remove only spaces, keep dashes (database keys have dashes)
        const cleaned = licenseKey.replace(/\s/g, '').toUpperCase();

        if (!isValidLicenseFormat(cleaned)) {
            setError('Invalid license key format. Please check your key and try again.');
            return;
        }

        setIsValidating(true);

        try {
            const result = await validateLicenseKey(cleaned);
            setValidationResult(result);

            if (result.valid) {
                // Success! Give user feedback then redirect
                setTimeout(() => {
                    onLicenseValidated();
                }, 1500);
            } else {
                // Show error message
                setError(getErrorMessage(result));
            }
        } catch (err) {
            setError('An unexpected error occurred. Please try again.');
            console.error('License validation error:', err);
        } finally {
            setIsValidating(false);
        }
    };

    const getErrorMessage = (result: ValidationResult): string => {
        switch (result.code) {
            case 'KEY_NOT_FOUND':
                return 'Invalid license key. Please check your key and try again.';
            case 'KEY_INACTIVE':
                return 'This license key has been deactivated. Please contact support.';
            case 'KEY_EXPIRED':
                return `This license key expired on ${result.expiresAt ? new Date(result.expiresAt).toLocaleDateString() : 'an earlier date'}. Please renew your license.`;
            case 'MAX_DEVICES_REACHED':
                return `This license key is already active on ${result.currentDevices || result.maxDevices} device(s). Please deactivate another device or purchase additional licenses.`;
            case 'NOT_CONFIGURED':
                return 'License validation is not configured. Please contact support.';
            default:
                return result.error || 'Failed to validate license key. Please try again.';
        }
    };

    const handleKeyChange = (e: React.ChangeEvent<HTMLInputElement>) => {
        const value = e.target.value.toUpperCase();
        setLicenseKey(value);
        setError(null);
        setValidationResult(null);
    };

    return (
        <div className="min-h-screen bg-background flex items-center justify-center p-4">
            <div className="max-w-md w-full">
                {/* Logo and Title */}
                <div className="text-center mb-8">
                    <div className="flex justify-center mb-6">
                        <CadmusLogoIcon className="w-auto icon-embossed" style={{ height: '200px', color: '#8B7355' }} />
                    </div>
                    <h1 className="text-3xl font-bold text-text-dark mb-2">FontPair AI</h1>
                    <p className="text-secondary text-sm">AI-Powered Font Pairing & Analysis Tool</p>
                </div>

                {/* License Key Form */}
                <div className="bg-surface rounded-lg shadow-2xl p-8 border border-border">
                    <h2 className="text-xl font-semibold text-text-dark mb-2">Enter License Key</h2>
                    <p className="text-sm text-secondary mb-6">
                        Please enter your license key to activate FontPair AI on this device.
                    </p>

                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                            <label htmlFor="license-key" className="block text-sm font-medium text-text-dark mb-2">
                                License Key
                            </label>
                            <input
                                id="license-key"
                                type="text"
                                value={licenseKey}
                                onChange={handleKeyChange}
                                placeholder="XXXX-XXXX-XXXX-XXXX"
                                disabled={isValidating}
                                className="w-full px-4 py-3 bg-background border border-border rounded-md text-text-dark placeholder-secondary/50 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed font-mono text-sm"
                                autoComplete="off"
                                autoFocus
                            />
                        </div>

                        {/* Error Message */}
                        {error && (
                            <div className="bg-red-500/10 border border-red-500/20 rounded-md p-3">
                                <p className="text-sm text-red-300">{error}</p>
                            </div>
                        )}

                        {/* Success Message */}
                        {validationResult?.valid && (
                            <div className="bg-green-500/10 border border-green-500/20 rounded-md p-3 flex items-center gap-2">
                                <CheckIcon className="w-5 h-5 text-green-400" />
                                <div>
                                    <p className="text-sm text-green-300 font-medium">License Activated!</p>
                                    <p className="text-xs text-green-300/70 mt-1">
                                        {validationResult.message || 'Redirecting to app...'}
                                    </p>
                                </div>
                            </div>
                        )}

                        {/* Submit Button */}
                        <button
                            type="submit"
                            disabled={isValidating || !licenseKey.trim() || validationResult?.valid}
                            className="w-full px-4 py-3 bg-accent text-surface font-semibold rounded-md hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity flex items-center justify-center gap-2"
                        >
                            {isValidating ? (
                                <>
                                    <span className="animate-spin">â³</span>
                                    <span>Validating...</span>
                                </>
                            ) : validationResult?.valid ? (
                                <>
                                    <CheckIcon className="w-5 h-5" />
                                    <span>Activated</span>
                                </>
                            ) : (
                                <span>Activate License</span>
                            )}
                        </button>
                    </form>

                    {/* Additional Info */}
                    <div className="mt-6 pt-6 border-t border-border">
                        <div className="text-xs text-secondary/70 space-y-2">
                            <p>
                                <strong className="text-text-dark">Don't have a license?</strong>
                                <br />
                                <a
                                    href="https://fontpair.ai/purchase"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="text-accent hover:underline"
                                >
                                    Purchase a license key here
                                </a>
                            </p>
                            <p>
                                <strong className="text-text-dark">Lost your key?</strong>
                                <br />
                                Contact support at{' '}
                                <a
                                    href="mailto:support@fontpair.ai"
                                    className="text-accent hover:underline"
                                >
                                    support@fontpair.ai
                                </a>
                            </p>
                            <p className="pt-2 text-secondary/50">
                                Each license key can be used on up to 3 devices. You can manage your devices in the settings after activation.
                            </p>
                        </div>
                    </div>
                </div>

                {/* Privacy Notice */}
                <div className="mt-6 text-center">
                    <p className="text-xs text-secondary/50">
                        Your license key and device information are stored securely.
                        <br />
                        We do not collect any personal data beyond what's necessary for license validation.
                    </p>
                </div>
            </div>
        </div>
    );
};

export default LicenseKeyScreen;


================================================================================
FILE PATH: components\Loader.tsx
================================================================================

import React from 'react';

const Loader: React.FC = () => {
  return (
    <div className="flex flex-col items-center justify-center p-10">
      <div className="w-12 h-12 border-4 border-dashed rounded-full animate-spin border-accent"></div>
      <p className="mt-4 text-lg text-secondary">AI is analyzing your font...</p>
    </div>
  );
};

export default Loader;

================================================================================
FILE PATH: components\OnboardingTour.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import type { OnboardingStep } from '../types';

interface OnboardingTourProps {
  isOpen: boolean;
  onComplete: () => void;
  onSkip: () => void;
}

const ONBOARDING_STEPS: OnboardingStep[] = [
  {
    id: 'welcome',
    targetSelector: '[data-tour="settings-button"]',
    title: 'Welcome to FontPair AI!',
    message: 'First, let\'s get you set up. Click here to add your Gemini API key and start your font pairing journey.',
    placement: 'bottom',
    actionText: 'Got it'
  },
  {
    id: 'analyze',
    targetSelector: '[data-tour="analysis-column"]',
    title: 'Analyze Any Font',
    message: 'Upload font files or images to get AI-powered typography analysis, accessibility insights, and pairing recommendations.',
    placement: 'right',
    actionText: 'Next'
  },
  {
    id: 'find-fonts',
    targetSelector: '[data-tour="find-fonts-button"]',
    title: 'Discover New Fonts',
    message: 'Need font recommendations? Use Find Fonts to get AI suggestions based on your project description and requirements.',
    placement: 'bottom',
    actionText: 'Next'
  },
  {
    id: 'comparison',
    targetSelector: '[data-tour="comparison-area"]',
    title: 'Compare & Critique',
    message: 'Analyze fonts side-by-side and get AI pairing critiques to find the perfect combination for your project.',
    placement: 'center',
    actionText: 'Next'
  },
  {
    id: 'data-warning',
    targetSelector: '[data-tour="settings-button"]',
    title: 'Important: Backup Your Data',
    message: 'Your projects and history are stored in your browser. Clearing browser data will delete them! Use Settings > Export Data to backup your work regularly.',
    placement: 'bottom',
    actionText: 'Start Exploring!'
  }
];

export const OnboardingTour: React.FC<OnboardingTourProps> = ({
  isOpen,
  onComplete,
  onSkip
}) => {
  const [currentStep, setCurrentStep] = useState(0);
  const [targetPosition, setTargetPosition] = useState({ top: 0, left: 0, width: 0, height: 0 });

  useEffect(() => {
    if (!isOpen) return;

    const updatePosition = () => {
      const step = ONBOARDING_STEPS[currentStep];
      const target = document.querySelector(step.targetSelector);

      if (target) {
        const rect = target.getBoundingClientRect();
        setTargetPosition({
          top: rect.top,
          left: rect.left,
          width: rect.width,
          height: rect.height
        });
      }
    };

    updatePosition();
    window.addEventListener('resize', updatePosition);
    window.addEventListener('scroll', updatePosition);

    return () => {
      window.removeEventListener('resize', updatePosition);
      window.removeEventListener('scroll', updatePosition);
    };
  }, [isOpen, currentStep]);

  // Handle ESC key to dismiss
  useEffect(() => {
    if (!isOpen) return;

    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        handleSkip();
      }
    };

    window.addEventListener('keydown', handleEscape);
    return () => window.removeEventListener('keydown', handleEscape);
  }, [isOpen]);

  const handleNext = () => {
    if (currentStep < ONBOARDING_STEPS.length - 1) {
      setCurrentStep(prev => prev + 1);
    } else {
      onComplete();
    }
  };

  const handleSkip = () => {
    if (confirm('Are you sure you want to skip the tour? You can always access it later from Settings.')) {
      onSkip();
    }
  };

  if (!isOpen) return null;

  const step = ONBOARDING_STEPS[currentStep];
  const isLastStep = currentStep === ONBOARDING_STEPS.length - 1;

  return (
    <div className="fixed inset-0 z-50 pointer-events-none">
      {/* Clickable backdrop for dismissal */}
      <div
        className="absolute inset-0 pointer-events-auto"
        onClick={handleSkip}
        style={{ background: 'transparent' }}
      />

      {/* Dark overlay with cutout using box-shadow - this creates the spotlight effect */}
      <div
        className="absolute transition-all duration-300 pointer-events-none"
        style={{
          top: targetPosition.top - 8,
          left: targetPosition.left - 8,
          width: targetPosition.width + 16,
          height: targetPosition.height + 16,
          boxShadow: '0 0 0 9999px rgba(0, 0, 0, 0.85)',
          borderRadius: '8px',
        }}
      />

      {/* Spotlight border with pulse animation and glow */}
      <div
        className="absolute border-4 border-white pointer-events-none transition-all duration-300"
        style={{
          top: targetPosition.top - 8,
          left: targetPosition.left - 8,
          width: targetPosition.width + 16,
          height: targetPosition.height + 16,
          borderRadius: '8px',
          boxShadow: '0 0 30px 8px rgba(255, 255, 255, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1)',
          animation: 'pulse-spotlight 2s ease-in-out infinite',
        }}
      />

      {/* Tooltip Card */}
      <div
        className="absolute bg-surface rounded-xl shadow-2xl p-6 max-w-md pointer-events-auto"
        style={{
          ...getTooltipPosition(targetPosition, step.placement),
          animation: 'fade-in-up 0.3s ease-out',
          zIndex: 10000
        }}
      >
        {/* Progress Indicator */}
        <div className="flex gap-2 mb-4">
          {ONBOARDING_STEPS.map((_, index) => (
            <div
              key={index}
              className={`h-2 flex-1 rounded-full transition-colors duration-300 ${
                index === currentStep ? 'bg-accent' : 'bg-border'
              }`}
            />
          ))}
        </div>

        {/* Content */}
        <h3 className="text-xl font-bold text-primary mb-3">{step.title}</h3>
        <p className="text-secondary text-base leading-relaxed mb-6">{step.message}</p>

        {/* Actions */}
        <div className="flex justify-between items-center">
          <button
            onClick={handleSkip}
            className="text-secondary hover:text-primary text-sm font-medium transition-colors"
          >
            Skip Tour
          </button>

          <button
            onClick={handleNext}
            className="px-6 py-2.5 bg-accent text-surface rounded-lg font-semibold hover:bg-accent/90 transition-colors"
          >
            {step.actionText}
          </button>
        </div>

        {/* Step Counter */}
        <p className="text-center text-xs text-secondary/60 mt-4">
          Step {currentStep + 1} of {ONBOARDING_STEPS.length}
        </p>
      </div>
    </div>
  );
};

// Helper function to calculate tooltip position
const getTooltipPosition = (
  targetPos: { top: number; left: number; width: number; height: number },
  placement?: string
): React.CSSProperties => {
  const offset = 20; // Gap between target and tooltip

  switch (placement) {
    case 'bottom':
      return {
        top: targetPos.top + targetPos.height + offset,
        left: targetPos.left + targetPos.width / 2,
        transform: 'translateX(-50%)'
      };
    case 'top':
      return {
        bottom: window.innerHeight - targetPos.top + offset,
        left: targetPos.left + targetPos.width / 2,
        transform: 'translateX(-50%)'
      };
    case 'right':
      return {
        top: targetPos.top + targetPos.height / 2,
        left: targetPos.left + targetPos.width + offset,
        transform: 'translateY(-50%)'
      };
    case 'left':
      return {
        top: targetPos.top + targetPos.height / 2,
        right: window.innerWidth - targetPos.left + offset,
        transform: 'translateY(-50%)'
      };
    case 'center':
    default:
      return {
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)'
      };
  }
};

export default OnboardingTour;


================================================================================
FILE PATH: components\PairingCritiqueModal.tsx
================================================================================
import React from 'react';
import type { PairingCritique } from '../types';
import { CheckIcon, CloseIcon, StarIcon, SparklesIcon } from './Icons';

interface PairingCritiqueModalProps {
  critique: PairingCritique;
  onClose: () => void;
  font1Name?: string;
  font2Name?: string;
}

const PairingCritiqueModal: React.FC<PairingCritiqueModalProps> = ({ critique, onClose, font1Name, font2Name }) => {
  const renderStars = (score: number) => {
    return Array.from({ length: 10 }, (_, i) => (
      <StarIcon key={i} className={`w-6 h-6 ${i < score ? 'text-yellow-400' : 'text-border'}`} />
    ));
  };

  return (
    <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-fade-in p-4" onClick={onClose}>
      <div 
        className="bg-surface rounded-lg p-6 w-full max-w-2xl border border-border shadow-2xl relative max-h-[90vh] overflow-y-auto" 
        onClick={e => e.stopPropagation()}
      >
        <button onClick={onClose} className="absolute top-4 right-4 text-teal-light hover:text-text-light transition-colors" aria-label="Close critique">
          <CloseIcon className="w-6 h-6" />
        </button>

        <div className="flex items-center gap-3 mb-4">
            <div className="bg-accent/20 p-2 rounded-full">
                <SparklesIcon className="w-6 h-6 text-accent" />
            </div>
            <div>
                <h2 className="text-2xl font-bold text-text-light">Pairing Critique</h2>
                {font1Name && font2Name && <p className="text-teal-light">{font1Name} + {font2Name}</p>}
            </div>
        </div>

        <div className="bg-background/50 p-4 rounded-lg mb-6">
            <h3 className="text-lg font-semibold text-text-light text-center mb-2">Overall Score: {critique.overallScore}/10</h3>
            <div className="flex justify-center gap-1">
                {renderStars(critique.overallScore)}
            </div>
        </div>
        
        <div className="space-y-6">
            <div>
                <h4 className="font-semibold text-accent mb-2">Analysis</h4>
                <p className="text-text-light leading-relaxed">{critique.analysis}</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 className="font-semibold text-green-400 mb-2">Pros</h4>
                    <ul className="space-y-2">
                        {critique.pros.map((pro, index) => (
                            <li key={index} className="flex items-start">
                                <CheckIcon aria-hidden="true" className="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" />
                                <span className="text-text-light">{pro}</span>
                            </li>
                        ))}
                    </ul>
                </div>
                <div>
                    <h4 className="font-semibold text-yellow-400 mb-2">Cons & Considerations</h4>
                     <ul className="space-y-2">
                        {critique.cons.map((con, index) => (
                            <li key={index} className="flex items-start">
                                <span className="text-yellow-400 mr-2 mt-0.5 font-bold flex-shrink-0">!</span>
                                <span className="text-text-light">{con}</span>
                            </li>
                        ))}
                    </ul>
                </div>
            </div>
        </div>
      </div>
    </div>
  );
};

export default PairingCritiqueModal;


================================================================================
FILE PATH: components\PaperTexture.tsx
================================================================================
import React from 'react';

/**
 * PaperTexture component - Creates an SVG filter for realistic paper texture effect
 * Used to give the header a letterpress/embossed appearance
 */
export const PaperTexture: React.FC = () => {
  return (
    <svg width="0" height="0" style={{ position: 'absolute' }}>
      <defs>
        {/* Paper texture filter */}
        <filter id="paper-texture" x="0%" y="0%" width="100%" height="100%">
          {/* Create noise pattern for paper grain */}
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.65"
            numOctaves="3"
            seed="2"
            result="noise"
          />

          {/* Diffuse lighting for 3D paper effect */}
          <feDiffuseLighting
            in="noise"
            lightingColor="#FFFFFF"
            surfaceScale="1.5"
            result="light"
          >
            <feDistantLight azimuth="45" elevation="60" />
          </feDiffuseLighting>

          {/* Blend the lighting with the noise */}
          <feComposite
            in="SourceGraphic"
            in2="light"
            operator="arithmetic"
            k1="0"
            k2="1"
            k3="0.15"
            k4="0"
            result="composite"
          />

          {/* Subtle color shift for paper warmth */}
          <feColorMatrix
            type="matrix"
            values="1 0 0 0 0
                    0 0.98 0 0 0
                    0 0 0.92 0 0
                    0 0 0 1 0"
            result="paper"
          />
        </filter>

        {/* Embossed/debossed effect for text and icons */}
        <filter id="embossed-element">
          {/* Create depth with offset shadows */}
          <feGaussianBlur in="SourceAlpha" stdDeviation="1" result="blur" />
          <feOffset in="blur" dx="1" dy="1" result="offsetBlur" />

          {/* Light highlight */}
          <feFlood floodColor="#FFFFFF" floodOpacity="0.6" result="light" />
          <feComposite in="light" in2="offsetBlur" operator="in" result="lightShadow" />

          {/* Dark shadow for depth */}
          <feOffset in="blur" dx="-1" dy="-1" result="offsetDark" />
          <feFlood floodColor="#000000" floodOpacity="0.25" result="dark" />
          <feComposite in="dark" in2="offsetDark" operator="in" result="darkShadow" />

          {/* Combine shadows */}
          <feMerge>
            <feMergeNode in="darkShadow" />
            <feMergeNode in="lightShadow" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>
    </svg>
  );
};

export default PaperTexture;


================================================================================
FILE PATH: components\ProjectPanel.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import type { Project, FontAnalysis, PairingCritique } from '../types';
import {
    getAllProjects,
    createProject,
    deleteProject,
    setActiveProject,
    getActiveProject,
    addPairingToProject,
    getProjectStats,
    PROJECT_COLORS,
    updateProject
} from '../services/projectService';

interface ProjectPanelProps {
    isOpen: boolean;
    onClose: () => void;
    currentLeftFont: FontAnalysis | null;
    currentRightFont: FontAnalysis | null;
    currentCritique: PairingCritique | null;
    leftPreview?: string;
    rightPreview?: string;
    onProjectChange?: (project: Project | null) => void;
}

const ProjectPanel: React.FC<ProjectPanelProps> = ({
    isOpen,
    onClose,
    currentLeftFont,
    currentRightFont,
    currentCritique,
    leftPreview,
    rightPreview,
    onProjectChange
}) => {
    const [projects, setProjects] = useState<Project[]>([]);
    const [activeProject, setActiveProjectState] = useState<Project | null>(null);
    const [isCreating, setIsCreating] = useState(false);
    const [newProjectName, setNewProjectName] = useState('');
    const [newProjectColor, setNewProjectColor] = useState(PROJECT_COLORS[0]);
    const [editingProjectId, setEditingProjectId] = useState<string | null>(null);
    const [editingName, setEditingName] = useState('');

    // Load projects on mount and when panel opens
    useEffect(() => {
        if (isOpen) {
            refreshProjects();
        }
    }, [isOpen]);

    const refreshProjects = () => {
        const allProjects = getAllProjects();
        setProjects(allProjects);
        const active = getActiveProject();
        setActiveProjectState(active);
        onProjectChange?.(active);
    };

    const handleCreateProject = () => {
        if (!newProjectName.trim()) return;

        const project = createProject(newProjectName.trim(), undefined, newProjectColor);
        setNewProjectName('');
        setNewProjectColor(PROJECT_COLORS[0]);
        setIsCreating(false);
        refreshProjects();
    };

    const handleSelectProject = (projectId: string) => {
        setActiveProject(projectId);
        refreshProjects();
    };

    const handleDeleteProject = (projectId: string, e: React.MouseEvent) => {
        e.stopPropagation();
        if (confirm('Are you sure you want to delete this project? All pairings will be lost.')) {
            deleteProject(projectId);
            refreshProjects();
        }
    };

    const handleSaveCurrentPairing = () => {
        if (!activeProject) {
            alert('Please select or create a project first');
            return;
        }

        if (!currentLeftFont && !currentRightFont) {
            alert('No fonts to save. Analyze at least one font first.');
            return;
        }

        addPairingToProject(
            activeProject.id,
            currentLeftFont,
            currentRightFont,
            leftPreview,
            rightPreview,
            currentCritique || undefined
        );

        refreshProjects();
        alert('Pairing saved to project!');
    };

    const handleStartEditing = (project: Project, e: React.MouseEvent) => {
        e.stopPropagation();
        setEditingProjectId(project.id);
        setEditingName(project.name);
    };

    const handleSaveEdit = (projectId: string) => {
        if (editingName.trim()) {
            updateProject(projectId, { name: editingName.trim() });
            refreshProjects();
        }
        setEditingProjectId(null);
    };

    const formatDate = (timestamp: number) => {
        const date = new Date(timestamp);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    };

    if (!isOpen) return null;

    return (
        <>
            {/* Backdrop overlay - click to close */}
            <div
                className="fixed inset-0 bg-black/40 z-40"
                onClick={onClose}
                aria-hidden="true"
            />

            {/* Panel */}
            <div
                className="fixed inset-y-0 left-0 w-80 bg-surface border-r border-border shadow-2xl z-50 flex flex-col animate-slide-in-left"
                style={{ animation: 'slideInLeft 0.3s ease-out' }}
            >
            {/* Header */}
            <div className="p-4 border-b border-border flex items-center justify-between">
                <h2 className="text-lg font-bold text-primary">Projects</h2>
                <button
                    onClick={onClose}
                    className="text-secondary hover:text-primary transition-colors p-1"
                    aria-label="Close panel"
                >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            {/* Save Current Button */}
            {(currentLeftFont || currentRightFont) && (
                <div className="p-3 border-b border-border">
                    <button
                        onClick={handleSaveCurrentPairing}
                        className="w-full px-4 py-2 bg-accent text-surface font-bold rounded-lg hover:opacity-90 transition-all flex items-center justify-center gap-2"
                    >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                        </svg>
                        Save Current Pairing
                    </button>
                </div>
            )}

            {/* Projects List */}
            <div className="flex-1 overflow-y-auto p-3">
                {projects.length === 0 && !isCreating ? (
                    <div className="text-center py-8 text-secondary">
                        <svg className="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                        </svg>
                        <p className="text-sm mb-4">No projects yet</p>
                        <button
                            onClick={() => setIsCreating(true)}
                            className="text-accent hover:underline text-sm"
                        >
                            Create your first project
                        </button>
                    </div>
                ) : (
                    <div className="space-y-2">
                        {projects.map(project => {
                            const stats = getProjectStats(project.id);
                            const isActive = activeProject?.id === project.id;
                            const isEditing = editingProjectId === project.id;

                            return (
                                <div
                                    key={project.id}
                                    onClick={() => !isEditing && handleSelectProject(project.id)}
                                    className={`p-3 rounded-lg cursor-pointer transition-all ${
                                        isActive
                                            ? 'bg-accent/20 border-2 border-accent'
                                            : 'bg-teal-dark/50 border border-teal-medium hover:border-accent/50'
                                    }`}
                                >
                                    <div className="flex items-start justify-between gap-2">
                                        <div className="flex items-center gap-2 flex-1 min-w-0">
                                            {project.color && (
                                                <span
                                                    className="w-3 h-3 rounded-full flex-shrink-0"
                                                    style={{ backgroundColor: project.color }}
                                                />
                                            )}
                                            {isEditing ? (
                                                <input
                                                    type="text"
                                                    value={editingName}
                                                    onChange={(e) => setEditingName(e.target.value)}
                                                    onKeyDown={(e) => {
                                                        if (e.key === 'Enter') handleSaveEdit(project.id);
                                                        if (e.key === 'Escape') setEditingProjectId(null);
                                                    }}
                                                    onBlur={() => handleSaveEdit(project.id)}
                                                    className="flex-1 bg-transparent border-b border-accent text-primary text-sm font-semibold focus:outline-none"
                                                    autoFocus
                                                    onClick={(e) => e.stopPropagation()}
                                                />
                                            ) : (
                                                <span className="text-primary font-semibold text-sm truncate">
                                                    {project.name}
                                                </span>
                                            )}
                                        </div>
                                        <div className="flex items-center gap-1 flex-shrink-0">
                                            <button
                                                onClick={(e) => handleStartEditing(project, e)}
                                                className="p-1 text-secondary hover:text-accent transition-colors"
                                                title="Edit name"
                                            >
                                                <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                                </svg>
                                            </button>
                                            <button
                                                onClick={(e) => handleDeleteProject(project.id, e)}
                                                className="p-1 text-secondary hover:text-red-400 transition-colors"
                                                title="Delete project"
                                            >
                                                <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Project Stats */}
                                    <div className="mt-2 flex items-center gap-3 text-xs text-secondary">
                                        <span>{stats?.totalPairings || 0} pairings</span>
                                        <span>{stats?.uniqueFonts || 0} fonts</span>
                                        {stats?.averageScore && (
                                            <span className="text-accent">{stats.averageScore}/10 avg</span>
                                        )}
                                    </div>

                                    <div className="mt-1 text-xs text-secondary/70">
                                        Updated {formatDate(project.updatedAt)}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                )}

                {/* Create Project Form */}
                {isCreating && (
                    <div className="mt-3 p-3 bg-teal-dark/70 rounded-lg border border-teal-medium">
                        <input
                            type="text"
                            placeholder="Project name..."
                            value={newProjectName}
                            onChange={(e) => setNewProjectName(e.target.value)}
                            onKeyDown={(e) => {
                                if (e.key === 'Enter') handleCreateProject();
                                if (e.key === 'Escape') setIsCreating(false);
                            }}
                            className="w-full bg-transparent border-b border-accent/50 text-primary text-sm py-1 px-0 placeholder-secondary focus:outline-none focus:border-accent"
                            autoFocus
                        />

                        {/* Color Picker */}
                        <div className="flex items-center gap-2 mt-3">
                            <span className="text-xs text-secondary">Color:</span>
                            <div className="flex gap-1">
                                {PROJECT_COLORS.map(color => (
                                    <button
                                        key={color}
                                        onClick={() => setNewProjectColor(color)}
                                        className={`w-5 h-5 rounded-full transition-transform ${
                                            newProjectColor === color ? 'scale-125 ring-2 ring-white/50' : 'hover:scale-110'
                                        }`}
                                        style={{ backgroundColor: color }}
                                    />
                                ))}
                            </div>
                        </div>

                        <div className="flex gap-2 mt-3">
                            <button
                                onClick={handleCreateProject}
                                disabled={!newProjectName.trim()}
                                className="flex-1 px-3 py-1.5 bg-accent text-surface text-sm font-semibold rounded-md hover:opacity-90 disabled:opacity-50 transition-all"
                            >
                                Create
                            </button>
                            <button
                                onClick={() => {
                                    setIsCreating(false);
                                    setNewProjectName('');
                                }}
                                className="px-3 py-1.5 bg-secondary/30 text-primary text-sm font-semibold rounded-md hover:bg-secondary/50 transition-colors"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                )}
            </div>

            {/* Footer */}
            <div className="p-3 border-t border-border">
                {!isCreating && (
                    <button
                        onClick={() => setIsCreating(true)}
                        className="w-full px-4 py-2 bg-secondary/30 text-primary font-semibold rounded-lg hover:bg-secondary/50 transition-colors flex items-center justify-center gap-2"
                    >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                        </svg>
                        New Project
                    </button>
                )}
            </div>
        </div>
        </>
    );
};

export default ProjectPanel;


================================================================================
FILE PATH: components\SettingsModal.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import { CloseIcon, CheckIcon, CopyIcon } from './Icons';
import { getAPIKey, setAPIKey, clearAPIKey, getChromeAIStatus } from '../utils/aiSettings';
import {
    getStoredLicense,
    getLicenseInfo,
    deactivateDevice,
    getDeviceFingerprint,
    type LicenseInfo
} from '../services/licenseService';
import { clearCache, getCacheStats } from '../utils/fontCache';
import { getProjectsState } from '../services/projectService';

interface SettingsModalProps {
    isOpen: boolean;
    onClose: () => void;
    onRestartTour?: () => void;
}

const SettingsModal: React.FC<SettingsModalProps> = ({ isOpen, onClose, onRestartTour }) => {
    const [apiKey, setApiKeyState] = useState('');
    const [isSaving, setIsSaving] = useState(false);
    const [saveMessage, setSaveMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);
    const [chromeAIStatus, setChromeAIStatus] = useState<{
        available: boolean;
        status: string;
        message: string;
        details?: string;
    } | null>(null);
    const [isCheckingChromeAI, setIsCheckingChromeAI] = useState(false);
    const [copiedFlag, setCopiedFlag] = useState<string | null>(null);

    // License management state
    const [licenseInfo, setLicenseInfo] = useState<LicenseInfo | null>(null);
    const [deviceFingerprint, setDeviceFingerprint] = useState<string>('');
    const [isLoadingLicense, setIsLoadingLicense] = useState(false);
    const [isDeactivating, setIsDeactivating] = useState(false);
    const [licenseMessage, setLicenseMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);

    // Cache management state
    const [cacheStats, setCacheStats] = useState<{
        totalEntries: number;
        totalSize: number;
        oldestEntry: number | null;
        newestEntry: number | null;
    } | null>(null);
    const [isClearingCache, setIsClearingCache] = useState(false);
    const [cacheMessage, setCacheMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);

    // Data export/import state
    const [dataMessage, setDataMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);
    const [autoSaveEnabled, setAutoSaveEnabled] = useState(() => {
        return localStorage.getItem('cadmus_auto_save') === 'true';
    });
    const [autoSaveInterval, setAutoSaveIntervalState] = useState(() => {
        return parseInt(localStorage.getItem('cadmus_auto_save_interval') || '10', 10);
    });

    const handleAutoSaveToggle = (enabled: boolean) => {
        setAutoSaveEnabled(enabled);
        localStorage.setItem('cadmus_auto_save', enabled.toString());
        if (enabled) {
            setDataMessage({ type: 'success', text: `Auto-save enabled! Data will be saved every ${autoSaveInterval} minutes.` });
        } else {
            setDataMessage({ type: 'success', text: 'Auto-save disabled.' });
        }
        setTimeout(() => setDataMessage(null), 3000);
    };

    const handleAutoSaveIntervalChange = (minutes: number) => {
        setAutoSaveIntervalState(minutes);
        localStorage.setItem('cadmus_auto_save_interval', minutes.toString());
    };

    // Auto-save effect
    useEffect(() => {
        if (!autoSaveEnabled) return;

        const intervalMs = autoSaveInterval * 60 * 1000;
        const timer = setInterval(() => {
            try {
                const exportData = {
                    version: 1,
                    exportedAt: new Date().toISOString(),
                    projects: getProjectsState(),
                    history: localStorage.getItem('cadmus_font_history'),
                    cache: localStorage.getItem('cadmus_font_cache'),
                    settings: {
                        apiKey: getAPIKey(),
                        aiMode: localStorage.getItem('cadmus_ai_mode')
                    }
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fontpair-autosave-${new Date().toISOString().replace(/[:.]/g, '-')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('Auto-save completed:', new Date().toLocaleTimeString());
            } catch (error) {
                console.error('Auto-save failed:', error);
            }
        }, intervalMs);

        return () => clearInterval(timer);
    }, [autoSaveEnabled, autoSaveInterval]);

    const handleExportAllData = () => {
        try {
            const exportData = {
                version: 1,
                exportedAt: new Date().toISOString(),
                projects: getProjectsState(),
                history: localStorage.getItem('cadmus_font_history'),
                cache: localStorage.getItem('cadmus_font_cache'),
                settings: {
                    apiKey: getAPIKey(),
                    aiMode: localStorage.getItem('cadmus_ai_mode')
                }
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fontpair-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            setDataMessage({ type: 'success', text: 'Data exported successfully!' });
            setTimeout(() => setDataMessage(null), 3000);
        } catch (error) {
            console.error('Export error:', error);
            setDataMessage({ type: 'error', text: 'Failed to export data' });
            setTimeout(() => setDataMessage(null), 3000);
        }
    };

    const handleImportData = (event: React.ChangeEvent<HTMLInputElement>) => {
        const file = event.target.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importData = JSON.parse(e.target?.result as string);

                if (!importData.version || !importData.projects) {
                    throw new Error('Invalid backup file format');
                }

                // Confirm before overwriting
                if (!confirm('This will replace your current projects and settings. Continue?')) {
                    return;
                }

                // Import projects
                if (importData.projects) {
                    localStorage.setItem('cadmus_projects', JSON.stringify(importData.projects));
                }

                // Import history
                if (importData.history) {
                    localStorage.setItem('cadmus_font_history', importData.history);
                }

                // Import cache (optional)
                if (importData.cache) {
                    localStorage.setItem('cadmus_font_cache', importData.cache);
                }

                // Import settings
                if (importData.settings?.apiKey) {
                    setAPIKey(importData.settings.apiKey);
                    setApiKeyState(importData.settings.apiKey);
                }
                if (importData.settings?.aiMode) {
                    localStorage.setItem('cadmus_ai_mode', importData.settings.aiMode);
                }

                setDataMessage({ type: 'success', text: 'Data imported successfully! Refresh the page to see changes.' });
                loadCacheStats();
            } catch (error) {
                console.error('Import error:', error);
                setDataMessage({ type: 'error', text: 'Failed to import data. Invalid file format.' });
                setTimeout(() => setDataMessage(null), 3000);
            }
        };
        reader.readAsText(file);

        // Reset the input
        event.target.value = '';
    };

    useEffect(() => {
        if (isOpen) {
            // Load current API key
            const currentKey = getAPIKey();
            setApiKeyState(currentKey);

            // Check Chrome AI status
            checkChromeAI();

            // Load license information
            loadLicenseInfo();

            // Load cache statistics
            loadCacheStats();
        }
    }, [isOpen]);

    const loadLicenseInfo = async () => {
        setIsLoadingLicense(true);
        try {
            const stored = getStoredLicense();
            if (stored) {
                const fingerprint = await getDeviceFingerprint();
                setDeviceFingerprint(fingerprint);

                const info = await getLicenseInfo();
                setLicenseInfo(info);
            }
        } catch (error) {
            console.error('Error loading license info:', error);
        } finally {
            setIsLoadingLicense(false);
        }
    };

    const handleDeactivate = async () => {
        if (!confirm('Are you sure you want to deactivate this device? You will need to re-enter your license key to use FontPair AI on this device again.')) {
            return;
        }

        setIsDeactivating(true);
        setLicenseMessage(null);

        try {
            const result = await deactivateDevice();
            if (result.success) {
                setLicenseMessage({ type: 'success', text: 'Device deactivated successfully. Please restart the app.' });
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                setLicenseMessage({ type: 'error', text: result.error || 'Failed to deactivate device' });
            }
        } catch (error) {
            setLicenseMessage({ type: 'error', text: 'An error occurred during deactivation' });
        } finally {
            setIsDeactivating(false);
        }
    };

    const loadCacheStats = () => {
        try {
            const stats = getCacheStats();
            setCacheStats(stats);
        } catch (error) {
            console.error('Error loading cache stats:', error);
        }
    };

    const handleClearCache = () => {
        if (!confirm('Are you sure you want to clear all cached font analyses? This will make future analyses take longer until they are cached again.')) {
            return;
        }

        setIsClearingCache(true);
        setCacheMessage(null);

        try {
            clearCache();
            setCacheMessage({ type: 'success', text: 'Cache cleared successfully!' });
            loadCacheStats(); // Refresh stats
            setTimeout(() => setCacheMessage(null), 3000);
        } catch (error) {
            setCacheMessage({ type: 'error', text: 'Failed to clear cache' });
            setTimeout(() => setCacheMessage(null), 3000);
        } finally {
            setIsClearingCache(false);
        }
    };

    // Auto-refresh when downloading
    useEffect(() => {
        if (chromeAIStatus?.status === 'after-download' && isOpen) {
            const interval = setInterval(() => {
                checkChromeAI();
            }, 30000); // Check every 30 seconds

            return () => clearInterval(interval);
        }
    }, [chromeAIStatus?.status, isOpen]);

    const checkChromeAI = async () => {
        setIsCheckingChromeAI(true);
        const status = await getChromeAIStatus();
        setChromeAIStatus(status);
        setIsCheckingChromeAI(false);
    };

    const handleCopyToClipboard = (text: string, flagName: string) => {
        navigator.clipboard.writeText(text);
        setCopiedFlag(flagName);
        setTimeout(() => setCopiedFlag(null), 2000);
    };

    const handleSaveAPIKey = () => {
        setIsSaving(true);
        try {
            setAPIKey(apiKey);
            setSaveMessage({ type: 'success', text: 'API key saved successfully!' });
            setTimeout(() => setSaveMessage(null), 3000);
        } catch (error) {
            setSaveMessage({ type: 'error', text: 'Failed to save API key' });
            setTimeout(() => setSaveMessage(null), 3000);
        } finally {
            setIsSaving(false);
        }
    };

    const handleClearAPIKey = () => {
        clearAPIKey();
        setApiKeyState('');
        setSaveMessage({ type: 'success', text: 'API key cleared' });
        setTimeout(() => setSaveMessage(null), 3000);
    };

    if (!isOpen) return null;

    const hasAPIKey = apiKey.trim().length > 0;

    const flags = [
        {
            name: 'optimization-guide-on-device-model',
            url: 'chrome://flags/#optimization-guide-on-device-model',
            value: 'Enabled BypassPerfRequirement',
            description: 'Enables on-device AI model'
        },
        {
            name: 'prompt-api-for-gemini-nano',
            url: 'chrome://flags/#prompt-api-for-gemini-nano',
            value: 'Enabled',
            description: 'Enables Prompt API for Gemini Nano'
        }
    ];

    return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div className="paper-modal rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                {/* Header */}
                <div className="sticky top-0 bg-surface/90 backdrop-blur-sm border-b border-teal-medium/30 p-6 flex justify-between items-center">
                    <h2 className="text-2xl font-bold text-text-light">AI Settings</h2>
                    <button
                        onClick={onClose}
                        className="text-teal-light hover:text-text-light transition-colors"
                        aria-label="Close settings"
                    >
                        <CloseIcon className="w-6 h-6" />
                    </button>
                </div>

                {/* Content */}
                <div className="p-6 space-y-8">
                    {/* License Management Section - MOST IMPORTANT */}
                    <section className="space-y-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <h3 className="text-xl font-semibold text-text-light">License Management</h3>
                                {licenseInfo?.found && licenseInfo.isActive && (
                                    <span className="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300 flex items-center gap-1">
                                        <CheckIcon className="w-3 h-3" />
                                        Active
                                    </span>
                                )}
                            </div>
                            <button
                                onClick={loadLicenseInfo}
                                disabled={isLoadingLicense}
                                className="px-4 py-2 bg-teal-medium/50 text-text-light text-sm font-semibold rounded-md hover:bg-teal-medium/70 transition-colors disabled:opacity-50 border border-teal-light/20"
                            >
                                {isLoadingLicense ? 'Loading...' : 'Refresh'}
                            </button>
                        </div>

                        <div className="bg-teal-dark/40 rounded-lg p-4 space-y-4 border border-teal-light/10">
                            {isLoadingLicense ? (
                                <div className="text-center py-8">
                                    <p className="text-teal-light">Loading license information...</p>
                                </div>
                            ) : licenseInfo?.found ? (
                                <>
                                    {/* License Key Display */}
                                    <div className="space-y-2">
                                        <label className="block text-sm font-medium text-text-light">License Key</label>
                                        <div className="flex items-center gap-2">
                                            <div className="flex-1 px-4 py-2 bg-teal-dark border border-teal-medium/30 rounded-md font-mono text-sm text-teal-light">
                                                {licenseInfo.licenseKey ?
                                                    `${licenseInfo.licenseKey.slice(0, 4)}-****-****-${licenseInfo.licenseKey.slice(-4)}`
                                                    : '****-****-****-****'}
                                            </div>
                                            <button
                                                onClick={() => {
                                                    if (licenseInfo.licenseKey) {
                                                        navigator.clipboard.writeText(licenseInfo.licenseKey);
                                                        setLicenseMessage({ type: 'success', text: 'License key copied to clipboard!' });
                                                        setTimeout(() => setLicenseMessage(null), 2000);
                                                    }
                                                }}
                                                className="px-4 py-2 bg-accent text-text-light font-semibold rounded-md hover:bg-accent-dark transition-colors flex items-center gap-2 shadow-md"
                                            >
                                                <CopyIcon className="w-4 h-4" />
                                                Copy
                                            </button>
                                        </div>
                                    </div>

                                    {/* Device Information */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className="block text-sm font-medium text-text-light">Device Fingerprint</label>
                                            <div className="px-4 py-2 bg-teal-dark border border-teal-medium/30 rounded-md font-mono text-xs text-teal-light">
                                                {deviceFingerprint ? `${deviceFingerprint.slice(0, 12)}...` : 'Loading...'}
                                            </div>
                                        </div>

                                        <div className="space-y-2">
                                            <label className="block text-sm font-medium text-text-light">Device Status</label>
                                            <div className="px-4 py-2 bg-teal-dark border border-teal-medium/30 rounded-md text-sm text-text-light">
                                                {licenseInfo.activeDevices} of {licenseInfo.maxDevices} devices active
                                            </div>
                                        </div>
                                    </div>

                                    {/* Expiry Information */}
                                    {licenseInfo.expiresAt && (
                                        <div className="space-y-2">
                                            <label className="block text-sm font-medium text-text-light">Expires</label>
                                            <div className="px-4 py-2 bg-teal-dark border border-teal-medium/30 rounded-md text-sm text-text-light">
                                                {new Date(licenseInfo.expiresAt).toLocaleDateString()}
                                            </div>
                                        </div>
                                    )}

                                    {/* Active Devices List */}
                                    {licenseInfo.activations && licenseInfo.activations.length > 0 && (
                                        <div className="space-y-2">
                                            <label className="block text-sm font-medium text-text-light">Active Devices</label>
                                            <div className="space-y-2">
                                                {licenseInfo.activations.map((activation, index) => (
                                                    <div
                                                        key={index}
                                                        className={`px-4 py-3 rounded-md border ${
                                                            activation.isCurrent
                                                                ? 'bg-accent/20 border-accent/40'
                                                                : 'bg-teal-dark border-teal-medium/30'
                                                        }`}
                                                    >
                                                        <div className="flex items-center justify-between">
                                                            <div className="space-y-1">
                                                                <p className="text-sm font-medium text-text-light">
                                                                    {activation.deviceName || `Device ${index + 1}`}
                                                                    {activation.isCurrent && (
                                                                        <span className="ml-2 text-xs text-accent font-semibold">(This Device)</span>
                                                                    )}
                                                                </p>
                                                                <p className="text-xs text-teal-light font-mono">
                                                                    {activation.deviceFingerprint}
                                                                </p>
                                                                <p className="text-xs text-teal-light">
                                                                    Last used: {new Date(activation.lastUsed).toLocaleDateString()}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Deactivate Button */}
                                    <div className="pt-2">
                                        <button
                                            onClick={handleDeactivate}
                                            disabled={isDeactivating}
                                            className="w-full px-4 py-3 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md border border-red-500"
                                        >
                                            {isDeactivating ? 'Deactivating...' : 'Deactivate This Device'}
                                        </button>
                                        <p className="text-xs text-teal-light mt-2 text-center">
                                            Deactivating will free up a device slot. You'll need to re-enter your license key to reactivate.
                                        </p>
                                    </div>

                                    {/* Status Messages */}
                                    {licenseMessage && (
                                        <div className={`text-sm p-3 rounded-md ${
                                            licenseMessage.type === 'success'
                                                ? 'bg-green-500/10 text-green-300 border border-green-500/20'
                                                : 'bg-red-500/10 text-red-300 border border-red-500/20'
                                        }`}>
                                            {licenseMessage.text}
                                        </div>
                                    )}
                                </>
                            ) : (
                                <div className="text-center py-8 space-y-3">
                                    <p className="text-secondary">No license information available</p>
                                    <p className="text-xs text-secondary/70">
                                        Your license should have been validated when you first launched the app.
                                    </p>
                                </div>
                            )}
                        </div>
                    </section>

                    {/* Divider */}
                    <div className="border-t border-teal-medium/30"></div>

                    {/* Cache Management Section */}
                    <section className="space-y-4">
                        <div className="flex items-center justify-between">
                            <h3 className="text-xl font-semibold text-text-light">Cache Management</h3>
                            <button
                                onClick={loadCacheStats}
                                className="px-4 py-2 bg-teal-medium/50 text-text-light text-sm font-semibold rounded-md hover:bg-teal-medium/70 transition-colors border border-teal-light/20"
                            >
                                Refresh Stats
                            </button>
                        </div>

                        <div className="bg-teal-dark/40 rounded-lg p-4 space-y-4 border border-teal-light/10">
                            <p className="text-sm text-teal-light">
                                FontPair AI caches font analyses locally to speed up repeated analyses. Cached analyses load instantly without requiring AI processing.
                            </p>

                            {cacheStats && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-teal-dark border border-teal-medium/30 rounded-md p-3">
                                        <p className="text-xs text-teal-light mb-1">Total Cached Analyses</p>
                                        <p className="text-2xl font-bold text-text-light">{cacheStats.totalEntries}</p>
                                    </div>
                                    <div className="bg-teal-dark border border-teal-medium/30 rounded-md p-3">
                                        <p className="text-xs text-teal-light mb-1">Cache Size</p>
                                        <p className="text-2xl font-bold text-text-light">
                                            {(cacheStats.totalSize / 1024).toFixed(1)} KB
                                        </p>
                                    </div>
                                </div>
                            )}

                            {cacheStats && cacheStats.totalEntries > 0 && (
                                <>
                                    <div className="pt-2">
                                        <button
                                            onClick={handleClearCache}
                                            disabled={isClearingCache}
                                            className="w-full px-4 py-3 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md border border-red-500"
                                        >
                                            {isClearingCache ? 'Clearing...' : 'Clear All Cached Analyses'}
                                        </button>
                                        <p className="text-xs text-teal-light mt-2 text-center">
                                            Clearing the cache will free up storage space. Analyses will be cached again when you use them.
                                        </p>
                                    </div>

                                    {cacheMessage && (
                                        <div className={`text-sm p-3 rounded-md ${
                                            cacheMessage.type === 'success'
                                                ? 'bg-green-500/10 text-green-300 border border-green-500/20'
                                                : 'bg-red-500/10 text-red-300 border border-red-500/20'
                                        }`}>
                                            {cacheMessage.text}
                                        </div>
                                    )}
                                </>
                            )}

                            {cacheStats && cacheStats.totalEntries === 0 && (
                                <div className="text-center py-4">
                                    <p className="text-teal-light text-sm">No cached analyses yet. Analyze some fonts to see them cached here!</p>
                                </div>
                            )}
                        </div>
                    </section>

                    {/* Divider */}
                    <div className="border-t border-teal-medium/30"></div>

                    {/* Help & Onboarding Section */}
                    <section className="space-y-4">
                        <h3 className="text-xl font-semibold text-text-light">Help & Onboarding</h3>

                        <div className="bg-teal-dark/40 rounded-lg p-4 border border-teal-light/10">
                            <button
                                onClick={onRestartTour}
                                className="w-full px-4 py-3 bg-teal-medium/50 border border-teal-light/20 rounded-lg text-text-light hover:bg-teal-medium/70 hover:border-accent/40 transition-colors text-left"
                            >
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="font-semibold">Restart Onboarding Tour</p>
                                        <p className="text-teal-light text-sm mt-1">Show me around again</p>
                                    </div>
                                    <svg className="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" />
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </section>

                    {/* Divider */}
                    <div className="border-t border-teal-medium/30"></div>

                    {/* Data Backup Section */}
                    <section className="space-y-4">
                        <div className="flex items-center gap-2">
                            <h3 className="text-xl font-semibold text-text-light">Data Backup</h3>
                            <span className="text-xs px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-300 flex items-center gap-1">
                                <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                                Important
                            </span>
                        </div>

                        <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4">
                            <p className="text-sm text-yellow-200">
                                Your projects and history are stored in your browser's local storage.
                                <strong> Clearing browser data will permanently delete them.</strong>
                                Export your data regularly to keep backups safe.
                            </p>
                        </div>

                        <div className="bg-teal-dark/40 rounded-lg p-4 space-y-4 border border-teal-light/10">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* Export Button */}
                                <button
                                    onClick={handleExportAllData}
                                    className="px-4 py-4 bg-accent text-surface font-semibold rounded-lg hover:bg-accent/90 transition-colors flex flex-col items-center gap-2 shadow-md"
                                >
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    <span>Export All Data</span>
                                    <span className="text-xs opacity-80">Projects, history, settings</span>
                                </button>

                                {/* Import Button */}
                                <label className="px-4 py-4 bg-teal-medium/50 border border-teal-light/20 text-text-light font-semibold rounded-lg hover:bg-teal-medium/70 transition-colors flex flex-col items-center gap-2 cursor-pointer">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                    </svg>
                                    <span>Import Data</span>
                                    <span className="text-xs text-teal-light">Restore from backup file</span>
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={handleImportData}
                                        className="hidden"
                                    />
                                </label>
                            </div>

                            {dataMessage && (
                                <div className={`text-sm p-3 rounded-md ${
                                    dataMessage.type === 'success'
                                        ? 'bg-green-500/10 text-green-300 border border-green-500/20'
                                        : 'bg-red-500/10 text-red-300 border border-red-500/20'
                                }`}>
                                    {dataMessage.text}
                                </div>
                            )}

                            <p className="text-xs text-teal-light">
                                Exported file includes: all projects with pairings, font analysis history, cached analyses, and API settings.
                            </p>

                            {/* Auto-save Option */}
                            <div className="border-t border-teal-medium/30 pt-4 mt-4">
                                <div className="flex items-center justify-between mb-3">
                                    <div>
                                        <p className="font-semibold text-text-light">Auto-save Backups</p>
                                        <p className="text-xs text-teal-light">Automatically download backup files periodically</p>
                                    </div>
                                    <label className="relative inline-flex items-center cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={autoSaveEnabled}
                                            onChange={(e) => handleAutoSaveToggle(e.target.checked)}
                                            className="sr-only peer"
                                        />
                                        <div className="w-11 h-6 bg-teal-dark peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-accent rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"></div>
                                    </label>
                                </div>

                                {autoSaveEnabled && (
                                    <div className="flex items-center gap-3">
                                        <label className="text-sm text-teal-light">Save every:</label>
                                        <select
                                            value={autoSaveInterval}
                                            onChange={(e) => handleAutoSaveIntervalChange(parseInt(e.target.value, 10))}
                                            className="px-3 py-1.5 bg-teal-dark border border-teal-medium/40 rounded-md text-text-light text-sm focus:outline-none focus:ring-2 focus:ring-accent"
                                        >
                                            <option value="5">5 minutes</option>
                                            <option value="10">10 minutes</option>
                                            <option value="15">15 minutes</option>
                                            <option value="30">30 minutes</option>
                                            <option value="60">1 hour</option>
                                        </select>
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>

                    {/* Divider */}
                    <div className="border-t border-teal-medium/30"></div>

                    {/* Gemini API Section - PRIMARY OPTION */}
                    <section className="space-y-4">
                        <div className="flex items-center gap-2">
                            <h3 className="text-xl font-semibold text-text-light">Gemini API Key (Recommended)</h3>
                            {hasAPIKey && (
                                <span className="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300 flex items-center gap-1">
                                    <CheckIcon className="w-3 h-3" />
                                    Ready
                                </span>
                            )}
                        </div>

                        <div className="bg-teal-dark/40 rounded-lg p-4 space-y-3 border border-accent/30">
                            <p className="text-sm text-text-light font-medium">
                                Cloud AI provides reliable, high-quality font analysis using Google's Gemini model.
                            </p>

                            <div className="space-y-2">
                                <p className="text-sm font-medium text-text-light">Get your free API key:</p>
                                <ol className="text-sm text-teal-light space-y-1 ml-4 list-decimal">
                                    <li>Visit <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className="text-accent hover:underline font-medium">Google AI Studio</a></li>
                                    <li>Sign in with your Google account</li>
                                    <li>Click "Get API Key" or "Create API Key"</li>
                                    <li>Copy the key and paste it below</li>
                                </ol>
                            </div>

                            <div className="pt-2">
                                <label htmlFor="api-key-input" className="block text-sm font-medium text-text-light mb-2">
                                    API Key
                                </label>
                                <input
                                    id="api-key-input"
                                    type="password"
                                    value={apiKey}
                                    onChange={(e) => setApiKeyState(e.target.value)}
                                    placeholder="Enter your Gemini API key..."
                                    className="w-full px-4 py-2 bg-teal-dark border border-teal-medium/40 rounded-md text-text-light placeholder-teal-light/50 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent"
                                />
                            </div>

                            <div className="flex gap-2">
                                <button
                                    onClick={handleSaveAPIKey}
                                    disabled={isSaving || !apiKey.trim()}
                                    className="px-4 py-2 bg-accent text-text-light font-semibold rounded-md hover:bg-accent-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md"
                                >
                                    {isSaving ? 'Saving...' : 'Save API Key'}
                                </button>
                                {hasAPIKey && (
                                    <button
                                        onClick={handleClearAPIKey}
                                        className="px-4 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition-colors shadow-md border border-red-500"
                                    >
                                        Clear Key
                                    </button>
                                )}
                            </div>

                            {saveMessage && (
                                <div className={`text-sm p-3 rounded-md ${
                                    saveMessage.type === 'success'
                                        ? 'bg-green-500/10 text-green-300 border border-green-500/20'
                                        : 'bg-red-500/10 text-red-300 border border-red-500/20'
                                }`}>
                                    {saveMessage.text}
                                </div>
                            )}

                            <div className="text-xs text-teal-light pt-2 space-y-1">
                                <p>Free tier limits: 15 requests/min, 1M tokens/day</p>
                                <p>Your API key is stored locally in your browser and never sent to our servers.</p>
                            </div>
                        </div>
                    </section>

                    {/* Divider */}
                    <div className="border-t border-teal-medium/30"></div>

                    {/* Chrome AI Section - EXPERIMENTAL/OPTIONAL */}
                    <section className="space-y-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <h3 className="text-lg font-semibold text-teal-light">Chrome AI (Experimental)</h3>
                                <span className="text-xs px-2 py-1 rounded-full bg-teal-medium/30 text-teal-light font-medium border border-teal-light/20">
                                    Beta
                                </span>
                                {chromeAIStatus && chromeAIStatus.status === 'readily' && (
                                    <span className="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300">
                                        {chromeAIStatus.message}
                                    </span>
                                )}
                            </div>
                            <button
                                onClick={checkChromeAI}
                                disabled={isCheckingChromeAI}
                                className="px-4 py-2 bg-teal-medium/50 text-text-light text-sm font-semibold rounded-md hover:bg-teal-medium/70 transition-colors disabled:opacity-50 border border-teal-light/20"
                            >
                                {isCheckingChromeAI ? 'Checking...' : 'Check Status'}
                            </button>
                        </div>

                        <div className="bg-teal-dark/40 rounded-lg p-5 space-y-4 opacity-90 border border-teal-light/10">
                            <p className="text-sm text-teal-light">
                                Chrome AI is an experimental feature that runs locally in your browser. It may not work on all systems.
                                <strong className="text-text-light"> For reliable results, use Cloud AI above.</strong>
                            </p>

                            {/* Status Details - Only show if ready or downloading */}
                            {chromeAIStatus?.details && (chromeAIStatus.status === 'readily' || chromeAIStatus.status === 'after-download') && (
                                <div className={`text-sm p-3 rounded-md ${
                                    chromeAIStatus.status === 'readily'
                                        ? 'bg-green-500/10 text-green-300 border border-green-500/20'
                                        : 'bg-blue-500/10 text-blue-300 border border-blue-500/20'
                                }`}>
                                    {chromeAIStatus.details}
                                </div>
                            )}

                            {/* Setup Instructions */}
                            {chromeAIStatus?.status !== 'readily' && (
                                <div className="space-y-4">
                                    <p className="text-sm text-teal-light font-medium">
                                        Chrome's built-in AI (Gemini Nano) runs locally in your browser for fast, free analysis.
                                    </p>

                                    <div className="space-y-3">
                                        <p className="text-sm font-semibold text-text-light">Step-by-Step Setup:</p>

                                        {/* Step 1 */}
                                        <div className="space-y-2">
                                            <p className="text-sm text-text-light font-medium">1. Enable Chrome Flags</p>
                                            <p className="text-xs text-teal-light">Copy each URL below and paste into your browser address bar:</p>

                                            {flags.map((flag) => (
                                                <div key={flag.name} className="bg-teal-dark/60 rounded-md p-3 space-y-2 border border-teal-medium/30">
                                                    <div className="flex items-center justify-between gap-2">
                                                        <code className="text-xs text-accent flex-1 break-all">
                                                            {flag.url}
                                                        </code>
                                                        <button
                                                            onClick={() => handleCopyToClipboard(flag.url, flag.name)}
                                                            className="px-3 py-1.5 bg-accent text-text-light text-xs font-semibold rounded hover:bg-accent-dark transition-colors flex items-center gap-1.5 whitespace-nowrap shadow-md"
                                                        >
                                                            {copiedFlag === flag.name ? (
                                                                <>
                                                                    <CheckIcon className="w-3 h-3" />
                                                                    Copied
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <CopyIcon className="w-3 h-3" />
                                                                    Copy
                                                                </>
                                                            )}
                                                        </button>
                                                    </div>
                                                    <div className="text-xs space-y-1">
                                                        <p className="text-teal-light">{flag.description}</p>
                                                        <p className="text-text-light">
                                                            Set to: <span className="font-semibold text-accent">{flag.value}</span>
                                                        </p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* Step 2 */}
                                        <div className="space-y-2">
                                            <p className="text-sm text-text-light font-medium">2. Restart Chrome</p>
                                            <p className="text-xs text-teal-light">
                                                After setting both flags, click "Relaunch" in Chrome or restart your browser completely.
                                            </p>
                                        </div>

                                        {/* Step 3 */}
                                        <div className="space-y-2">
                                            <p className="text-sm text-text-light font-medium">3. Wait for Model Download</p>
                                            <p className="text-xs text-teal-light">
                                                Chrome will download the AI model (5-10 minutes). This page auto-checks every 30 seconds when downloading.
                                            </p>
                                        </div>

                                        {/* Step 4 */}
                                        <div className="space-y-2">
                                            <p className="text-sm text-text-light font-medium">4. Verify Setup</p>
                                            <p className="text-xs text-teal-light">
                                                Click "Check Status" above to verify Chrome AI is ready. You can also test in DevTools:
                                            </p>
                                            <div className="bg-teal-dark/60 rounded-md p-3 border border-teal-medium/30">
                                                <div className="flex items-center justify-between gap-2">
                                                    <code className="text-xs text-accent">
                                                        await ai.languageModel.capabilities()
                                                    </code>
                                                    <button
                                                        onClick={() => handleCopyToClipboard('await ai.languageModel.capabilities()', 'test-command')}
                                                        className="px-3 py-1.5 bg-accent text-text-light text-xs font-semibold rounded hover:bg-accent-dark transition-colors flex items-center gap-1.5 shadow-md"
                                                    >
                                                        {copiedFlag === 'test-command' ? (
                                                            <>
                                                                <CheckIcon className="w-3 h-3" />
                                                                Copied
                                                            </>
                                                        ) : (
                                                            <>
                                                                <CopyIcon className="w-3 h-3" />
                                                                Copy
                                                            </>
                                                        )}
                                                    </button>
                                                </div>
                                                <p className="text-xs text-secondary mt-2">
                                                    Open DevTools (F12), paste in Console, and press Enter. Should return {`{ available: "readily" }`}
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Note about Chrome AI limitations */}
                                    <div className="bg-background border border-border/50 rounded-md p-3 space-y-1">
                                        <p className="text-xs text-secondary/70">
                                            <strong>Note:</strong> Chrome AI is experimental and may not work on all systems.
                                            Requires Chrome Canary/Dev, specific hardware, and may take 5-10 minutes to download the model.
                                            If setup fails, simply use Cloud AI instead for reliable results.
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </section>
                </div>
            </div>
        </div>
    );
};

export default SettingsModal;


================================================================================
FILE PATH: components\TypeScaleBuilder.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import type { FontAnalysis } from '../types';
import { generatePairingCSS } from '../pdfExportService';
import { CopyIcon, CheckIcon } from './Icons';

interface TypeLevel {
    id: string;
    label: string;
    size: string;
    weight: number;
    lineHeight: number;
    sampleText: string;
}

const TYPE_LEVELS: TypeLevel[] = [
    { id: 'h1', label: 'H1', size: '3.052rem', weight: 700, lineHeight: 1.1, sampleText: 'Main Headline' },
    { id: 'h2', label: 'H2', size: '2.441rem', weight: 700, lineHeight: 1.2, sampleText: 'Section Title' },
    { id: 'h3', label: 'H3', size: '1.953rem', weight: 600, lineHeight: 1.2, sampleText: 'Subsection Header' },
    { id: 'h4', label: 'H4', size: '1.563rem', weight: 600, lineHeight: 1.3, sampleText: 'Card Title' },
    { id: 'h5', label: 'H5', size: '1.25rem', weight: 600, lineHeight: 1.4, sampleText: 'Small Heading' },
    { id: 'body', label: 'Body', size: '1rem', weight: 400, lineHeight: 1.6, sampleText: 'Body text appears here. This is the main reading content for paragraphs and long-form text.' },
    { id: 'small', label: 'Small', size: '0.875rem', weight: 400, lineHeight: 1.5, sampleText: 'Smaller supporting text' },
    { id: 'caption', label: 'Caption', size: '0.75rem', weight: 400, lineHeight: 1.4, sampleText: 'Caption or label text' },
];

interface TypeScaleBuilderProps {
    isOpen: boolean;
    onClose: () => void;
    availableFonts: FontAnalysis[];
}

const TypeScaleBuilder: React.FC<TypeScaleBuilderProps> = ({ isOpen, onClose, availableFonts }) => {
    const [assignments, setAssignments] = useState<Record<string, FontAnalysis | null>>({
        h1: null,
        h2: null,
        h3: null,
        h4: null,
        h5: null,
        body: null,
        small: null,
        caption: null,
    });

    const [loadedFonts, setLoadedFonts] = useState<Set<string>>(new Set());
    const [copied, setCopied] = useState(false);
    const [exportFormat, setExportFormat] = useState<'css' | 'tailwind'>('css');

    // Load Google Fonts for preview
    const loadGoogleFont = (fontName: string) => {
        if (!fontName || loadedFonts.has(fontName)) return;
        const fontUrl = `https://fonts.googleapis.com/css2?family=${fontName.replace(/ /g, '+')}:wght@400;600;700&display=swap`;
        if (document.querySelector(`link[href="${fontUrl}"]`)) return;

        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = fontUrl;
        document.head.appendChild(link);
        setLoadedFonts(prev => new Set(prev).add(fontName));
    };

    // Load fonts when assignments change
    useEffect(() => {
        Object.values(assignments).forEach(font => {
            if (font) loadGoogleFont(font.fontName);
        });
    }, [assignments]);

    const handleAssignment = (levelId: string, fontIndex: number) => {
        if (fontIndex === -1) {
            setAssignments(prev => ({ ...prev, [levelId]: null }));
        } else {
            setAssignments(prev => ({ ...prev, [levelId]: availableFonts[fontIndex] }));
        }
    };

    const generateCSS = (): string => {
        const lines: string[] = [
            '/* Typography System - Type Scale */',
            '/* Generated by FontPair AI */',
            '',
            ':root {',
            '  /* Type Scale (Major Third - 1.25) */',
            '  --text-xs: 0.75rem;',
            '  --text-sm: 0.875rem;',
            '  --text-base: 1rem;',
            '  --text-lg: 1.25rem;',
            '  --text-xl: 1.563rem;',
            '  --text-2xl: 1.953rem;',
            '  --text-3xl: 2.441rem;',
            '  --text-4xl: 3.052rem;',
            '',
        ];

        // Add font family variables
        const usedFonts = new Set<string>();
        Object.entries(assignments).forEach(([level, font]) => {
            if (font) {
                usedFonts.add(font.fontName);
                const fallback = font.fontType.toLowerCase().includes('serif') && !font.fontType.toLowerCase().includes('sans')
                    ? 'serif'
                    : 'sans-serif';
                lines.push(`  --font-${level}: "${font.fontName}", ${fallback};`);
            }
        });

        lines.push('}', '');

        // Add element styles
        TYPE_LEVELS.forEach(level => {
            const font = assignments[level.id];
            if (font) {
                if (level.id.startsWith('h')) {
                    lines.push(`${level.id} {`);
                    lines.push(`  font-family: var(--font-${level.id});`);
                    lines.push(`  font-size: ${level.size};`);
                    lines.push(`  font-weight: ${level.weight};`);
                    lines.push(`  line-height: ${level.lineHeight};`);
                    lines.push('}', '');
                } else if (level.id === 'body') {
                    lines.push('body, p {');
                    lines.push(`  font-family: var(--font-body);`);
                    lines.push(`  font-size: ${level.size};`);
                    lines.push(`  font-weight: ${level.weight};`);
                    lines.push(`  line-height: ${level.lineHeight};`);
                    lines.push('}', '');
                } else {
                    lines.push(`.${level.id} {`);
                    lines.push(`  font-family: var(--font-${level.id});`);
                    lines.push(`  font-size: ${level.size};`);
                    lines.push(`  font-weight: ${level.weight};`);
                    lines.push(`  line-height: ${level.lineHeight};`);
                    lines.push('}', '');
                }
            }
        });

        // Add Google Fonts import
        if (usedFonts.size > 0) {
            const fontImports = Array.from(usedFonts)
                .map(f => `family=${f.replace(/\s+/g, '+')}:wght@400;600;700`)
                .join('&');
            lines.push(`/* Google Fonts Import */`);
            lines.push(`@import url('https://fonts.googleapis.com/css2?${fontImports}&display=swap');`);
        }

        return lines.join('\n');
    };

    const handleCopy = () => {
        const css = generateCSS();
        navigator.clipboard.writeText(css).then(() => {
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
        });
    };

    if (!isOpen) return null;

    return (
        <div
            className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-fade-in p-4"
            onClick={onClose}
        >
            <div
                className="bg-surface rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden border border-border shadow-2xl flex flex-col"
                onClick={e => e.stopPropagation()}
            >
                {/* Header */}
                <div className="p-6 border-b border-border flex-shrink-0">
                    <div className="flex items-center justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-primary">Type Scale Builder</h2>
                            <p className="text-secondary text-sm mt-1">
                                Assign fonts to different typography levels and preview your complete type system
                            </p>
                        </div>
                        <button
                            onClick={onClose}
                            className="text-secondary hover:text-primary transition-colors p-2"
                            aria-label="Close modal"
                        >
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                {/* Content */}
                <div className="flex-1 overflow-y-auto p-6">
                    {availableFonts.length === 0 ? (
                        <div className="text-center py-12 text-secondary">
                            <p className="mb-4">No fonts analyzed yet.</p>
                            <p className="text-sm">Analyze some fonts first, then return here to build your type scale.</p>
                        </div>
                    ) : (
                        <div className="grid lg:grid-cols-2 gap-6">
                            {/* Assignment Panel */}
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold text-accent mb-4">Assign Fonts</h3>
                                {TYPE_LEVELS.map(level => (
                                    <div key={level.id} className="flex items-center gap-4">
                                        <span className="text-primary font-semibold w-20">{level.label}</span>
                                        <select
                                            value={assignments[level.id] ? availableFonts.indexOf(assignments[level.id]!) : -1}
                                            onChange={(e) => handleAssignment(level.id, parseInt(e.target.value))}
                                            className="flex-1 bg-teal-dark border border-teal-medium rounded-md px-3 py-2 text-text-light text-sm focus:outline-none focus:border-accent"
                                        >
                                            <option value={-1}>Select font...</option>
                                            {availableFonts.map((font, index) => (
                                                <option key={index} value={index}>
                                                    {font.fontName} ({font.fontType})
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                ))}

                                {/* Quick Actions */}
                                <div className="pt-4 border-t border-border">
                                    <p className="text-sm text-secondary mb-2">Quick Actions:</p>
                                    <div className="flex gap-2 flex-wrap">
                                        {availableFonts.length >= 1 && (
                                            <button
                                                onClick={() => {
                                                    const headingFont = availableFonts[0];
                                                    setAssignments(prev => ({
                                                        ...prev,
                                                        h1: headingFont,
                                                        h2: headingFont,
                                                        h3: headingFont,
                                                        h4: headingFont,
                                                        h5: headingFont,
                                                    }));
                                                }}
                                                className="px-3 py-1.5 text-xs bg-secondary/30 text-primary rounded-md hover:bg-secondary/50 transition-colors"
                                            >
                                                All Headings â†’ {availableFonts[0].fontName}
                                            </button>
                                        )}
                                        {availableFonts.length >= 2 && (
                                            <button
                                                onClick={() => {
                                                    const bodyFont = availableFonts[1];
                                                    setAssignments(prev => ({
                                                        ...prev,
                                                        body: bodyFont,
                                                        small: bodyFont,
                                                        caption: bodyFont,
                                                    }));
                                                }}
                                                className="px-3 py-1.5 text-xs bg-secondary/30 text-primary rounded-md hover:bg-secondary/50 transition-colors"
                                            >
                                                All Body â†’ {availableFonts[1].fontName}
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Preview Panel */}
                            <div className="bg-paper-light rounded-lg p-6 border border-text-secondary/20">
                                <h3 className="text-lg font-semibold text-text-dark mb-4">Preview</h3>
                                <div className="space-y-4">
                                    {TYPE_LEVELS.map(level => {
                                        const font = assignments[level.id];
                                        return (
                                            <div
                                                key={level.id}
                                                className="pb-3 border-b border-text-secondary/10 last:border-0"
                                                style={{
                                                    fontFamily: font ? `'${font.fontName}', sans-serif` : 'inherit',
                                                    fontSize: level.size,
                                                    fontWeight: level.weight,
                                                    lineHeight: level.lineHeight,
                                                    color: font ? '#2B2624' : '#999',
                                                }}
                                            >
                                                {level.sampleText}
                                                {!font && (
                                                    <span className="text-xs ml-2 text-secondary">
                                                        (No font assigned)
                                                    </span>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}
                </div>

                {/* Footer */}
                {availableFonts.length > 0 && (
                    <div className="p-4 border-t border-border flex items-center justify-between">
                        <div className="flex items-center gap-2">
                            <span className="text-sm text-secondary">Export as:</span>
                            <button
                                onClick={() => setExportFormat('css')}
                                className={`px-3 py-1 text-sm rounded ${
                                    exportFormat === 'css'
                                        ? 'bg-accent text-surface'
                                        : 'bg-secondary/30 text-primary'
                                }`}
                            >
                                CSS
                            </button>
                            <button
                                onClick={() => setExportFormat('tailwind')}
                                className={`px-3 py-1 text-sm rounded ${
                                    exportFormat === 'tailwind'
                                        ? 'bg-accent text-surface'
                                        : 'bg-secondary/30 text-primary'
                                }`}
                            >
                                Tailwind
                            </button>
                        </div>
                        <button
                            onClick={handleCopy}
                            className={`px-4 py-2 font-semibold rounded-lg flex items-center gap-2 transition-colors ${
                                copied
                                    ? 'bg-green-500 text-white'
                                    : 'bg-accent text-surface hover:opacity-90'
                            }`}
                        >
                            {copied ? <CheckIcon className="w-4 h-4" /> : <CopyIcon className="w-4 h-4" />}
                            {copied ? 'Copied!' : 'Copy CSS'}
                        </button>
                    </div>
                )}
            </div>
        </div>
    );
};

export default TypeScaleBuilder;


================================================================================
FILE PATH: components\TypographyContextModal.tsx
================================================================================
import React, { useState, useEffect } from 'react';
import { createPortal } from 'react-dom';
import type { FontAnalysis, TypographyContextResult } from '../types';
import { getTypographyContext } from '../services/geminiService';
import Loader from './Loader';

interface TypographyContextModalProps {
    isOpen: boolean;
    onClose: () => void;
    fontAnalysis: FontAnalysis;
}

const TypographyContextModal: React.FC<TypographyContextModalProps> = ({
    isOpen,
    onClose,
    fontAnalysis
}) => {
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState<string | null>(null);
    const [result, setResult] = useState<TypographyContextResult | null>(null);

    useEffect(() => {
        if (isOpen && !result && !isLoading) {
            setIsLoading(true);
            setError(null);

            getTypographyContext(fontAnalysis)
                .then(setResult)
                .catch(err => {
                    console.error('Typography context error:', err);
                    setError(err.message || 'Failed to get typography context');
                })
                .finally(() => {
                    setIsLoading(false);
                });
        }
    }, [isOpen, fontAnalysis, result, isLoading]);

    if (!isOpen) return null;

    const modalContent = (
        <div
            className="fixed inset-0 bg-black/60 flex items-start justify-center z-[9999] animate-fade-in p-4 pt-8 overflow-y-auto"
            onClick={onClose}
        >
            <div
                className="bg-surface rounded-lg w-full max-w-4xl max-h-[85vh] overflow-hidden border border-border shadow-2xl flex flex-col my-4"
                onClick={e => e.stopPropagation()}
            >
                {/* Header */}
                <div className="p-6 border-b border-border flex-shrink-0">
                    <div className="flex items-center justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-primary">Typography Context & Trends</h2>
                            <p className="text-secondary text-sm mt-1">
                                Historical usage and current trends for <span className="text-accent font-semibold">{fontAnalysis.fontName}</span>
                            </p>
                            <p className="text-yellow-500/80 text-xs mt-2 flex items-center gap-1">
                                <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                                AI-generated insights - verify before using in professional work
                            </p>
                        </div>
                        <button
                            onClick={onClose}
                            className="text-secondary hover:text-primary transition-colors p-2"
                            aria-label="Close modal"
                        >
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                {/* Content */}
                <div className="flex-1 overflow-y-auto p-6">
                    {isLoading && (
                        <div className="flex flex-col items-center justify-center py-12">
                            <Loader />
                            <p className="text-secondary mt-4">Researching typography history and trends...</p>
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-center">
                            <p className="text-red-300">{error}</p>
                            <button
                                onClick={() => {
                                    setError(null);
                                    setResult(null);
                                }}
                                className="mt-3 px-4 py-2 bg-accent text-surface font-semibold rounded-lg hover:opacity-90 transition-opacity"
                            >
                                Try Again
                            </button>
                        </div>
                    )}

                    {result && (
                        <div className="space-y-6">
                            {/* Historical Usage */}
                            <Section title="Historical Usage" icon={
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            }>
                                <p className="text-text-light leading-relaxed">{result.historicalUsage}</p>
                            </Section>

                            {/* Current Trends */}
                            <Section title="Current Trends (2025)" icon={
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                </svg>
                            }>
                                <p className="text-text-light leading-relaxed">{result.currentTrends}</p>
                            </Section>

                            {/* Common Pairings */}
                            <Section title="Commonly Paired With" icon={
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                </svg>
                            }>
                                <div className="flex flex-wrap gap-2">
                                    {result.pairingTrends.map((font, index) => (
                                        <span
                                            key={index}
                                            className="bg-teal-medium/30 text-text-light text-sm font-medium px-3 py-1.5 rounded-full"
                                        >
                                            {font}
                                        </span>
                                    ))}
                                </div>
                            </Section>

                            {/* Professional Recommendations */}
                            <Section title="Professional Recommendations" icon={
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            }>
                                <p className="text-text-light leading-relaxed">{result.recommendations}</p>
                            </Section>

                            {/* Cultural Context */}
                            <Section title="Cultural Context" icon={
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            }>
                                <p className="text-text-light leading-relaxed">{result.culturalContext}</p>
                            </Section>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );

    return createPortal(modalContent, document.body);
};

// Helper component for sections
const Section: React.FC<{
    title: string;
    icon: React.ReactNode;
    children: React.ReactNode;
}> = ({ title, icon, children }) => (
    <div className="bg-teal-dark/50 rounded-lg p-4 border border-teal-medium">
        <div className="flex items-center gap-2 mb-3">
            <span className="text-accent">{icon}</span>
            <h3 className="text-lg font-semibold text-accent">{title}</h3>
        </div>
        {children}
    </div>
);

export default TypographyContextModal;


================================================================================
FILE PATH: DEPLOYMENT.md
================================================================================
# Production Deployment Guide

This guide walks you through deploying FontPair AI to production.

## Table of Contents

1. [Pre-Deployment Checklist](#pre-deployment-checklist)
2. [Environment Configuration](#environment-configuration)
3. [Deployment Options](#deployment-options)
4. [Post-Deployment Tasks](#post-deployment-tasks)
5. [Troubleshooting](#troubleshooting)

---

## Pre-Deployment Checklist

Before deploying to production, ensure you have:

- [ ] **Supabase Production Database**
  - Created a production Supabase project
  - Run `supabase-schema.sql` in production SQL editor
  - Verified Row Level Security (RLS) policies are enabled
  - Added real license keys (not test keys)

- [ ] **Gemini API Key**
  - Obtained production API key from [Google AI Studio](https://aistudio.google.com/app/apikey)
  - Verified API quota limits (default: 15 req/min, 1M tokens/day)
  - Enabled billing if needed for higher limits

- [ ] **Payment Integration** (Optional)
  - Set up Gumroad product or payment provider
  - Configured webhook for license generation
  - Tested payment flow end-to-end

- [ ] **Code Quality**
  - Run `npm run build` locally to verify build succeeds
  - Test all features in production mode (`npm run preview`)
  - Verify license validation works with production Supabase

---

## Environment Configuration

### Step 1: Create Production Environment File

1. Copy `.env.example` to `.env.production`:
   ```bash
   cp .env.example .env.production
   ```

2. Edit `.env.production` with your production values:

```env
# ============================================
# FONTPAIR AI - PRODUCTION CONFIG
# ============================================

# Gemini API
GEMINI_API_KEY=your_actual_gemini_api_key

# Supabase
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=your_actual_anon_key

# Payment (optional)
VITE_GUMROAD_PURCHASE_URL=https://your-product.gumroad.com/l/fontpair-ai
```

### Step 2: Verify .gitignore

Ensure `.env.production` is in your `.gitignore`:
```
.env
.env.local
.env.production
.env.production.local
```

âš ï¸ **NEVER commit `.env.production` to version control!**

---

## Deployment Options

### Option 1: Vercel (Recommended)

**Pros:** Zero-config, automatic HTTPS, global CDN, serverless

1. **Install Vercel CLI** (if not already installed):
   ```bash
   npm install -g vercel
   ```

2. **Build the app**:
   ```bash
   npm run build
   ```

3. **Deploy**:
   ```bash
   vercel --prod
   ```

4. **Set Environment Variables** in Vercel Dashboard:
   - Go to Project Settings â†’ Environment Variables
   - Add each variable from `.env.production`:
     - `GEMINI_API_KEY`
     - `VITE_SUPABASE_URL`
     - `VITE_SUPABASE_ANON_KEY`
     - `VITE_GUMROAD_PURCHASE_URL` (optional)
   - Select "Production" environment
   - Save and redeploy

5. **Configure Custom Domain** (optional):
   - Go to Project Settings â†’ Domains
   - Add your custom domain
   - Update DNS records as instructed

**Important Vercel Notes:**
- Environment variables prefixed with `VITE_` are exposed to the client
- `GEMINI_API_KEY` without prefix is only available server-side
- Free tier includes 100GB bandwidth/month

---

### Option 2: Netlify

**Pros:** Easy setup, built-in forms, good for static sites

1. **Create `netlify.toml`** in project root:
   ```toml
   [build]
     command = "npm run build"
     publish = "dist"

   [[redirects]]
     from = "/*"
     to = "/index.html"
     status = 200
   ```

2. **Deploy via CLI**:
   ```bash
   npm install -g netlify-cli
   netlify deploy --prod
   ```

3. **Set Environment Variables**:
   - Go to Site Settings â†’ Build & Deploy â†’ Environment
   - Add variables from `.env.production`
   - Redeploy

4. **Configure Custom Domain**:
   - Go to Domain Settings
   - Add custom domain
   - Update DNS as instructed

---

### Option 3: Cloudflare Pages

**Pros:** Free unlimited bandwidth, global CDN, fast builds

1. **Push to GitHub/GitLab**:
   ```bash
   git push origin main
   ```

2. **Create Cloudflare Pages Project**:
   - Go to Cloudflare Dashboard â†’ Pages
   - Connect your GitHub repository
   - Framework preset: Vite
   - Build command: `npm run build`
   - Build output: `dist`

3. **Set Environment Variables**:
   - Go to Settings â†’ Environment Variables
   - Add production variables
   - Save and redeploy

4. **Custom Domain**:
   - Go to Custom Domains
   - Add domain (automatic if using Cloudflare DNS)

---

### Option 4: Self-Hosted (Docker)

**Pros:** Full control, can run anywhere

1. **Create `Dockerfile`**:
   ```dockerfile
   FROM node:18-alpine AS builder
   WORKDIR /app
   COPY package*.json ./
   RUN npm ci
   COPY . .
   RUN npm run build

   FROM nginx:alpine
   COPY --from=builder /app/dist /usr/share/nginx/html
   COPY nginx.conf /etc/nginx/conf.d/default.conf
   EXPOSE 80
   CMD ["nginx", "-g", "daemon off;"]
   ```

2. **Create `nginx.conf`**:
   ```nginx
   server {
     listen 80;
     server_name _;
     root /usr/share/nginx/html;
     index index.html;

     location / {
       try_files $uri $uri/ /index.html;
     }

     # Security headers
     add_header X-Frame-Options "SAMEORIGIN" always;
     add_header X-Content-Type-Options "nosniff" always;
     add_header X-XSS-Protection "1; mode=block" always;
   }
   ```

3. **Build and Run**:
   ```bash
   docker build -t fontpair-app .
   docker run -p 80:80 \
     -e VITE_SUPABASE_URL=https://xxx.supabase.co \
     -e VITE_SUPABASE_ANON_KEY=xxx \
     fontpair-app
   ```

---

## Post-Deployment Tasks

### 1. Verify Deployment

- [ ] Visit production URL
- [ ] Test license key activation
- [ ] Upload a font and verify AI analysis works
- [ ] Test PDF export
- [ ] Check browser console for errors
- [ ] Test on mobile devices

### 2. Configure Supabase for Production

1. **Update CORS Settings** (if needed):
   - Go to Supabase Dashboard â†’ Settings â†’ API
   - Add production domain to allowed origins

2. **Set up Database Backups**:
   - Go to Database â†’ Backups
   - Enable point-in-time recovery (paid plans)

3. **Monitor Usage**:
   - Check API requests in Supabase dashboard
   - Set up alerts for quota limits

### 3. Set Up Monitoring

**Vercel Analytics** (if using Vercel):
```bash
npm install @vercel/analytics
```

Add to `main.tsx`:
```typescript
import { Analytics } from '@vercel/analytics/react';

// In your root component
<Analytics />
```

**Sentry for Error Tracking** (optional):
```bash
npm install @sentry/react @sentry/vite-plugin
```

### 4. Performance Optimization

1. **Enable Gzip Compression**:
   - Most platforms enable this by default
   - Verify in Network tab: `Content-Encoding: gzip`

2. **Optimize Images**:
   - Preview images are already optimized with html2canvas
   - CDN assets are served from jsdelivr/cdnjs

3. **Monitor Bundle Size**:
   ```bash
   npm run build -- --mode production
   npx vite-bundle-visualizer
   ```

---

## Troubleshooting

### License Validation Fails

**Symptoms:** Users see "License validation is not configured" error

**Solution:**
1. Verify `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY` are set correctly
2. Check Supabase RLS policies are enabled
3. Verify RPC functions exist: `validate_license_key`, `get_license_info`, `deactivate_device`
4. Test with browser dev tools â†’ Network tab to see actual API calls

### Gemini API Errors

**Symptoms:** Font analysis fails with API errors

**Solution:**
1. Verify `GEMINI_API_KEY` is set (check deployment platform)
2. Check API quota limits in Google AI Studio
3. Ensure API key is valid and not expired
4. Test API key with curl:
   ```bash
   curl "https://generativelanguage.googleapis.com/v1/models?key=YOUR_KEY"
   ```

### Build Fails

**Symptoms:** `npm run build` fails with errors

**Solution:**
1. Clear node_modules and reinstall:
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```
2. Check for TypeScript errors: `npx tsc --noEmit`
3. Update dependencies: `npm update`

### PDF Export Not Working

**Symptoms:** PDF export button shows error

**Solution:**
1. Verify `jspdf` is installed: `npm list jspdf`
2. Check browser console for specific error
3. Ensure build includes jspdf in bundle
4. Test in different browsers

### CORS Errors

**Symptoms:** Supabase requests blocked by CORS

**Solution:**
1. Add production domain to Supabase allowed origins:
   - Dashboard â†’ Settings â†’ API â†’ CORS allowed origins
2. Include protocol: `https://your-domain.com`
3. Redeploy after Supabase config change

---

## Security Best Practices

### Environment Variables

- âœ… Use `VITE_` prefix ONLY for client-side variables
- âœ… Keep `GEMINI_API_KEY` server-side (no prefix)
- âœ… Never commit `.env.production` to git
- âœ… Rotate API keys periodically

### Supabase Security

- âœ… Enable Row Level Security (RLS) on all tables
- âœ… Use anon key (not service_role key) in client code
- âœ… Review RLS policies before production
- âœ… Monitor for suspicious activity

### Content Security Policy

Add CSP headers in hosting platform:
```
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com;
```

---

## Scaling Considerations

### High Traffic

If expecting high traffic:

1. **Upgrade Supabase Plan**:
   - Pro plan: 500MB database, unlimited API requests
   - Check pricing at supabase.com/pricing

2. **Increase Gemini API Quota**:
   - Enable billing in Google Cloud Console
   - Set up rate limiting in your code

3. **Use CDN**:
   - Most deployment platforms include CDN
   - Cache static assets aggressively

### Multi-Region Deployment

For global users:
- Deploy to edge network (Vercel Edge, Cloudflare Workers)
- Use Supabase multi-region (enterprise)
- Consider read replicas for database

---

## Support

If you encounter issues:

1. Check browser console for errors
2. Review deployment platform logs
3. Test locally with production build: `npm run build && npm run preview`
4. Verify all environment variables are set correctly
5. Check Supabase logs for API errors

## Next Steps

After successful deployment:

- [ ] Set up monitoring and alerts
- [ ] Configure custom domain
- [ ] Enable analytics
- [ ] Set up error tracking
- [ ] Plan backup strategy
- [ ] Document runbook for common issues


================================================================================
FILE PATH: historyService.ts
================================================================================
import type { FontAnalysis } from './types';

const STORAGE_KEY = 'cadmus_analysis_history';
const MAX_HISTORY_ITEMS = 20;

export interface HistoryItem {
  id: string;
  analysis: FontAnalysis;
  timestamp: number;
  thumbnail?: string;
}

export function saveToHistory(analysis: FontAnalysis, thumbnail?: string): void {
  try {
    const history = getHistory();
    const newItem: HistoryItem = {
      id: `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      analysis,
      timestamp: Date.now(),
      thumbnail
    };

    // Add to beginning of array
    history.unshift(newItem);

    // Keep only the most recent MAX_HISTORY_ITEMS
    const trimmedHistory = history.slice(0, MAX_HISTORY_ITEMS);

    localStorage.setItem(STORAGE_KEY, JSON.stringify(trimmedHistory));
  } catch (error) {
    console.error('Failed to save to history:', error);
  }
}

export function getHistory(): HistoryItem[] {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) return [];

    const parsed = JSON.parse(stored);
    return Array.isArray(parsed) ? parsed : [];
  } catch (error) {
    console.error('Failed to retrieve history:', error);
    return [];
  }
}

export function deleteFromHistory(id: string): void {
  try {
    const history = getHistory();
    const filtered = history.filter(item => item.id !== id);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(filtered));
  } catch (error) {
    console.error('Failed to delete from history:', error);
  }
}

export function clearHistory(): void {
  try {
    localStorage.removeItem(STORAGE_KEY);
  } catch (error) {
    console.error('Failed to clear history:', error);
  }
}

export function formatTimeAgo(timestamp: number): string {
  const now = Date.now();
  const diff = now - timestamp;

  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  const weeks = Math.floor(days / 7);
  const months = Math.floor(days / 30);
  const years = Math.floor(days / 365);

  if (seconds < 60) return 'just now';
  if (minutes < 60) return `${minutes}m ago`;
  if (hours < 24) return `${hours}h ago`;
  if (days < 7) return `${days}d ago`;
  if (weeks < 4) return `${weeks}w ago`;
  if (months < 12) return `${months}mo ago`;
  return `${years}y ago`;
}


================================================================================
FILE PATH: index.css
================================================================================
/* Onboarding Tour Animations */

@keyframes fade-in-up {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse-spotlight {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.8;
  }
}

/* Utility classes for animations */
.animate-fade-in-up {
  animation: fade-in-up 0.3s ease-out;
}

.animate-pulse-spotlight {
  animation: pulse-spotlight 2s ease-in-out infinite;
}

/* Slide-in animations for panels */
@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.animate-slide-in-left {
  animation: slideInLeft 0.3s ease-out;
}

.animate-slide-in-right {
  animation: slideInRight 0.3s ease-out;
}

/* Paper Texture Effects */

/* Global paper texture for entire app - NO WHITE ANYWHERE */
body {
  position: relative;
  background: #EBE6D9 !important;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
  opacity: 0.08;
  pointer-events: none;
  filter: url(#paper-texture);
  z-index: -1;
  mix-blend-mode: multiply;
}

/* Paper texture background overlay for header */
.paper-texture-bg {
  position: relative;
  background: linear-gradient(135deg, #e0cab2 0%, #d4b896 100%);
}

.paper-texture-bg::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
  opacity: 0.2;
  pointer-events: none;
  filter: url(#paper-texture);
}

/* Embossed/debossed text effect - pressed into paper */
.text-embossed {
  color: #6b5d4f;
  text-shadow:
    1px 1px 1px rgba(255, 255, 255, 0.8),
    -1px -1px 1px rgba(0, 0, 0, 0.3),
    2px 2px 3px rgba(0, 0, 0, 0.15);
  filter: url(#embossed-element);
}

/* Softer heading emboss - warm brown instead of harsh black */
.heading-embossed {
  color: #4A4039;
  font-weight: 700;
  text-shadow:
    1px 1px 2px rgba(255, 255, 255, 0.8),
    -1px -1px 1px rgba(0, 0, 0, 0.15);
}

/* Embossed logo/icon effect */
.icon-embossed {
  filter: url(#embossed-element) drop-shadow(1px 1px 1px rgba(255, 255, 255, 0.6)) drop-shadow(-1px -1px 1px rgba(0, 0, 0, 0.25));
}

/* Inset button effect - pressed into paper */
.button-inset {
  background: linear-gradient(145deg, #d4b896, #e0cab2);
  box-shadow:
    inset 2px 2px 4px rgba(0, 0, 0, 0.2),
    inset -2px -2px 4px rgba(255, 255, 255, 0.7),
    1px 1px 2px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(107, 93, 79, 0.2);
}

.button-inset:hover {
  background: linear-gradient(145deg, #d8bc9e, #e4ceb6);
  box-shadow:
    inset 1px 1px 3px rgba(0, 0, 0, 0.15),
    inset -1px -1px 3px rgba(255, 255, 255, 0.8),
    1px 1px 2px rgba(0, 0, 0, 0.1);
}

.button-inset-active {
  background: linear-gradient(145deg, #b89668, #c9a77f);
  box-shadow:
    inset 2px 2px 5px rgba(0, 0, 0, 0.3),
    inset -2px -2px 5px rgba(255, 255, 255, 0.5),
    1px 1px 2px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(139, 115, 85, 0.4);
}

/* AI Mode toggle inset effect */
.ai-toggle-inset {
  background: rgba(212, 184, 150, 0.4);
  box-shadow:
    inset 1px 1px 3px rgba(0, 0, 0, 0.15),
    inset -1px -1px 3px rgba(255, 255, 255, 0.6);
  border: 1px solid rgba(107, 93, 79, 0.2);
}

/* Paper-themed accent color for active states */
.paper-accent {
  color: #D47C2E;
}

.paper-accent-bg {
  background: linear-gradient(145deg, #e89850, #d47c2e);
}

/* Warm off-white input inside teal cards */
.warm-input {
  background: #F8F5EF !important;
  box-shadow: inset 1px 1px 3px rgba(0, 0, 0, 0.08);
  border-radius: 8px;
}

/* Orange Accent Button - pops on both light and dark backgrounds */
.accent-button {
  background: linear-gradient(145deg, #FF8E24, #e67e14);
  color: #F2EFE8;
  box-shadow:
    0 4px 12px rgba(230, 126, 34, 0.35),
    inset 0 1px 2px rgba(255, 255, 255, 0.2),
    2px 2px 6px rgba(0, 0, 0, 0.2),
    -1px -1px 2px rgba(255, 255, 255, 0.2);
  border: none;
  font-weight: 600;
}

.accent-button:hover {
  background: linear-gradient(145deg, #ff9a38, #f08920);
  box-shadow:
    3px 3px 8px rgba(0, 0, 0, 0.25),
    -1px -1px 2px rgba(255, 255, 255, 0.25);
  transform: translateY(-1px);
}

.accent-button:active {
  box-shadow:
    inset 1px 1px 3px rgba(0, 0, 0, 0.3),
    inset -1px -1px 1px rgba(255, 255, 255, 0.2);
  transform: translateY(1px);
}

/* Embossed/Indented Card Effect - pressed into paper (for inputs) */
.paper-card-inset {
  background: #F2EFE8;
  box-shadow:
    inset 2px 2px 4px rgba(0, 0, 0, 0.12),
    inset -2px -2px 4px rgba(255, 255, 255, 0.4);
  border: 1px solid rgba(0, 0, 0, 0.08);
}

/* Dark Teal Raised Card - DRAMATIC sophisticated shadows for premium depth */
.teal-card-raised {
  position: relative;
  background: linear-gradient(135deg, #3A5753 0%, #2D4743 100%);
  border-radius: 16px;
  box-shadow:
    0 12px 40px rgba(0, 0, 0, 0.25),
    0 25px 60px rgba(0, 0, 0, 0.18),
    inset 0 2px 4px rgba(255, 255, 255, 0.08),
    0 0 0 1px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.06);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.teal-card-raised::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.02) 2px, rgba(255,255,255,0.02) 4px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.02) 2px, rgba(255,255,255,0.02) 4px);
  opacity: 0.4;
  pointer-events: none;
  mix-blend-mode: overlay;
  border-radius: inherit;
}

.teal-card-raised:hover {
  transform: translateY(-4px);
  box-shadow:
    0 18px 50px rgba(0, 0, 0, 0.28),
    0 30px 70px rgba(0, 0, 0, 0.20),
    inset 0 2px 4px rgba(255, 255, 255, 0.1),
    0 0 0 1px rgba(0, 0, 0, 0.08);
}

/* Raised Button Effect - appears to pop out from paper */
.paper-button-raised {
  background: #F2EFE8;
  box-shadow:
    2px 2px 4px rgba(0, 0, 0, 0.15),
    -1px -1px 2px rgba(255, 255, 255, 0.5);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.paper-button-raised:hover {
  box-shadow:
    1px 1px 2px rgba(0, 0, 0, 0.2),
    -1px -1px 1px rgba(255, 255, 255, 0.6);
  transform: translateY(1px);
}

.paper-button-raised:active {
  box-shadow:
    inset 1px 1px 2px rgba(0, 0, 0, 0.2),
    inset -1px -1px 1px rgba(255, 255, 255, 0.3);
  transform: translateY(2px);
}

/* Upload box paper styling - NO WHITE */
.paper-upload-box {
  background: #F2EFE8;
  box-shadow:
    inset 2px 2px 4px rgba(0, 0, 0, 0.12),
    inset -2px -2px 4px rgba(255, 255, 255, 0.4);
  border: 2px dashed #8B8276;
}

.paper-upload-box:hover {
  border-color: #E67E22;
  box-shadow:
    inset 2px 2px 5px rgba(0, 0, 0, 0.15),
    inset -2px -2px 5px rgba(255, 255, 255, 0.5);
}

/* Modal/Panel dark teal effect with paper texture */
.paper-modal {
  position: relative;
  background: linear-gradient(135deg, #2D4743 0%, #4A6661 100%);
  border-radius: 16px;
  box-shadow:
    0 10px 40px rgba(0, 0, 0, 0.4),
    inset 1px 1px 2px rgba(255, 255, 255, 0.05),
    inset -1px -1px 2px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.paper-modal::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
  opacity: 0.05;
  pointer-events: none;
  mix-blend-mode: overlay;
  border-radius: inherit;
}


================================================================================
FILE PATH: index.tsx
================================================================================

import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);


================================================================================
FILE PATH: LICENSE_SETUP.md
================================================================================
# License Key System Setup Guide

This guide explains how to set up and configure the Supabase-based license key system for FontPair AI.

**Note:** License keys use the `` prefix for database compatibility. This technical identifier remains unchanged.

## Table of Contents

1. [Overview](#overview)
2. [Prerequisites](#prerequisites)
3. [Supabase Setup](#supabase-setup)
4. [Environment Configuration](#environment-configuration)
5. [Testing the System](#testing-the-system)
6. [Managing Licenses](#managing-licenses)
7. [Troubleshooting](#troubleshooting)

## Overview

The license key system provides:

- **One-time payment validation** with device fingerprinting
- **Multi-device support** (default: 3 devices per license)
- **Offline grace period** (30 days after last validation)
- **Periodic revalidation** (every 7 days)
- **Device management** (users can deactivate devices to free up slots)
- **Secure backend** using Supabase RLS and RPC functions

## Prerequisites

- Node.js installed
- A [Supabase](https://supabase.com) account (free tier is sufficient)
- Basic understanding of SQL and PostgreSQL

## Supabase Setup

### Step 1: Create a Supabase Project

1. Go to [supabase.com](https://supabase.com) and sign in
2. Click "New Project"
3. Enter project details:
   - **Name**: FontPair AI License System (or any name)
   - **Database Password**: Save this securely
   - **Region**: Choose closest to your users
4. Wait for the project to finish setting up (~2 minutes)

### Step 2: Run the Database Schema

1. In your Supabase project, navigate to **SQL Editor** in the left sidebar
2. Click "New Query"
3. Copy the entire contents of `supabase-schema.sql` from this repo
4. Paste into the SQL editor
5. Click "Run" or press `Ctrl+Enter`
6. Verify success: You should see "Success. No rows returned"

This creates:
- `licenses` table - stores license keys and metadata
- `activations` table - tracks device activations
- `validation_attempts` table - security logging
- Three stored procedures:
  - `validate_license_key` - validates and activates licenses
  - `deactivate_device` - deactivates a device
  - `get_license_info` - retrieves license details
- Sample test licenses for development

### Step 3: Get Your Supabase Credentials

1. In your Supabase project, go to **Settings** > **API**
2. Copy the following values:
   - **Project URL** (e.g., ``)
   - **anon public** key (under "Project API keys")

## Environment Configuration

### Step 1: Create .env.local File

1. Copy `.env.example` to `.env.local`:
   ```bash
   cp .env.example .env.local
   ```

2. Edit `.env.local` and replace the placeholder values:

   ```env
   # Your Gemini API key (for font analysis)
   GEMINI_API_KEY=your_actual_gemini_api_key

   # Your Supabase project URL
   VITE_SUPABASE_URL=

   # Your Supabase anon key
   VITE_SUPABASE_ANON_KEY=
   ```

### Step 2: Restart Development Server

```bash
npm run dev
```

The app will now check for a valid license on startup.

## Testing the System

### Creating Test Licenses

After running the SQL schema, create your own test licenses in Supabase:

1. Go to **Table Editor** > `licenses` table
2. Click "Insert" > "Insert row"
3. Create test licenses with your own keys (e.g., `YOUR-PREFIX-TEST-XXXX`)
4. Set appropriate `max_devices` values for testing

### Testing Flow

1. **First Launch**
   - App should show the License Key Screen
   - Enter your test license key
   - Click "Activate License"
   - Should show success and redirect to main app

2. **Second Launch**
   - App should remember your license
   - Should load directly to main app

3. **Settings Management**
   - Click Settings icon in header
   - View "License Management" section
   - See your device fingerprint, active devices count
   - Test "Deactivate This Device" button

4. **Multi-Device Testing**
   - Open app in different browser (counts as new device)
   - Or use private/incognito mode
   - Each will count as a separate device
   - Try exceeding max devices to test the limit

## Managing Licenses

### Creating New Licenses

Add licenses directly in Supabase:

1. Go to **Table Editor** > `licenses` table
2. Click "Insert" > "Insert row"
3. Fill in:
   - `license_key`: Unique key (e.g., ``)
   - `is_active`: `true`
   - `max_devices`: `3` (or desired limit)
   - `purchase_email`: Customer's email (optional)
   - `expires_at`: Leave blank for lifetime, or set expiry date
   - `notes`: Any internal notes (optional)

### Generating License Keys

Use a secure random generator. Example formats:
- `` (alphanumeric)
- Ensure keys are:
  - 12-32 characters (excluding dashes)
  - Alphanumeric (A-Z, 0-9)
  - Unique in your database

### Viewing Activations

1. Go to **Table Editor** > `activations` table
2. Filter by `license_key` to see all devices for a license
3. Columns show:
   - `device_fingerprint` - unique device ID
   - `activated_at` - first activation timestamp
   - `last_used` - most recent use
   - `is_active` - whether device is currently active

### Deactivating a Device

Two methods:

**Method 1: Via App UI**
- User clicks "Deactivate This Device" in Settings
- Frees up one device slot immediately

**Method 2: Via Supabase Dashboard**
1. Go to `activations` table
2. Find the activation record
3. Set `is_active` to `false`
4. Or delete the row entirely

### Disabling a License

1. Go to `licenses` table
2. Find the license
3. Set `is_active` to `false`
4. All devices using this license will be denied on next validation

## Troubleshooting

### "License validation is not configured"

**Cause**: Supabase environment variables not set or incorrect

**Fix**:
1. Check `.env.local` has correct `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`
2. Restart dev server: `npm run dev`
3. Hard refresh browser: `Ctrl+F5`

### "Invalid license key"

**Causes**:
- Key doesn't exist in database
- Key is typed incorrectly
- Key has been deactivated

**Fix**:
1. Check spelling (case-insensitive, spaces/dashes ignored)
2. Verify key exists in `licenses` table
3. Check `is_active` is `true`

### "Maximum number of devices reached"

**Cause**: License is already active on max allowed devices

**Fix**:
1. Go to Supabase `activations` table
2. Find activations for this license key
3. Deactivate old/unused devices:
   - Set `is_active = false`
   - Or delete old activation records
4. Try activating again

### "Failed to validate license key"

**Causes**:
- Network/internet connection issue
- Supabase service temporarily down
- RPC functions not created

**Fix**:
1. Check internet connection
2. Verify Supabase project is active
3. Re-run `supabase-schema.sql` to ensure RPC functions exist
4. Check browser console for detailed error

### Offline Grace Period

If user has no internet:
- License is cached in localStorage
- App allows offline use for 30 days after last validation
- After 30 days, user must connect to internet to revalidate

### Database Query Issues

If you need to manually check database state:

```sql
-- View all licenses
SELECT * FROM licenses;

-- View all activations for a license
SELECT * FROM activations
WHERE license_key = '';

-- Count active devices for a license
SELECT COUNT(*) FROM activations
WHERE license_key = ''
AND is_active = true;

-- View recent validation attempts
SELECT * FROM validation_attempts
ORDER BY attempted_at DESC
LIMIT 20;
```

## Security Notes

- **Device Fingerprinting**: Uses FingerprintJS for unique browser identification
- **Server-Side Validation**: All checks performed via Supabase RPC (not client-side)
- **Row Level Security**: Supabase RLS policies protect sensitive data
- **Rate Limiting**: Track attempts via `validation_attempts` table
- **Local Storage**: Cached licenses stored in browser localStorage (not cookies)
- **No Personal Data**: Only device fingerprints and license keys stored

## Integration with Payment Providers

### Gumroad Integration Example

1. Set up a Gumroad product
2. Add webhook for "sale" event
3. Create serverless function to:
   - Receive Gumroad webhook
   - Generate unique license key
   - Insert into Supabase `licenses` table
   - Email license key to customer
4. Update `.env.local`:
   ```env
   VITE_GUMROAD_PURCHASE_URL=https://gumroad.com/l/your-product
   ```

### Other Payment Providers

Similar approach works with:
- Stripe
- Paddle
- LemonSqueezy
- PayPal

Key steps:
1. Generate unique license on purchase
2. Store in Supabase `licenses` table
3. Email to customer
4. Customer enters in app

## Production Deployment

### Vercel/Netlify

1. Add environment variables in deployment dashboard:
   - `GEMINI_API_KEY`
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`

2. Deploy: `npm run build`

3. Test license flow in production

### Custom Domain

Update CORS settings in Supabase if needed:
1. Go to **Settings** > **API**
2. Add your production domain to allowed origins

## Support

If you encounter issues:

1. Check browser console for errors
2. Review Supabase logs in **Logs** section
3. Query `validation_attempts` table for failed attempts
4. Ensure all SQL functions are created correctly

## License System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Browser   â”‚
â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ App.tsx   â”‚  â”‚  Check license on startup
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ LicenseKeyScreen  â”‚  â”‚  Show if no valid license
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚        â”‚ validateLicenseKey()
â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ licenseService   â”‚  â”‚  FingerprintJS + Supabase client
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚ RPC call      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTPS
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Supabase Cloud        â”‚
â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ validate_license_keyâ”‚   â”‚  PostgreSQL function
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   licenses table    â”‚   â”‚  Check key exists, active
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  activations table  â”‚   â”‚  Track devices, check limit
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ validation_attempts   â”‚ â”‚  Security logging
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Next Steps

- Integrate with payment provider (Gumroad, Stripe, etc.)
- Customize license key format
- Set up automated email delivery
- Configure license expiration dates
- Add analytics/reporting dashboard
- Implement license key recovery flow


================================================================================
FILE PATH: metadata.json
================================================================================
{
  "name": "FontPair AI",
  "description": "An AI-powered font pairing critique and analysis tool. Upload fonts or images to get detailed typography analysis, font pairing recommendations with scoring, accessibility evaluation, and professional design insights. Perfect for designers and developers seeking expert font guidance.",
  "requestFramePermissions": []
}

================================================================================
FILE PATH: package.json
================================================================================
{
  "name": "fontpair-ai",
  "description": "AI-powered font pairing and analysis tool",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@fingerprintjs/fingerprintjs": "^5.0.1",
    "@google/genai": "^1.28.0",
    "@supabase/supabase-js": "^2.78.0",
    "jspdf": "^2.5.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  },
  "devDependencies": {
    "@types/node": "^22.14.0",
    "@vitejs/plugin-react": "^5.0.0",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  },
  "optionalDependencies": {
    "@rollup/rollup-linux-x64-gnu": "^4.30.1"
  }
}


================================================================================
FILE PATH: pdfExportService.ts
================================================================================
import type { FontAnalysis, PairingCritique } from './types';
import { jsPDF } from 'jspdf';

// Helper to convert font name to valid CSS variable name
const toSlug = (name: string): string => {
  return name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
};

// Helper to extract weight number from recommendation string
const extractWeight = (rec: string): number => {
  const match = rec.match(/\d+/);
  return match ? parseInt(match[0], 10) : 400;
};

/**
 * Generate CSS variables for a font analysis
 */
export function generateCSSVariables(analysis: FontAnalysis): string {
  const slug = toSlug(analysis.fontName);
  const weights = analysis.weightRecommendations.map(rec => {
    const weight = extractWeight(rec);
    const label = rec.split(' ')[0].toLowerCase();
    return `  --font-weight-${slug}-${label}: ${weight};`;
  });

  return `/* ${analysis.fontName} - CSS Variables */
/* Generated by FontPair AI */

:root {
  /* Font Family */
  --font-family-${slug}: "${analysis.fontName}", ${analysis.fontType.toLowerCase().includes('serif') && !analysis.fontType.toLowerCase().includes('sans') ? 'serif' : 'sans-serif'};

  /* Font Weights */
${weights.join('\n')}

  /* Usage Notes */
  /* Type: ${analysis.fontType} */
  /* Designer: ${analysis.designer} */
  /* Best for: ${analysis.usageRecommendations.slice(0, 2).join(', ')} */
}

/* Example Usage */
.heading-${slug} {
  font-family: var(--font-family-${slug});
  font-weight: var(--font-weight-${slug}-bold, 700);
}

.body-${slug} {
  font-family: var(--font-family-${slug});
  font-weight: var(--font-weight-${slug}-regular, 400);
}`;
}

/**
 * Generate Tailwind CSS config for a font analysis
 */
export function generateTailwindConfig(analysis: FontAnalysis): string {
  const slug = toSlug(analysis.fontName);
  const fallback = analysis.fontType.toLowerCase().includes('serif') && !analysis.fontType.toLowerCase().includes('sans')
    ? 'ui-serif, Georgia, serif'
    : 'ui-sans-serif, system-ui, sans-serif';

  return `// ${analysis.fontName} - Tailwind CSS Configuration
// Generated by FontPair AI

// Add to your tailwind.config.js:

module.exports = {
  theme: {
    extend: {
      fontFamily: {
        '${slug}': ['"${analysis.fontName}"', '${fallback}'],
      },
      // Optional: Add as a font weight utility
      fontWeight: {
        // Based on analysis recommendations
${analysis.weightRecommendations.map(rec => {
  const weight = extractWeight(rec);
  const label = rec.split(' ')[0].toLowerCase();
  return `        '${slug}-${label}': '${weight}',`;
}).join('\n')}
      },
    },
  },
}

// Usage in your HTML/JSX:
// <h1 class="font-${slug} font-bold">Heading</h1>
// <p class="font-${slug}">Body text</p>

// Don't forget to import the font in your CSS:
// @import url('https://fonts.googleapis.com/css2?family=${analysis.fontName.replace(/\s+/g, '+')}:wght@400;700&display=swap');`;
}

/**
 * Generate a complete typography system CSS for font pairing
 */
export function generatePairingCSS(
  headingFont: FontAnalysis,
  bodyFont: FontAnalysis,
  critique?: PairingCritique
): string {
  const headingSlug = toSlug(headingFont.fontName);
  const bodySlug = toSlug(bodyFont.fontName);

  return `/* Typography System - Font Pairing */
/* Generated by FontPair AI */
/* Heading: ${headingFont.fontName} | Body: ${bodyFont.fontName} */
${critique ? `/* Pairing Score: ${critique.overallScore}/10 */` : ''}

:root {
  /* Heading Font */
  --font-heading: "${headingFont.fontName}", ${headingFont.fontType.toLowerCase().includes('serif') && !headingFont.fontType.toLowerCase().includes('sans') ? 'serif' : 'sans-serif'};

  /* Body Font */
  --font-body: "${bodyFont.fontName}", ${bodyFont.fontType.toLowerCase().includes('serif') && !bodyFont.fontType.toLowerCase().includes('sans') ? 'serif' : 'sans-serif'};

  /* Type Scale (Major Third - 1.25) */
  --text-xs: 0.64rem;
  --text-sm: 0.8rem;
  --text-base: 1rem;
  --text-lg: 1.25rem;
  --text-xl: 1.563rem;
  --text-2xl: 1.953rem;
  --text-3xl: 2.441rem;
  --text-4xl: 3.052rem;
}

/* Base Typography */
body {
  font-family: var(--font-body);
  font-size: var(--text-base);
  line-height: 1.6;
}

/* Headings */
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-heading);
  line-height: 1.2;
  margin-bottom: 0.5em;
}

h1 { font-size: var(--text-4xl); font-weight: 700; }
h2 { font-size: var(--text-3xl); font-weight: 700; }
h3 { font-size: var(--text-2xl); font-weight: 600; }
h4 { font-size: var(--text-xl); font-weight: 600; }
h5 { font-size: var(--text-lg); font-weight: 600; }
h6 { font-size: var(--text-base); font-weight: 600; }

/* Body Text */
p {
  margin-bottom: 1em;
}

/* Small Text */
small, .text-small {
  font-size: var(--text-sm);
}

/* Caption */
.caption {
  font-size: var(--text-xs);
  color: #666;
}

/* Google Fonts Import */
@import url('https://fonts.googleapis.com/css2?family=${headingFont.fontName.replace(/\s+/g, '+')}:wght@400;600;700&family=${bodyFont.fontName.replace(/\s+/g, '+')}:wght@400;600;700&display=swap');`;
}

// Print-friendly color scheme with paper background
const COLORS = {
  background: '#F2EFE8',   // Light paper color (no pure white)
  primary: '#1A3431',      // Dark green for main text
  secondary: '#2D4E4A',    // Medium dark green for supporting text
  accent: '#FF8E24'        // Orange for highlights
};

export async function exportAnalysisToPDF(analysis: FontAnalysis, previewImageBase64?: string): Promise<void> {
  // Use jsPDF from npm package
  const doc = new jsPDF({
    orientation: 'portrait',
    unit: 'mm',
    format: 'a4'
  });

  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const margin = 20;
  const contentWidth = pageWidth - (2 * margin);
  let yPosition = margin;

  // Helper function to add a new page if needed
  const checkAndAddPage = (requiredSpace: number) => {
    if (yPosition + requiredSpace > pageHeight - margin) {
      doc.addPage();
      yPosition = margin;
      return true;
    }
    return false;
  };

  // Helper function to wrap text
  const splitText = (text: string, maxWidth: number, fontSize: number) => {
    doc.setFontSize(fontSize);
    return doc.splitTextToSize(text, maxWidth);
  };

  // Header with accent bar
  doc.setFillColor(COLORS.accent);
  doc.rect(0, 0, pageWidth, 15, 'F');

  // Light paper text on orange background
  doc.setTextColor('#F2EFE8');
  doc.setFontSize(18);
  doc.setFont('helvetica', 'bold');
  doc.text('FontPair AI', margin, 10);

  yPosition = 25;

  // Font Name and Type
  doc.setTextColor(COLORS.primary);
  doc.setFontSize(24);
  doc.setFont('helvetica', 'bold');
  const fontNameLines = splitText(analysis.fontName, contentWidth, 24);
  doc.text(fontNameLines, margin, yPosition);
  yPosition += fontNameLines.length * 10;

  doc.setTextColor(COLORS.accent);
  doc.setFontSize(14);
  doc.setFont('helvetica', 'normal');
  doc.text(analysis.fontType, margin, yPosition);
  yPosition += 8;

  if (analysis.designer && analysis.designer.toLowerCase() !== 'unknown designer') {
    doc.setTextColor(COLORS.secondary);
    doc.setFontSize(11);
    doc.text(`by ${analysis.designer}`, margin, yPosition);
    yPosition += 8;
  }

  if (analysis.isVariable) {
    doc.setTextColor(COLORS.accent);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.text('[VARIABLE FONT]', margin, yPosition);
    yPosition += 8;
  }

  yPosition += 5;

  // Preview Image (if provided)
  if (previewImageBase64) {
    checkAndAddPage(90);
    doc.setTextColor(COLORS.accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Preview', margin, yPosition);
    yPosition += 7;

    try {
      // Load image to get actual dimensions
      const img = new Image();
      img.src = previewImageBase64;

      // Calculate proper aspect ratio to prevent squashing
      await new Promise((resolve) => {
        img.onload = resolve;
        // Set a timeout in case image doesn't load
        setTimeout(resolve, 1000);
      });

      const actualWidth = img.width || 800;
      const actualHeight = img.height || 200;
      const aspectRatio = actualHeight / actualWidth;

      // Calculate dimensions maintaining aspect ratio
      const maxWidth = contentWidth;
      const maxHeight = 80; // Max height in mm

      let imgWidth = maxWidth;
      let imgHeight = imgWidth * aspectRatio;

      // If calculated height exceeds max, scale down
      if (imgHeight > maxHeight) {
        imgHeight = maxHeight;
        imgWidth = imgHeight / aspectRatio;
      }

      doc.addImage(previewImageBase64, 'PNG', margin, yPosition, imgWidth, imgHeight);
      yPosition += imgHeight + 10;
    } catch (e) {
      console.error('Failed to add preview image', e);
    }
  }

  // Section helper function
  const addSection = (title: string, content: string | string[], isList: boolean = false) => {
    checkAndAddPage(20);

    doc.setTextColor(COLORS.accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text(title, margin, yPosition);
    yPosition += 7;

    doc.setTextColor(COLORS.primary);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');

    if (isList && Array.isArray(content)) {
      content.forEach(item => {
        checkAndAddPage(10);
        const bulletX = margin + 2;
        doc.circle(bulletX, yPosition - 1.5, 0.8, 'F');
        const lines = splitText(item, contentWidth - 8, 10);
        doc.text(lines, margin + 6, yPosition);
        yPosition += lines.length * 5 + 2;
      });
    } else {
      const text = Array.isArray(content) ? content.join(', ') : content;
      const lines = splitText(text, contentWidth, 10);
      lines.forEach((line: string) => {
        checkAndAddPage(7);
        doc.text(line, margin, yPosition);
        yPosition += 5;
      });
    }

    yPosition += 5;
  };

  // Analysis
  addSection('Analysis', analysis.analysis);

  // Historical Context
  if (analysis.historicalContext) {
    addSection('Historical Context', analysis.historicalContext);
  }

  // Accessibility & Legibility
  if (analysis.accessibility) {
    checkAndAddPage(20);
    doc.setTextColor(COLORS.accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Accessibility & Legibility', margin, yPosition);
    yPosition += 7;

    doc.setTextColor(COLORS.primary);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    const accessLines = splitText(analysis.accessibility.analysis, contentWidth, 10);
    accessLines.forEach((line: string) => {
      checkAndAddPage(7);
      doc.text(line, margin, yPosition);
      yPosition += 5;
    });
    yPosition += 3;

    if (analysis.accessibility.notes && analysis.accessibility.notes.length > 0) {
      analysis.accessibility.notes.forEach(note => {
        checkAndAddPage(10);
        const bulletX = margin + 2;
        doc.setFillColor(COLORS.accent);
        doc.circle(bulletX, yPosition - 1.5, 0.8, 'F');
        const lines = splitText(note, contentWidth - 8, 10);
        doc.text(lines, margin + 6, yPosition);
        yPosition += lines.length * 5 + 2;
      });
    }
    yPosition += 5;
  }

  // Font Pairing Suggestions
  if (analysis.fontPairings && analysis.fontPairings.length > 0) {
    checkAndAddPage(20);
    doc.setTextColor(COLORS.accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Font Pairing Suggestions', margin, yPosition);
    yPosition += 7;

    analysis.fontPairings.forEach((pairing, index) => {
      checkAndAddPage(15);
      doc.setTextColor(COLORS.primary);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text(`${index + 1}. ${pairing.primary} + ${pairing.secondary}`, margin, yPosition);
      yPosition += 5;

      doc.setFont('helvetica', 'normal');
      const rationaleLines = splitText(pairing.rationale, contentWidth, 10);
      rationaleLines.forEach((line: string) => {
        checkAndAddPage(7);
        doc.text(line, margin + 5, yPosition);
        yPosition += 5;
      });
      yPosition += 3;
    });
    yPosition += 5;
  }

  // Similar Font Alternatives
  if (analysis.similarFonts && analysis.similarFonts.length > 0) {
    checkAndAddPage(20);
    doc.setTextColor(COLORS.accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Similar Font Alternatives', margin, yPosition);
    yPosition += 7;

    analysis.similarFonts.forEach((font, index) => {
      checkAndAddPage(12);
      doc.setTextColor(COLORS.primary);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text(`${index + 1}. ${font.name}`, margin, yPosition);

      doc.setTextColor(COLORS.secondary);
      doc.setFont('helvetica', 'italic');
      doc.setFontSize(8);
      doc.text(`(${font.source})`, margin + doc.getTextWidth(`${index + 1}. ${font.name}`) + 2, yPosition);
      yPosition += 5;

      doc.setTextColor(COLORS.primary);
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(10);
      const rationaleLines = splitText(font.rationale, contentWidth, 10);
      rationaleLines.forEach((line: string) => {
        checkAndAddPage(7);
        doc.text(line, margin + 5, yPosition);
        yPosition += 5;
      });
      yPosition += 3;
    });
    yPosition += 5;
  }

  // Recommended Usage
  if (analysis.usageRecommendations && analysis.usageRecommendations.length > 0) {
    addSection('Recommended Usage', analysis.usageRecommendations, true);
  }

  // Weight Recommendations
  if (analysis.weightRecommendations && analysis.weightRecommendations.length > 0) {
    addSection('Weight Recommendations', analysis.weightRecommendations, true);
  }

  // Business Suitability
  if (analysis.businessSuitability && analysis.businessSuitability.length > 0) {
    checkAndAddPage(15);
    doc.setTextColor(COLORS.accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Business Suitability', margin, yPosition);
    yPosition += 7;

    doc.setTextColor(COLORS.primary);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text(analysis.businessSuitability.join(', '), margin, yPosition, { maxWidth: contentWidth });
    const businessLines = splitText(analysis.businessSuitability.join(', '), contentWidth, 10);
    yPosition += businessLines.length * 5 + 5;
  }

  // License & Usage Information
  if (analysis.licenseInfo) {
    addSection('License & Usage Information', analysis.licenseInfo);
  }

  // Licensing Notes for Commercial Use (new field)
  if (analysis.licensingNotes) {
    addSection('Commercial Licensing Notes', analysis.licensingNotes);
  }

  // Character Set Support (new field)
  if (analysis.characterSets && analysis.characterSets.length > 0) {
    checkAndAddPage(15);
    doc.setTextColor(COLORS.accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Character Set Support', margin, yPosition);
    yPosition += 7;

    doc.setTextColor(COLORS.primary);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    const charSetText = analysis.characterSets.join(' â€¢ ');
    const charSetLines = splitText(charSetText, contentWidth, 10);
    charSetLines.forEach((line: string) => {
      checkAndAddPage(7);
      doc.text(line, margin, yPosition);
      yPosition += 5;
    });
    yPosition += 5;
  }

  // Release Year (new field)
  if (analysis.releaseYear && analysis.releaseYear.toLowerCase() !== 'unknown') {
    checkAndAddPage(10);
    doc.setTextColor(COLORS.secondary);
    doc.setFontSize(9);
    doc.setFont('helvetica', 'italic');
    doc.text(`Originally released: ${analysis.releaseYear}`, margin, yPosition);
    yPosition += 8;
  }

  // Footer on last page
  doc.setTextColor(COLORS.secondary);
  doc.setFontSize(8);
  doc.setFont('helvetica', 'italic');
  const footerText = 'Generated by FontPair AI - Powered by Google Gemini';
  const footerWidth = doc.getTextWidth(footerText);
  doc.text(footerText, (pageWidth - footerWidth) / 2, pageHeight - 10);

  // Save the PDF
  const fileName = `${analysis.fontName.replace(/\s+/g, '_')}_Analysis.pdf`;
  doc.save(fileName);
}


================================================================================
FILE PATH: README.md
================================================================================
<div align="center">
<img width="1200" height="475" alt="GHBanner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />
</div>

# FontPair AI

AI-powered font pairing critique and analysis tool for professional designers. Upload fonts or images to get expert AI evaluation, compare glyph legibility, analyze accessibility, and receive detailed pairing recommendations with reasoning.

View your app in AI Studio: https://ai.studio/apps/drive/1KkjXGcoHACEU3kUjB3sdn_KZ3kcD82px

## Features

- **Dual AI Mode**: Switch between Cloud AI (Gemini API) and Chrome AI (local, experimental)
- **Font Analysis**: Upload font files or images for detailed AI-powered typography analysis
- **Font Pairing Critique**: Get AI suggestions for combining fonts effectively
- **Glyph Comparison**: Visual analysis of character differences between fonts
- **License System**: Supabase-based one-time payment validation with device management

## Quick Start

**Prerequisites:** Node.js

1. **Install dependencies:**
   ```bash
   npm install
   ```

2. **Configure environment:**
   - Copy `.env.example` to `.env.local`
   - Set your `GEMINI_API_KEY` from [Google AI Studio](https://aistudio.google.com/app/apikey)
   - (Optional) Configure Supabase for license validation - see [LICENSE_SETUP.md](LICENSE_SETUP.md)

3. **Run the app:**
   ```bash
   npm run dev
   ```

4. **Access the app:**
   - Open [http://localhost:3000](http://localhost:3000)

## License System Setup

This app includes a complete license key validation system powered by Supabase. For full setup instructions, see [LICENSE_SETUP.md](LICENSE_SETUP.md).

## Development

```bash
# Install dependencies
npm install

# Run dev server (hot reload)
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview
```

## Documentation

- [LICENSE_SETUP.md](LICENSE_SETUP.md) - Complete guide for setting up the Supabase license system
- [CLAUDE.md](CLAUDE.md) - Technical documentation for AI assistants
- [supabase-schema.sql](supabase-schema.sql) - Database schema for license system

## Tech Stack

- React + TypeScript
- Vite
- Tailwind CSS
- Google Gemini API
- Supabase (PostgreSQL)
- FingerprintJS


================================================================================
FILE PATH: services\geminiService.ts
================================================================================
import { GoogleGenAI, Type } from "@google/genai";
import type { FontAnalysis, PairingCritique, GlyphComparisonResult, AIMode, FontSuggestionRequest, FontSuggestionResult, FontDNAResult, TypographyContextResult, BatchCompatibilityResult } from '../types';
import { getAIMode, getAPIKey, validateAIMode } from '../utils/aiSettings';

// Initialize Cloud AI lazily when needed
let cloudAI: GoogleGenAI | null = null;

const getCloudAI = (): GoogleGenAI => {
    const apiKey = getAPIKey();
    if (!apiKey) {
        throw new Error("No Gemini API key configured. Please add your API key in settings.");
    }

    if (!cloudAI || cloudAI.apiKey !== apiKey) {
        cloudAI = new GoogleGenAI({ apiKey });
    }

    return cloudAI;
};

/**
 * Parse API errors and return user-friendly messages
 * Distinguishes between AI provider issues and app issues
 */
const parseAPIError = (error: unknown): string => {
    const errorString = error instanceof Error ? error.message : String(error);

    // Check for specific API error codes/messages
    if (errorString.includes('503') || errorString.includes('UNAVAILABLE') || errorString.includes('overloaded')) {
        return "Gemini API is temporarily overloaded. This is an issue with Google's servers, not the app. Please wait a few minutes and try again.";
    }

    if (errorString.includes('429') || errorString.includes('RESOURCE_EXHAUSTED') || errorString.includes('quota')) {
        return "Gemini API rate limit exceeded. You've made too many requests. Please wait a minute before trying again, or check your API quota at Google AI Studio.";
    }

    if (errorString.includes('401') || errorString.includes('UNAUTHENTICATED') || errorString.includes('invalid') && errorString.includes('key')) {
        return "Invalid Gemini API key. Please check your API key in Settings and ensure it's correct.";
    }

    if (errorString.includes('403') || errorString.includes('PERMISSION_DENIED')) {
        return "Gemini API access denied. Your API key may not have permission for this model. Check your API key settings at Google AI Studio.";
    }

    if (errorString.includes('400') || errorString.includes('INVALID_ARGUMENT')) {
        return "Invalid request to Gemini API. The image or text may be too large or in an unsupported format.";
    }

    if (errorString.includes('network') || errorString.includes('fetch') || errorString.includes('Failed to fetch')) {
        return "Network error connecting to Gemini API. Please check your internet connection and try again.";
    }

    if (errorString.includes('timeout') || errorString.includes('DEADLINE_EXCEEDED')) {
        return "Gemini API request timed out. The server took too long to respond. Please try again.";
    }

    // Default message - still indicates it's an AI provider issue
    return "Gemini API error: " + (errorString.length > 100 ? errorString.substring(0, 100) + '...' : errorString);
};

const fontPairingSchema = {
    type: Type.OBJECT,
    properties: {
        primary: {
            type: Type.STRING,
            description: "The name of the primary font in the pairing. This should usually be the analyzed font if it's suitable for headlines."
        },
        secondary: {
            type: Type.STRING,
            description: "The name of a complementary secondary font, suitable for body text or subheadings (e.g., from Google Fonts)."
        },
        rationale: {
            type: Type.STRING,
            description: "A brief explanation of why this pairing works well together (e.g., contrast, shared characteristics, mood)."
        }
    },
    required: ['primary', 'secondary', 'rationale']
};

const similarFontSchema = {
    type: Type.OBJECT,
    properties: {
        name: {
            type: Type.STRING,
            description: "The name of the similar font."
        },
        source: {
            type: Type.STRING,
            description: "The source of the font, e.g., 'Google Fonts', 'Adobe Fonts'."
        },
        rationale: {
            type: Type.STRING,
            description: "A brief explanation of why this font is a good alternative."
        }
    },
    required: ['name', 'source', 'rationale']
};

const accessibilitySchema = {
    type: Type.OBJECT,
    properties: {
        analysis: {
            type: Type.STRING,
            description: "A paragraph summarizing the font's overall accessibility and legibility characteristics."
        },
        notes: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "A list of specific observations, such as 'Clear distinction between 'I', 'l', and '1'' or 'Large x-height enhances readability'."
        }
    },
    required: ['analysis', 'notes']
};


const fontAnalysisSchema = {
  type: Type.OBJECT,
  properties: {
    status: {
        type: Type.STRING,
        description: 'Set to "success" if analysis is possible, otherwise "not_enough_data".'
    },
    fontName: {
      type: Type.STRING,
      description: 'The name of the font. If unidentified, state "Unknown Font".',
    },
    fontType: {
      type: Type.STRING,
      description: 'The primary classification of the font (e.g., Serif, Sans-Serif, Script, Display, Monospace).',
    },
    analysis: {
      type: Type.STRING,
      description: "A detailed paragraph describing the font's characteristics: its personality, mood, legibility, and unique features. Describe what you see in the font's design.",
    },
    designer: {
        type: Type.STRING,
        description: "The name of the font's designer or foundry. If unknown, state 'Unknown Designer'."
    },
    historicalContext: {
        type: Type.STRING,
        description: "A paragraph detailing the font's history, its designer, the foundry it came from, and the historical period or artistic movement that influenced it."
    },
    isVariable: {
        type: Type.BOOLEAN,
        description: "Set to true if the font appears to be a variable font with multiple axes, otherwise false."
    },
    weightRecommendations: {
      type: Type.ARRAY,
      items: { type: Type.STRING },
      description: 'An array of strings suggesting appropriate font weights for different uses (e.g., "Regular (400) for body text", "Bold (700) for headlines").',
    },
    usageRecommendations: {
      type: Type.ARRAY,
      items: { type: Type.STRING },
      description: 'An array of strings recommending where to use this font style (e.g., "Titles, headings, logos", "Paragraphs, UI elements").',
    },
    businessSuitability: {
      type: Type.ARRAY,
      items: { type: Type.STRING },
      description: 'An array of strings suggesting types of businesses or industries this font would be suitable for (e.g., "Tech startups", "Fashion brands", "Law firms").',
    },
    fontPairings: {
        type: Type.ARRAY,
        description: "An array of 2-3 suggested font pairings. The primary font should typically be the one being analyzed.",
        items: fontPairingSchema
    },
    similarFonts: {
        type: Type.ARRAY,
        description: "An array of 3-5 similar fonts from well-known libraries like Google Fonts, Adobe Fonts, or other well-known foundries.",
        items: similarFontSchema
    },
    accessibility: {
        ...accessibilitySchema,
        description: "An analysis of the font's accessibility and legibility."
    },
    licenseInfo: {
        type: Type.STRING,
        description: "A summary of the font's license from its metadata, OR a warning that license info cannot be determined from an image. This field must not be speculative.",
    },
    fontFoundry: {
        type: Type.STRING,
        description: "The foundry or company that created/published the font (e.g., 'Adobe', 'Google', 'Monotype', 'Linotype', 'Font Bureau'). If unknown, state 'Unknown Foundry'."
    },
    characterSets: {
        type: Type.ARRAY,
        items: { type: Type.STRING },
        description: "Language/script support including Latin, Cyrillic, Greek, Arabic, Hebrew, CJK, etc. List all character sets the font appears to support based on typical coverage for this font."
    },
    releaseYear: {
        type: Type.STRING,
        description: "The year the font was originally released or designed. If unknown, state 'Unknown'."
    },
    licensingNotes: {
        type: Type.STRING,
        description: "Professional licensing considerations for commercial use. Include notes about: free for personal/commercial use, subscription required (Adobe Fonts), desktop vs web licensing, or if the license needs verification. Be specific about commercial usage implications."
    },
  },
  required: ['status', 'fontName', 'fontType', 'analysis', 'designer', 'historicalContext', 'isVariable', 'weightRecommendations', 'usageRecommendations', 'businessSuitability', 'fontPairings', 'similarFonts', 'accessibility', 'licenseInfo', 'fontFoundry', 'characterSets', 'releaseYear', 'licensingNotes']
};

/**
 * Analyze font using Cloud AI (Gemini API)
 * This function processes images and requires an API key
 */
const analyzeFont_Cloud = async (fileContent: string, mimeType: string, fileName: string, fontMetadata?: string): Promise<FontAnalysis> => {
    const ai = getCloudAI();
    let prompt = `You are a world-class typographer and font analyst with expertise in font licensing and commercial usage. Your task is to analyze the provided image which contains text. The original filename was "${fileName}".

Based on your analysis, provide a detailed breakdown covering these areas:

1.  **Core Analysis:** Identify the font, its type, its designer/foundry, and describe its characteristics, personality, and mood.
2.  **Historical Context:** Detail the font's history, release year, and the influences behind its design.
3.  **Font Foundry & Source:** Identify the foundry or company that created/published this font (e.g., Adobe, Google, Monotype, Linotype, Font Bureau, Indian Type Foundry for Fontshare fonts, etc.). Consider these common font sources:
    - Google Fonts (free, open-source)
    - Adobe Fonts (subscription via Creative Cloud)
    - MyFonts (commercial marketplace)
    - Fontshare (free from Indian Type Foundry)
    - Font Squirrel (free commercial-use fonts)
    - DaFont (mostly free for personal use)
    - Velvetyne (libre fonts)
    - League of Moveable Type (open-source)
    - The Northern Block (commercial foundry)
    - Atipo Foundry (commercial/free options)
4.  **Variable Font:** Determine if the font appears to be a variable font.
5.  **Character Sets:** List the language/script support (Latin, Cyrillic, Greek, Arabic, Hebrew, CJK, etc.).
6.  **Release Year:** Identify when the font was originally released or designed.
7.  **Recommendations:** Suggest appropriate weights, use cases, and business types.
8.  **Font Pairings:** Suggest 2-3 pairings with complementary fonts from Google Fonts and explain why they work.
9.  **Similar Fonts:** Suggest 3-5 similar font alternatives from various sources (Google Fonts, Adobe Fonts, MyFonts, Fontshare, etc.). For each alternative, specify its source and whether it's free or commercial.
10. **Accessibility Audit:** Analyze the font's legibility. Comment on its x-height, character ambiguity (e.g., I/l/1), and general suitability for UI and body text.
11. **Licensing Notes for Commercial Use:** Provide specific guidance for professional designers about:
    - Whether the font is free for commercial projects
    - If a license needs to be purchased and typical cost range
    - Desktop vs web vs app licensing differences
    - Subscription requirements (e.g., Adobe Creative Cloud)
    - Any attribution requirements

If you cannot clearly identify the font or there isn't enough text to analyze, your response must set the status to "not_enough_data" and fill other fields with placeholder text or empty arrays.`;

    if (fontMetadata) {
        prompt += `\n\nCRITICAL: The following metadata was extracted directly from the font file: "${fontMetadata}". Use this to populate the 'licenseInfo' field and help identify the 'fontFoundry'. Summarize any copyright or license information. If the metadata is empty, state that no specific license information was found in the file.`;
    } else {
        prompt += `\n\nCRITICAL: Since this analysis is based on an image or a web font, you cannot determine the license. The 'licenseInfo' field MUST state: "License information cannot be determined from an image or web font. Please identify the font and verify its license from a reputable source."`;
    }

    prompt += `\n\nYour response MUST be a JSON object that conforms to the provided schema. Do not output markdown format (e.g. \`\`\`json).`;

    const filePart = {
        inlineData: {
            data: fileContent,
            mimeType: mimeType,
        },
    };

    const textPart = {
        text: prompt,
    };

    const contents = { parts: [textPart, filePart] };

    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: contents,
            config: {
                responseMimeType: 'application/json',
                responseSchema: fontAnalysisSchema,
            },
        });

        const jsonText = response.text.trim();
        const result = JSON.parse(jsonText);

        if (!fontMetadata && result.licenseInfo && !result.licenseInfo.includes("cannot be determined")) {
            result.licenseInfo = "License information cannot be determined from an image or web font. Please identify the font and verify its license from a reputable source.";
        }

        return result as FontAnalysis;

    } catch (error) {
        console.error("Error analyzing font with Gemini:", error);
        throw new Error(parseAPIError(error));
    }
};

/**
 * Main analyzeFont function - routes to appropriate implementation
 *
 * NOTE: Font analysis requires image processing, which Chrome AI (Prompt API) does not support.
 * Therefore, this function ALWAYS uses Cloud AI regardless of the selected mode.
 *
 * This is part of the hybrid approach where:
 * - Image analysis (font analysis, glyph comparison) â†’ Cloud AI only
 * - Text-only operations (font pairing critique) â†’ Can use either mode
 */
export const analyzeFont = async (fileContent: string, mimeType: string, fileName: string, fontMetadata?: string): Promise<FontAnalysis> => {
    // Font analysis requires image processing, so we always use Cloud AI
    // Validate that Cloud AI is available
    const validation = await validateAIMode('cloud');
    if (!validation.valid) {
        throw new Error(validation.error || "Cloud AI is required for font analysis but is not available.");
    }

    return analyzeFont_Cloud(fileContent, mimeType, fileName, fontMetadata);
};

const pairingCritiqueSchema = {
    type: Type.OBJECT,
    properties: {
        overallScore: {
            type: Type.INTEGER,
            description: "A score from 1 (poor) to 10 (excellent) for how well the two fonts pair together."
        },
        analysis: {
            type: Type.STRING,
            description: "A detailed paragraph explaining the rationale behind the score, discussing harmony, contrast, and suitability for common use cases."
        },
        pros: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "A list of specific strengths of this font pairing."
        },
        cons: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "A list of potential weaknesses or considerations for this font pairing."
        }
    },
    required: ['overallScore', 'analysis', 'pros', 'cons']
};

/**
 * Critique font pairing using Chrome AI (built-in Prompt API)
 * Uses the new window.ai.languageModel API
 */
const critiqueFontPairing_Chrome = async (font1: FontAnalysis, font2: FontAnalysis): Promise<PairingCritique> => {
    if (!window.ai?.languageModel) {
        throw new Error("Chrome AI is not available. Please enable it or switch to Cloud AI mode.");
    }

    const prompt = `You are a typography expert. Critique the pairing of two fonts.

Font 1 (likely for headlines):
- Name: ${font1.fontName}
- Type: ${font1.fontType}
- Analysis: ${font1.analysis}

Font 2 (likely for body text):
- Name: ${font2.fontName}
- Type: ${font2.fontType}
- Analysis: ${font2.analysis}

Evaluate their harmony, contrast, x-height relationship, and overall effectiveness. Provide a score from 1-10 and a detailed analysis.

You MUST respond with ONLY a valid JSON object with this exact structure (no markdown, no code blocks):
{
  "overallScore": <number 1-10>,
  "analysis": "<detailed paragraph>",
  "pros": ["<strength 1>", "<strength 2>", ...],
  "cons": ["<weakness 1>", "<weakness 2>", ...]
}`;

    try {
        const session = await window.ai.languageModel.create();
        const response = await session.prompt(prompt);
        session.destroy();

        // Parse the response
        const jsonMatch = response.match(/\{[\s\S]*\}/);
        if (!jsonMatch) {
            throw new Error("Chrome AI did not return valid JSON");
        }

        return JSON.parse(jsonMatch[0]) as PairingCritique;
    } catch (error) {
        console.error("Error critiquing font pairing with Chrome AI:", error);
        throw new Error("Failed to get a valid critique from Chrome AI.");
    }
};

/**
 * Critique font pairing using Cloud AI (Gemini API)
 */
const critiqueFontPairing_Cloud = async (font1: FontAnalysis, font2: FontAnalysis): Promise<PairingCritique> => {
    const ai = getCloudAI();
    const prompt = `You are a typography expert. Critique the pairing of two fonts.
Font 1 (likely for headlines):
- Name: ${font1.fontName}
- Type: ${font1.fontType}
- Analysis: ${font1.analysis}

Font 2 (likely for body text):
- Name: ${font2.fontName}
- Type: ${font2.fontType}
- Analysis: ${font2.analysis}

Evaluate their harmony, contrast, x-height relationship, and overall effectiveness. Provide a score from 1-10 and a detailed analysis. Your response MUST be a JSON object conforming to the schema. Do not output markdown format.`;

    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: pairingCritiqueSchema,
            },
        });

        const jsonText = response.text.trim();
        return JSON.parse(jsonText) as PairingCritique;

    } catch (error) {
        console.error("Error critiquing font pairing with Cloud AI:", error);
        throw new Error(parseAPIError(error));
    }
};

/**
 * Main critiqueFontPairing function - routes to appropriate implementation based on current AI mode
 */
export const critiqueFontPairing = async (font1: FontAnalysis, font2: FontAnalysis): Promise<PairingCritique> => {
    const mode = await getAIMode();
    const validation = await validateAIMode(mode);

    if (!validation.valid) {
        throw new Error(validation.error || `${mode} AI is not available.`);
    }

    if (mode === 'chrome') {
        return critiqueFontPairing_Chrome(font1, font2);
    } else {
        return critiqueFontPairing_Cloud(font1, font2);
    }
};


/**
 * Generate funny sentence using Chrome AI
 * Uses the new window.ai.languageModel API
 */
const generateFunnySentence_Chrome = async (): Promise<string> => {
    if (!window.ai?.languageModel) {
        throw new Error("Chrome AI is not available.");
    }

    const prompt = "Generate a single, short, funny sentence that is a pangram (contains all letters of the alphabet). Make it creative and whimsical. Only return the sentence itself, with no extra text or quotation marks.";

    try {
        const session = await window.ai.languageModel.create();
        const response = await session.prompt(prompt);
        session.destroy();
        return response.trim();
    } catch (error) {
        console.error("Error generating sentence with Chrome AI:", error);
        return "The quick brown fox jumps over the lazy dog.";
    }
};

/**
 * Generate funny sentence using Cloud AI
 */
const generateFunnySentence_Cloud = async (): Promise<string> => {
    const ai = getCloudAI();
    const prompt = "Generate a single, short, funny sentence that is a pangram (contains all letters of the alphabet). Make it creative and whimsical. Only return the sentence itself, with no extra text or quotation marks.";
    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
        });
        return response.text.trim();
    } catch (error) {
        console.error("Error generating sentence with Cloud AI:", error);
        return "The quick brown fox jumps over the lazy dog.";
    }
};

/**
 * Main generateFunnySentence function - routes to appropriate implementation
 */
export const generateFunnySentence = async (): Promise<string> => {
    try {
        const mode = await getAIMode();
        const validation = await validateAIMode(mode);

        if (!validation.valid) {
            return "The quick brown fox jumps over the lazy dog.";
        }

        if (mode === 'chrome') {
            return await generateFunnySentence_Chrome();
        } else {
            return await generateFunnySentence_Cloud();
        }
    } catch (error) {
        console.error("Error in generateFunnySentence:", error);
        return "The quick brown fox jumps over the lazy dog.";
    }
};

const glyphComparisonSchema = {
    type: Type.OBJECT,
    properties: {
        character: {
            type: Type.STRING,
            description: "The character being compared."
        },
        font1Analysis: {
            type: Type.STRING,
            description: "Analysis of how this character appears in the first font."
        },
        font2Analysis: {
            type: Type.STRING,
            description: "Analysis of how this character appears in the second font."
        },
        differences: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "A list of specific differences between the two glyphs."
        },
        readabilityScore: {
            type: Type.INTEGER,
            description: "A score from 1 (poor) to 10 (excellent) for overall readability and clarity of this character across both fonts."
        }
    },
    required: ['character', 'font1Analysis', 'font2Analysis', 'differences', 'readabilityScore']
};

const glyphComparisonResultSchema = {
    type: Type.OBJECT,
    properties: {
        overallAssessment: {
            type: Type.STRING,
            description: "A paragraph summarizing the overall comparison between the two fonts' glyph characteristics and legibility."
        },
        comparisons: {
            type: Type.ARRAY,
            items: glyphComparisonSchema,
            description: "An array of individual glyph comparisons for the specified characters."
        }
    },
    required: ['overallAssessment', 'comparisons']
};

/**
 * Compare glyphs between two fonts
 *
 * NOTE: This function requires image processing, which Chrome AI (Prompt API) does not support.
 * Therefore, this function ALWAYS uses Cloud AI regardless of the selected mode.
 */
export const compareGlyphs = async (
    font1ImageBase64: string,
    font2ImageBase64: string,
    font1Name: string,
    font2Name: string,
    charactersToCompare: string[] = ['I', 'l', '1', 'O', '0', 'a', 'g', 'q']
): Promise<GlyphComparisonResult> => {
    // Validate that Cloud AI is available
    const validation = await validateAIMode('cloud');
    if (!validation.valid) {
        throw new Error(validation.error || "Cloud AI is required for glyph comparison but is not available.");
    }

    const ai = getCloudAI();
    const prompt = `You are a typography expert specializing in glyph analysis and character legibility. Compare the following characters between two fonts:

Font 1: ${font1Name}
Font 2: ${font2Name}

Characters to compare: ${charactersToCompare.join(', ')}

For each character:
1. Analyze how it appears in each font (form, stroke weight, distinguishing features)
2. Identify key differences that affect legibility
3. Note potential confusion with other similar characters
4. Rate the overall readability (1-10, where 10 is perfectly clear and distinct)

Provide an overall assessment of which font has superior glyph clarity and why. Your response MUST be a JSON object conforming to the schema. Do not output markdown format.`;

    const filePart1 = {
        inlineData: {
            data: font1ImageBase64.split(',')[1] || font1ImageBase64,
            mimeType: 'image/png',
        },
    };

    const filePart2 = {
        inlineData: {
            data: font2ImageBase64.split(',')[1] || font2ImageBase64,
            mimeType: 'image/png',
        },
    };

    const textPart = {
        text: prompt,
    };

    const contents = { parts: [textPart, filePart1, filePart2] };

    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: contents,
            config: {
                responseMimeType: 'application/json',
                responseSchema: glyphComparisonResultSchema,
            },
        });

        const jsonText = response.text.trim();
        return JSON.parse(jsonText) as GlyphComparisonResult;

    } catch (error) {
        console.error("Error comparing glyphs:", error);
        throw new Error(parseAPIError(error));
    }
};

// ===========================
// Font Suggestion Service
// ===========================

const fontSuggestionSchema = {
    type: Type.OBJECT,
    properties: {
        fontName: {
            type: Type.STRING,
            description: "The name of the Google Font (must match exactly from the provided list)"
        },
        category: {
            type: Type.STRING,
            description: "The font category: serif, sans-serif, display, handwriting, or monospace"
        },
        rationale: {
            type: Type.STRING,
            description: "2-3 sentences explaining why this font is suitable for the user's requirements"
        },
        useCases: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "Specific use cases where this font excels (e.g., Headers, Body Text, Logo)"
        },
        matchScore: {
            type: Type.INTEGER,
            description: "Relevance score from 1-10 indicating how well this font matches the requirements"
        }
    },
    required: ['fontName', 'category', 'rationale', 'useCases', 'matchScore']
};

const fontSuggestionResultSchema = {
    type: Type.OBJECT,
    properties: {
        suggestions: {
            type: Type.ARRAY,
            items: fontSuggestionSchema,
            description: "Array of 3-5 font recommendations, ranked by relevance"
        },
        searchSummary: {
            type: Type.STRING,
            description: "A brief summary of what was searched for and the approach taken"
        },
        additionalNotes: {
            type: Type.STRING,
            description: "Any additional context or recommendations for the user"
        }
    },
    required: ['suggestions', 'searchSummary']
};

/**
 * Suggests Google Fonts based on user requirements.
 * Uses Gemini AI to intelligently filter and rank fonts.
 *
 * @param request - User's search criteria and preferences
 * @param availableFonts - Array of font names to choose from
 * @returns Structured font suggestions with rationales
 */
export const suggestFonts = async (
    request: FontSuggestionRequest,
    availableFonts: string[]
): Promise<FontSuggestionResult> => {
    // Validate Cloud AI is available
    const validation = await validateAIMode('cloud');
    if (!validation.valid) {
        throw new Error(validation.error || "Cloud AI is required for font suggestions");
    }

    const ai = getCloudAI();

    // Build categories description
    const categoriesDesc: string[] = [];
    if (request.usageTypes?.length) {
        categoriesDesc.push(`Usage Types: ${request.usageTypes.join(', ')}`);
    }
    if (request.businessTypes?.length) {
        categoriesDesc.push(`Business Types: ${request.businessTypes.join(', ')}`);
    }
    if (request.themes?.length) {
        categoriesDesc.push(`Themes: ${request.themes.join(', ')}`);
    }
    if (request.fontCategories?.length) {
        categoriesDesc.push(`Font Categories: ${request.fontCategories.join(', ')}`);
    }

    const maxResults = request.maxResults || 5;

    // Limit font list to prevent token overflow (top 800 is reasonable)
    const fontList = availableFonts.slice(0, 800);

    const prompt = `You are an expert typography consultant specializing in font selection for digital and print projects. Your task is to recommend Google Fonts based on the user's requirements.

USER'S PROJECT:
${request.description || 'Not specified'}

SELECTED CATEGORIES:
${categoriesDesc.length > 0 ? categoriesDesc.join('\n') : 'None specified'}

AVAILABLE GOOGLE FONTS (${fontList.length} total):
${fontList.join(', ')}

INSTRUCTIONS:
1. Analyze the user's requirements carefully
2. Select ${maxResults} fonts from the available Google Fonts list that best match the criteria
3. For each font, provide:
   - The exact font name (must match the list exactly, case-sensitive)
   - Font category (serif, sans-serif, display, handwriting, monospace)
   - Clear rationale (2-3 sentences) explaining why it fits
   - Specific use cases (Headers, Body Text, Logo, UI, etc.)
   - Match score (1-10) based on relevance

4. Prioritize:
   - Versatility: Fonts with multiple weights/styles when possible
   - Readability: Especially for body text use cases
   - Appropriateness: Match the business type and theme
   - Availability: Only recommend fonts from the provided list

5. Order suggestions by match score (highest first)

IMPORTANT:
- Font names must EXACTLY match the provided list (case-sensitive)
- Do not recommend fonts not in the list
- Provide diverse suggestions (mix of serif/sans-serif if appropriate)
- Consider pairing potential if user needs multiple font types

Your response MUST be a JSON object conforming to the schema. Do not output markdown format.`;

    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: fontSuggestionResultSchema,
            },
        });

        const jsonText = response.text.trim();
        return JSON.parse(jsonText) as FontSuggestionResult;

    } catch (error) {
        console.error("Error getting font suggestions:", error);
        throw new Error(parseAPIError(error));
    }
};

// ===========================
// Font DNA Matching Service
// ===========================

const fontDNAMatchSchema = {
    type: Type.OBJECT,
    properties: {
        fontName: {
            type: Type.STRING,
            description: "The name of the similar font"
        },
        source: {
            type: Type.STRING,
            description: "Where to get this font (Google Fonts, Adobe Fonts, MyFonts, Fontshare, etc.)"
        },
        matchScore: {
            type: Type.INTEGER,
            description: "Similarity score from 1-100 indicating how closely this matches the reference font"
        },
        visualSimilarity: {
            type: Type.STRING,
            description: "Description of the visual characteristics that make this font similar (stroke weight, x-height, proportions, etc.)"
        },
        differingCharacteristics: {
            type: Type.STRING,
            description: "What makes this font different or unique compared to the reference"
        },
        bestUseCase: {
            type: Type.STRING,
            description: "When to use this alternative instead of the reference font"
        },
        isPremium: {
            type: Type.BOOLEAN,
            description: "Whether this font requires a paid license"
        },
        directLink: {
            type: Type.STRING,
            description: "Direct URL to the font's page on its source website"
        }
    },
    required: ['fontName', 'source', 'matchScore', 'visualSimilarity', 'differingCharacteristics', 'bestUseCase', 'isPremium']
};

const fontDNAResultSchema = {
    type: Type.OBJECT,
    properties: {
        referenceFont: {
            type: Type.STRING,
            description: "The name of the font being analyzed"
        },
        totalMatches: {
            type: Type.INTEGER,
            description: "Total number of similar fonts found"
        },
        matches: {
            type: Type.ARRAY,
            items: fontDNAMatchSchema,
            description: "Array of 5-10 similar fonts, sorted by match score"
        },
        analysisNotes: {
            type: Type.STRING,
            description: "AI commentary on the matching process and what characteristics were used to find similar fonts"
        },
        characteristics: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "Key visual DNA characteristics identified in the reference font that were used for matching (e.g., 'high x-height', 'humanist sans-serif', 'geometric forms')"
        }
    },
    required: ['referenceFont', 'totalMatches', 'matches', 'analysisNotes', 'characteristics']
};

/**
 * Find similar fonts based on a reference font's "DNA" (visual characteristics)
 *
 * @param referenceFont - The FontAnalysis of the font to find alternatives for
 * @returns FontDNAResult with 5-10 similar fonts from various sources
 */
export const findSimilarFonts = async (referenceFont: FontAnalysis): Promise<FontDNAResult> => {
    // Validate Cloud AI is available
    const validation = await validateAIMode('cloud');
    if (!validation.valid) {
        throw new Error(validation.error || "Cloud AI is required for Font DNA matching");
    }

    const ai = getCloudAI();

    const prompt = `You are a typography expert specializing in font matching and alternatives. Your task is to find fonts that are visually similar to a reference font, useful when designers need alternatives for licensing, cost, or availability reasons.

REFERENCE FONT ANALYSIS:
- Name: ${referenceFont.fontName}
- Type: ${referenceFont.fontType}
- Designer: ${referenceFont.designer}
- Foundry: ${referenceFont.fontFoundry || 'Unknown'}
- Analysis: ${referenceFont.analysis}
- Historical Context: ${referenceFont.historicalContext}

TASK:
Find 5-10 fonts that share similar visual DNA with the reference font. Consider these characteristics when matching:

1. **Structural DNA:**
   - Serif style (hairline, slab, bracketed, etc.) or sans-serif construction
   - Stroke contrast and weight distribution
   - x-height and proportions
   - Letter width and spacing characteristics

2. **Personality DNA:**
   - Geometric vs humanist vs grotesque forms
   - Formal vs informal feeling
   - Modern vs classic aesthetic
   - Technical vs organic character shapes

3. **Practical DNA:**
   - Similar use cases (body text, headlines, UI)
   - Comparable legibility at different sizes
   - Weight/style range availability

REQUIREMENTS:
- Include fonts from MULTIPLE sources (mix free and premium):
  * Google Fonts (free)
  * Adobe Fonts (subscription)
  * Fontshare (free)
  * MyFonts (commercial)
  * Font Squirrel (free commercial-use)
  * Other reputable foundries
- Sort by match score (highest first)
- Be specific about visual similarities
- Explain when each alternative would be preferable
- Include direct links where possible (e.g., https://fonts.google.com/specimen/FontName)

Your response MUST be a JSON object conforming to the schema. Do not output markdown format.`;

    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: fontDNAResultSchema,
            },
        });

        const jsonText = response.text.trim();
        return JSON.parse(jsonText) as FontDNAResult;

    } catch (error) {
        console.error("Error finding similar fonts:", error);
        throw new Error(parseAPIError(error));
    }
};

// ===========================
// Typography Context Service
// ===========================

const typographyContextSchema = {
    type: Type.OBJECT,
    properties: {
        fontName: {
            type: Type.STRING,
            description: "The name of the font being analyzed"
        },
        historicalUsage: {
            type: Type.STRING,
            description: "Detailed historical usage of this font, including when it was popular and how its usage has evolved over time"
        },
        currentTrends: {
            type: Type.STRING,
            description: "Current typography trends in 2025 and how this font fits into them. Is it trending up, classic and timeless, or fading?"
        },
        pairingTrends: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "List of 3-5 fonts that are commonly paired with this font in professional design work"
        },
        recommendations: {
            type: Type.STRING,
            description: "Professional recommendations for when and how to use this font effectively"
        },
        culturalContext: {
            type: Type.STRING,
            description: "Cultural or regional considerations - is this font more popular in certain regions? Any cultural associations to be aware of?"
        }
    },
    required: ['fontName', 'historicalUsage', 'currentTrends', 'pairingTrends', 'recommendations', 'culturalContext']
};

/**
 * Get typography context and trends for a font
 *
 * @param fontAnalysis - The FontAnalysis of the font to get context for
 * @returns TypographyContextResult with historical usage, trends, and recommendations
 */
export const getTypographyContext = async (fontAnalysis: FontAnalysis): Promise<import('../types').TypographyContextResult> => {
    // Validate Cloud AI is available
    const validation = await validateAIMode('cloud');
    if (!validation.valid) {
        throw new Error(validation.error || "Cloud AI is required for typography context");
    }

    const ai = getCloudAI();

    const prompt = `You are a typography historian and trends expert. Provide comprehensive context about a font's usage, history, and current relevance in professional design.

FONT INFORMATION:
- Name: ${fontAnalysis.fontName}
- Type: ${fontAnalysis.fontType}
- Designer: ${fontAnalysis.designer}
- Foundry: ${fontAnalysis.fontFoundry || 'Unknown'}
- Historical Context: ${fontAnalysis.historicalContext}
- Analysis: ${fontAnalysis.analysis}

TASK:
Provide detailed typography context including:

1. **Historical Usage**: When was this font most popular? How has its usage evolved over time? Describe historical applications in print, advertising, signage, etc.

2. **Current Trends (2025)**: Is this font trending? Part of a resurgence? A timeless classic? How does it fit into current design movements (minimalism, neo-brutalism, Y2K revival, etc.)?

3. **Common Pairings**: What fonts are professionals typically pairing with this one?

4. **Professional Recommendations**: Best practices for using this font effectively. What to avoid. Optimal use cases.

5. **Cultural Context**: Regional popularity, cultural associations, any considerations designers should be aware of.

Your response MUST be a JSON object conforming to the schema. Do not output markdown format.`;

    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: typographyContextSchema,
            },
        });

        const jsonText = response.text.trim();
        return JSON.parse(jsonText);

    } catch (error) {
        console.error("Error getting typography context:", error);
        throw new Error(parseAPIError(error));
    }
};

// ===========================
// Batch Compatibility Matrix
// ===========================

const pairingScoreSchema = {
    type: Type.OBJECT,
    properties: {
        font1: {
            type: Type.STRING,
            description: "Name of the first font in the pairing"
        },
        font2: {
            type: Type.STRING,
            description: "Name of the second font in the pairing"
        },
        score: {
            type: Type.INTEGER,
            description: "Compatibility score from 1-10"
        },
        quickNote: {
            type: Type.STRING,
            description: "Brief 1-2 sentence note about why this pairing works or doesn't work"
        }
    },
    required: ['font1', 'font2', 'score', 'quickNote']
};

const batchCompatibilitySchema = {
    type: Type.OBJECT,
    properties: {
        fonts: {
            type: Type.ARRAY,
            items: { type: Type.STRING },
            description: "List of font names that were analyzed"
        },
        pairings: {
            type: Type.ARRAY,
            items: pairingScoreSchema,
            description: "All pairwise compatibility scores for the fonts"
        },
        topPairings: {
            type: Type.ARRAY,
            items: pairingScoreSchema,
            description: "Top 3 best font pairings from the set"
        },
        worstPairings: {
            type: Type.ARRAY,
            items: pairingScoreSchema,
            description: "Bottom 3 worst font pairings from the set"
        },
        overallNotes: {
            type: Type.STRING,
            description: "General observations about the font collection and how well it works together as a system"
        }
    },
    required: ['fonts', 'pairings', 'topPairings', 'worstPairings', 'overallNotes']
};

/**
 * Analyze compatibility between multiple fonts in batch
 * Creates a compatibility matrix showing how well each font pairs with others
 *
 * @param fonts - Array of FontAnalysis objects to compare
 * @returns BatchCompatibilityResult with pairwise scores and recommendations
 */
export const analyzeBatchCompatibility = async (fonts: FontAnalysis[]): Promise<BatchCompatibilityResult> => {
    // Validate Cloud AI is available
    const validation = await validateAIMode('cloud');
    if (!validation.valid) {
        throw new Error(validation.error || "Cloud AI is required for batch compatibility analysis");
    }

    if (fonts.length < 2) {
        throw new Error("At least 2 fonts are required for compatibility analysis");
    }

    if (fonts.length > 8) {
        throw new Error("Maximum 8 fonts can be analyzed at once");
    }

    const ai = getCloudAI();

    // Build font descriptions for the prompt
    const fontDescriptions = fonts.map((font, index) =>
        `${index + 1}. **${font.fontName}**
   - Type: ${font.fontType}
   - Characteristics: ${font.analysis.substring(0, 200)}...`
    ).join('\n\n');

    const prompt = `You are a typography expert specializing in font pairing and type system design. Your task is to analyze the compatibility between multiple fonts and create a compatibility matrix.

FONTS TO ANALYZE:
${fontDescriptions}

TASK:
Analyze every possible pairing between these ${fonts.length} fonts. For each pair:

1. **Score (1-10)**: Rate how well the two fonts work together
   - 1-3: Poor pairing, conflicting characteristics
   - 4-5: Mediocre, works but not ideal
   - 6-7: Good pairing with some considerations
   - 8-10: Excellent pairing, highly complementary

2. **Quick Note**: Explain in 1-2 sentences why this pairing works or doesn't

CONSIDER:
- Contrast: Do they have sufficient visual contrast without clashing?
- Harmony: Do they share enough characteristics to feel cohesive?
- Hierarchy: Can they establish clear visual hierarchy?
- X-height: Are their x-heights compatible for mixed use?
- Weight: Do available weights complement each other?
- Use case fit: Would they work together in real projects?

ALSO PROVIDE:
- Top 3 best pairings from all combinations
- Bottom 3 worst pairings to avoid
- Overall notes about how this font collection works as a design system

Your response MUST be a JSON object conforming to the schema. Do not output markdown format.`;

    try {
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: batchCompatibilitySchema,
            },
        });

        const jsonText = response.text.trim();
        return JSON.parse(jsonText) as BatchCompatibilityResult;

    } catch (error) {
        console.error("Error analyzing batch compatibility:", error);
        throw new Error(parseAPIError(error));
    }
};


================================================================================
FILE PATH: services\googleFontsService.ts
================================================================================
import type { GoogleFontMetadata } from '../types';

// A curated list of popular Google Fonts (fallback).
const popularFonts = [
  'Roboto', 'Open Sans', 'Lato', 'Montserrat', 'Roboto Condensed', 'Source Sans Pro', 'Oswald',
  'Raleway', 'PT Sans', 'Merriweather', 'Noto Sans', 'Slabo 27px', 'Poppins', 'Playfair Display',
  'Ubuntu', 'Lora', 'Nunito', 'PT Serif', 'Titillium Web', 'Fira Sans', 'Work Sans', 'Inter',
  'Quicksand', 'Karla', 'Arimo', 'Dosis', 'Oxygen', 'Inconsolata', 'Josefin Sans', 'Cabin',
  'Bitter', 'Anton', 'Yanone Kaffeesatz', 'Lobster', 'Pacifico', 'Bebas Neue', 'Exo 2',
  'Crimson Text', 'Fjalla One', 'Vollkorn', 'Dancing Script', 'Shadows Into Light', 'Amatic SC',
  'Indie Flower', 'Caveat', 'Comfortaa', 'Righteous', 'Archivo', 'Zilla Slab', 'Barlow'
];

const CACHE_KEY = 'google_fonts_cache';
const CACHE_EXPIRY_DAYS = 7;

interface CachedFonts {
    fonts: GoogleFontMetadata[];
    timestamp: number;
}

/**
 * Fetches the complete list of Google Fonts from the API.
 * Uses caching to minimize API calls (7-day expiry).
 */
export const getAllGoogleFonts = async (): Promise<GoogleFontMetadata[]> => {
    // Check cache first
    const cached = getCachedFonts();
    if (cached) {
        console.log('Using cached Google Fonts list');
        return cached;
    }

    try {
        // Fetch from Google Fonts API (no key required for basic use)
        const response = await fetch('https://www.googleapis.com/webfonts/v1/webfonts?sort=popularity');

        if (!response.ok) {
            throw new Error(`Google Fonts API error: ${response.status}`);
        }

        const data = await response.json();
        const fonts: GoogleFontMetadata[] = data.items.map((item: any, index: number) => ({
            family: item.family,
            category: item.category,
            variants: item.variants || [],
            subsets: item.subsets || [],
            popularity: index + 1  // Index in popularity-sorted list
        }));

        // Cache the results
        cacheFonts(fonts);
        console.log(`Fetched ${fonts.length} Google Fonts from API`);

        return fonts;
    } catch (error) {
        console.error('Failed to fetch Google Fonts from API:', error);
        // Fallback to static list
        return getFallbackFonts();
    }
};

/**
 * Gets the top N most popular fonts.
 */
export const getPopularGoogleFonts = async (limit: number = 800): Promise<GoogleFontMetadata[]> => {
    const allFonts = await getAllGoogleFonts();
    return allFonts.slice(0, limit);
};

/**
 * Gets just the font names (for backwards compatibility).
 */
export const getGoogleFonts = async (): Promise<string[]> => {
    return Promise.resolve(popularFonts.sort());
};

/**
 * Filters fonts by category.
 */
export const getFontsByCategory = async (categories: string[]): Promise<GoogleFontMetadata[]> => {
    if (!categories.length) return getAllGoogleFonts();

    const allFonts = await getAllGoogleFonts();
    return allFonts.filter(font => categories.includes(font.category));
};

// Cache management functions
function getCachedFonts(): GoogleFontMetadata[] | null {
    try {
        const cached = localStorage.getItem(CACHE_KEY);
        if (!cached) return null;

        const data: CachedFonts = JSON.parse(cached);
        const now = Date.now();
        const expiryTime = CACHE_EXPIRY_DAYS * 24 * 60 * 60 * 1000;

        if (now - data.timestamp > expiryTime) {
            // Cache expired
            localStorage.removeItem(CACHE_KEY);
            return null;
        }

        return data.fonts;
    } catch (error) {
        console.error('Error reading font cache:', error);
        return null;
    }
}

function cacheFonts(fonts: GoogleFontMetadata[]): void {
    try {
        const data: CachedFonts = {
            fonts,
            timestamp: Date.now()
        };
        localStorage.setItem(CACHE_KEY, JSON.stringify(data));
    } catch (error) {
        console.error('Error caching fonts:', error);
    }
}

function getFallbackFonts(): GoogleFontMetadata[] {
    // Convert static list to metadata format
    return popularFonts.map((family, index) => ({
        family,
        category: 'sans-serif', // Default category
        variants: ['regular'],
        subsets: ['latin'],
        popularity: index + 1
    }));
}


================================================================================
FILE PATH: services\licenseService.ts
================================================================================
import { createClient } from '@supabase/supabase-js';
import FingerprintJS from '@fingerprintjs/fingerprintjs';

// Initialize Supabase client
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || '';
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || '';

const supabase = supabaseUrl && supabaseAnonKey
    ? createClient(supabaseUrl, supabaseAnonKey)
    : null;

// LocalStorage keys
const LICENSE_STORAGE_KEY = 'cadmus_license_data';
const LAST_VALIDATION_KEY = 'cadmus_last_validation';

// Types
export interface LicenseData {
    licenseKey: string;
    deviceFingerprint: string;
    validatedAt: string;
    expiresAt?: string;
    maxDevices?: number;
}

export interface ValidationResult {
    valid: boolean;
    error?: string;
    code?: string;
    licenseKey?: string;
    maxDevices?: number;
    currentDevices?: number;
    expiresAt?: string;
    message?: string;
}

export interface LicenseInfo {
    found: boolean;
    licenseKey?: string;
    isActive?: boolean;
    maxDevices?: number;
    activeDevices?: number;
    expiresAt?: string;
    activations?: Array<{
        deviceFingerprint: string;
        deviceName?: string;
        activatedAt: string;
        lastUsed: string;
        isCurrent: boolean;
    }>;
    error?: string;
}

// Initialize FingerprintJS
let fpPromise: Promise<any> | null = null;

const initFingerprint = () => {
    if (!fpPromise) {
        fpPromise = FingerprintJS.load();
    }
    return fpPromise;
};

/**
 * Get device fingerprint
 */
export const getDeviceFingerprint = async (): Promise<string> => {
    try {
        const fp = await initFingerprint();
        const result = await fp.get();
        return result.visitorId;
    } catch (error) {
        console.error('Error generating fingerprint:', error);
        // Fallback to simple browser fingerprint
        return generateSimpleFingerprint();
    }
};

/**
 * Simple fallback fingerprint based on browser characteristics
 */
const generateSimpleFingerprint = (): string => {
    const nav = window.navigator;
    const screen = window.screen;

    const data = [
        nav.userAgent,
        nav.language,
        screen.colorDepth,
        screen.width + 'x' + screen.height,
        new Date().getTimezoneOffset(),
        !!window.sessionStorage,
        !!window.localStorage
    ].join('|');

    // Simple hash function
    let hash = 0;
    for (let i = 0; i < data.length; i++) {
        const char = data.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32bit integer
    }
    return 'fallback_' + Math.abs(hash).toString(36);
};

/**
 * Check if Supabase is configured
 */
export const isSupabaseConfigured = (): boolean => {
    return !!supabase && !!supabaseUrl && !!supabaseAnonKey;
};

/**
 * Get stored license data from localStorage
 */
export const getStoredLicense = (): LicenseData | null => {
    try {
        const stored = localStorage.getItem(LICENSE_STORAGE_KEY);
        if (!stored) return null;
        return JSON.parse(stored);
    } catch (error) {
        console.error('Error reading stored license:', error);
        return null;
    }
};

/**
 * Store license data in localStorage
 */
export const storeLicense = (data: LicenseData): void => {
    try {
        localStorage.setItem(LICENSE_STORAGE_KEY, JSON.stringify(data));
        localStorage.setItem(LAST_VALIDATION_KEY, new Date().toISOString());
    } catch (error) {
        console.error('Error storing license:', error);
    }
};

/**
 * Clear stored license data
 */
export const clearStoredLicense = (): void => {
    try {
        localStorage.removeItem(LICENSE_STORAGE_KEY);
        localStorage.removeItem(LAST_VALIDATION_KEY);
    } catch (error) {
        console.error('Error clearing license:', error);
    }
};

/**
 * Check if stored license needs revalidation
 * Revalidate every 7 days
 */
export const needsRevalidation = (): boolean => {
    try {
        const lastValidation = localStorage.getItem(LAST_VALIDATION_KEY);
        if (!lastValidation) return true;

        const lastDate = new Date(lastValidation);
        const now = new Date();
        const daysSince = (now.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24);

        return daysSince > 7; // Revalidate after 7 days
    } catch (error) {
        return true;
    }
};

/**
 * Validate license key with Supabase
 */
export const validateLicenseKey = async (
    licenseKey: string,
    deviceFingerprint?: string
): Promise<ValidationResult> => {
    if (!isSupabaseConfigured()) {
        return {
            valid: false,
            error: 'License validation is not configured. Please check your environment variables.',
            code: 'NOT_CONFIGURED'
        };
    }

    try {
        // Get device fingerprint if not provided
        const fingerprint = deviceFingerprint || await getDeviceFingerprint();

        // Call Supabase RPC function
        const { data, error } = await supabase!.rpc('validate_license_key', {
            p_license_key: licenseKey.trim().toUpperCase(),
            p_device_fingerprint: fingerprint
        });

        if (error) {
            console.error('Supabase validation error:', error);
            return {
                valid: false,
                error: 'Failed to validate license key. Please try again.',
                code: 'VALIDATION_FAILED'
            };
        }

        // Parse result
        const result = typeof data === 'string' ? JSON.parse(data) : data;

        if (result.success) {
            // Store license locally
            storeLicense({
                licenseKey: result.license_key,
                deviceFingerprint: fingerprint,
                validatedAt: new Date().toISOString(),
                expiresAt: result.expires_at,
                maxDevices: result.max_devices
            });

            // Convert 'success' to 'valid' for consistency with existing code
            return {
                valid: true,
                licenseKey: result.license_key,
                maxDevices: result.max_devices,
                expiresAt: result.expires_at,
                message: result.message
            };
        }

        // Convert 'success: false' to 'valid: false' for consistency
        return {
            valid: false,
            error: result.error,
            code: 'VALIDATION_FAILED',
            currentDevices: result.current_devices,
            maxDevices: result.max_devices
        };

    } catch (error) {
        console.error('License validation error:', error);
        return {
            valid: false,
            error: 'An unexpected error occurred. Please try again.',
            code: 'UNKNOWN_ERROR'
        };
    }
};

/**
 * Check activation status for stored license
 */
export const checkActivationStatus = async (): Promise<ValidationResult> => {
    const stored = getStoredLicense();

    if (!stored) {
        return {
            valid: false,
            error: 'No license found',
            code: 'NO_LICENSE'
        };
    }

    if (!isSupabaseConfigured()) {
        // Allow offline use if previously validated within last 30 days
        const lastValidation = localStorage.getItem(LAST_VALIDATION_KEY);
        if (lastValidation) {
            const lastDate = new Date(lastValidation);
            const now = new Date();
            const daysSince = (now.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24);

            if (daysSince < 30) {
                return {
                    valid: true,
                    licenseKey: stored.licenseKey,
                    message: 'Offline mode - using cached license'
                };
            }
        }

        return {
            valid: false,
            error: 'Unable to verify license. Please check your internet connection.',
            code: 'OFFLINE'
        };
    }

    // Check if needs revalidation
    if (!needsRevalidation()) {
        return {
            valid: true,
            licenseKey: stored.licenseKey,
            maxDevices: stored.maxDevices,
            expiresAt: stored.expiresAt
        };
    }

    // Revalidate with server
    return await validateLicenseKey(stored.licenseKey, stored.deviceFingerprint);
};

/**
 * Deactivate current device
 */
export const deactivateDevice = async (
    licenseKey?: string,
    deviceFingerprint?: string
): Promise<{ success: boolean; error?: string; message?: string }> => {
    if (!isSupabaseConfigured()) {
        return {
            success: false,
            error: 'License management is not configured.'
        };
    }

    try {
        const stored = getStoredLicense();
        const key = licenseKey || stored?.licenseKey;
        const fingerprint = deviceFingerprint || stored?.deviceFingerprint || await getDeviceFingerprint();

        if (!key) {
            return {
                success: false,
                error: 'No license key provided'
            };
        }

        const { data, error } = await supabase!.rpc('deactivate_device', {
            p_license_key: key,
            p_device_fingerprint: fingerprint
        });

        if (error) {
            console.error('Deactivation error:', error);
            return {
                success: false,
                error: 'Failed to deactivate device'
            };
        }

        const result = typeof data === 'string' ? JSON.parse(data) : data;

        if (result.success) {
            clearStoredLicense();
        }

        return result;

    } catch (error) {
        console.error('Device deactivation error:', error);
        return {
            success: false,
            error: 'An unexpected error occurred'
        };
    }
};

/**
 * Get detailed license information
 */
export const getLicenseInfo = async (
    licenseKey?: string,
    deviceFingerprint?: string
): Promise<LicenseInfo> => {
    if (!isSupabaseConfigured()) {
        return {
            found: false,
            error: 'License system is not configured'
        };
    }

    try {
        const stored = getStoredLicense();
        const key = licenseKey || stored?.licenseKey;

        if (!key) {
            return {
                found: false,
                error: 'No license key provided'
            };
        }

        const { data, error } = await supabase!.rpc('get_license_info', {
            p_license_key: key
        });

        if (error) {
            console.error('Get license info error:', error);
            return {
                found: false,
                error: 'Failed to retrieve license information'
            };
        }

        const result = typeof data === 'string' ? JSON.parse(data) : data;

        // Convert SQL response to LicenseInfo format
        if (result.success) {
            return {
                found: true,
                licenseKey: result.license_key,
                isActive: result.is_active,
                maxDevices: result.max_devices,
                activeDevices: result.current_devices,
                expiresAt: result.expires_at
            };
        }

        return {
            found: false,
            error: result.error || 'License not found'
        };

    } catch (error) {
        console.error('License info error:', error);
        return {
            found: false,
            error: 'An unexpected error occurred'
        };
    }
};

/**
 * Format license key for display (e.g., XXXX-XXXX-XXXX-XXXX)
 */
export const formatLicenseKey = (key: string): string => {
    return key.replace(/(.{4})/g, '$1-').replace(/-$/, '');
};

/**
 * Validate license key format (basic client-side check)
 */
export const isValidLicenseFormat = (key: string): boolean => {
    // Remove spaces and dashes
    const cleaned = key.replace(/[\s-]/g, '');
    // Check if it's alphanumeric and reasonable length
    return /^[A-Z0-9]{12,32}$/i.test(cleaned);
};


================================================================================
FILE PATH: services\projectService.ts
================================================================================
import type { Project, ProjectPairing, ProjectsState, FontAnalysis, PairingCritique } from '../types';

const STORAGE_KEY = 'cadmus_projects';

// Generate unique ID
const generateId = (): string => {
    return `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;
};

// Get all projects state from localStorage
export const getProjectsState = (): ProjectsState => {
    try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
            return JSON.parse(stored);
        }
    } catch (error) {
        console.error('Error reading projects from localStorage:', error);
    }
    return { projects: [], activeProjectId: null };
};

// Save projects state to localStorage
const saveProjectsState = (state: ProjectsState): void => {
    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (error) {
        console.error('Error saving projects to localStorage:', error);
        throw new Error('Failed to save project data');
    }
};

// Create a new project
export const createProject = (name: string, description?: string, color?: string): Project => {
    const state = getProjectsState();
    const now = Date.now();

    const newProject: Project = {
        id: generateId(),
        name,
        description,
        pairings: [],
        createdAt: now,
        updatedAt: now,
        color
    };

    state.projects.push(newProject);
    state.activeProjectId = newProject.id;
    saveProjectsState(state);

    return newProject;
};

// Get a project by ID
export const getProject = (projectId: string): Project | null => {
    const state = getProjectsState();
    return state.projects.find(p => p.id === projectId) || null;
};

// Get the active project
export const getActiveProject = (): Project | null => {
    const state = getProjectsState();
    if (!state.activeProjectId) return null;
    return state.projects.find(p => p.id === state.activeProjectId) || null;
};

// Set the active project
export const setActiveProject = (projectId: string | null): void => {
    const state = getProjectsState();
    state.activeProjectId = projectId;
    saveProjectsState(state);
};

// Update a project
export const updateProject = (
    projectId: string,
    updates: Partial<Pick<Project, 'name' | 'description' | 'color'>>
): Project | null => {
    const state = getProjectsState();
    const index = state.projects.findIndex(p => p.id === projectId);

    if (index === -1) return null;

    state.projects[index] = {
        ...state.projects[index],
        ...updates,
        updatedAt: Date.now()
    };

    saveProjectsState(state);
    return state.projects[index];
};

// Delete a project
export const deleteProject = (projectId: string): boolean => {
    const state = getProjectsState();
    const index = state.projects.findIndex(p => p.id === projectId);

    if (index === -1) return false;

    state.projects.splice(index, 1);

    // If we deleted the active project, clear it
    if (state.activeProjectId === projectId) {
        state.activeProjectId = state.projects.length > 0 ? state.projects[0].id : null;
    }

    saveProjectsState(state);
    return true;
};

// Add a pairing to a project
export const addPairingToProject = (
    projectId: string,
    leftFont: FontAnalysis | null,
    rightFont: FontAnalysis | null,
    leftPreview?: string,
    rightPreview?: string,
    critique?: PairingCritique,
    notes?: string
): ProjectPairing | null => {
    const state = getProjectsState();
    const project = state.projects.find(p => p.id === projectId);

    if (!project) return null;

    const pairing: ProjectPairing = {
        id: generateId(),
        leftFont,
        rightFont,
        leftPreview,
        rightPreview,
        critique,
        createdAt: Date.now(),
        notes
    };

    project.pairings.push(pairing);
    project.updatedAt = Date.now();
    saveProjectsState(state);

    return pairing;
};

// Update a pairing in a project
export const updatePairing = (
    projectId: string,
    pairingId: string,
    updates: Partial<Pick<ProjectPairing, 'leftFont' | 'rightFont' | 'leftPreview' | 'rightPreview' | 'critique' | 'notes'>>
): ProjectPairing | null => {
    const state = getProjectsState();
    const project = state.projects.find(p => p.id === projectId);

    if (!project) return null;

    const pairingIndex = project.pairings.findIndex(p => p.id === pairingId);
    if (pairingIndex === -1) return null;

    project.pairings[pairingIndex] = {
        ...project.pairings[pairingIndex],
        ...updates
    };

    project.updatedAt = Date.now();
    saveProjectsState(state);

    return project.pairings[pairingIndex];
};

// Remove a pairing from a project
export const removePairingFromProject = (projectId: string, pairingId: string): boolean => {
    const state = getProjectsState();
    const project = state.projects.find(p => p.id === projectId);

    if (!project) return false;

    const index = project.pairings.findIndex(p => p.id === pairingId);
    if (index === -1) return false;

    project.pairings.splice(index, 1);
    project.updatedAt = Date.now();
    saveProjectsState(state);

    return true;
};

// Get all projects
export const getAllProjects = (): Project[] => {
    const state = getProjectsState();
    return state.projects;
};

// Duplicate a project
export const duplicateProject = (projectId: string, newName?: string): Project | null => {
    const state = getProjectsState();
    const original = state.projects.find(p => p.id === projectId);

    if (!original) return null;

    const now = Date.now();
    const newProject: Project = {
        id: generateId(),
        name: newName || `${original.name} (Copy)`,
        description: original.description,
        pairings: original.pairings.map(p => ({
            ...p,
            id: generateId(),
            createdAt: now
        })),
        createdAt: now,
        updatedAt: now,
        color: original.color
    };

    state.projects.push(newProject);
    saveProjectsState(state);

    return newProject;
};

// Export project data (for backup or sharing)
export const exportProjectData = (projectId: string): string | null => {
    const project = getProject(projectId);
    if (!project) return null;

    return JSON.stringify(project, null, 2);
};

// Import project data
export const importProjectData = (jsonData: string): Project | null => {
    try {
        const importedProject = JSON.parse(jsonData) as Project;

        // Validate required fields
        if (!importedProject.name || !Array.isArray(importedProject.pairings)) {
            throw new Error('Invalid project data');
        }

        // Generate new IDs to avoid conflicts
        const now = Date.now();
        const newProject: Project = {
            ...importedProject,
            id: generateId(),
            name: `${importedProject.name} (Imported)`,
            createdAt: now,
            updatedAt: now,
            pairings: importedProject.pairings.map(p => ({
                ...p,
                id: generateId()
            }))
        };

        const state = getProjectsState();
        state.projects.push(newProject);
        saveProjectsState(state);

        return newProject;
    } catch (error) {
        console.error('Error importing project:', error);
        return null;
    }
};

// Get project statistics
export const getProjectStats = (projectId: string): {
    totalPairings: number;
    uniqueFonts: number;
    averageScore: number | null;
} | null => {
    const project = getProject(projectId);
    if (!project) return null;

    const fonts = new Set<string>();
    let totalScore = 0;
    let scoreCount = 0;

    project.pairings.forEach(pairing => {
        if (pairing.leftFont?.fontName) fonts.add(pairing.leftFont.fontName);
        if (pairing.rightFont?.fontName) fonts.add(pairing.rightFont.fontName);
        if (pairing.critique?.overallScore) {
            totalScore += pairing.critique.overallScore;
            scoreCount++;
        }
    });

    return {
        totalPairings: project.pairings.length,
        uniqueFonts: fonts.size,
        averageScore: scoreCount > 0 ? Math.round((totalScore / scoreCount) * 10) / 10 : null
    };
};

// Available project colors
export const PROJECT_COLORS = [
    '#E67E22', // Orange (accent)
    '#3498DB', // Blue
    '#9B59B6', // Purple
    '#1ABC9C', // Teal
    '#E74C3C', // Red
    '#F39C12', // Yellow
    '#2ECC71', // Green
    '#34495E', // Dark blue-gray
];


================================================================================
FILE PATH: supabase-schema.sql
================================================================================
-- FontPair AI - License Key System
-- Supabase Database Schema
-- Note: License keys use CADMUS- prefix for database compatibility

-- Enable UUID extension if not already enabled
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Licenses table - stores license keys and their metadata
CREATE TABLE IF NOT EXISTS public.licenses (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    license_key TEXT UNIQUE NOT NULL,
    is_active BOOLEAN DEFAULT true NOT NULL,
    max_devices INTEGER DEFAULT 3 NOT NULL,
    purchase_email TEXT,
    purchase_date TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ, -- NULL means no expiry
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    notes TEXT
);

-- Activations table - tracks device activations per license
CREATE TABLE IF NOT EXISTS public.activations (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    license_key TEXT NOT NULL REFERENCES public.licenses(license_key) ON DELETE CASCADE,
    device_fingerprint TEXT NOT NULL,
    device_name TEXT, -- Optional: User-friendly device name
    activated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    last_used TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    ip_address TEXT, -- Optional: Track IP for security
    user_agent TEXT, -- Optional: Browser info
    is_active BOOLEAN DEFAULT true NOT NULL,
    UNIQUE(license_key, device_fingerprint)
);

-- Validation attempts table - for security and rate limiting
CREATE TABLE IF NOT EXISTS public.validation_attempts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    license_key TEXT NOT NULL,
    device_fingerprint TEXT NOT NULL,
    success BOOLEAN NOT NULL,
    attempted_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    ip_address TEXT,
    error_message TEXT
);

-- Indexes for better query performance
CREATE INDEX IF NOT EXISTS idx_licenses_key ON public.licenses(license_key);
CREATE INDEX IF NOT EXISTS idx_licenses_active ON public.licenses(is_active);
CREATE INDEX IF NOT EXISTS idx_activations_license ON public.activations(license_key);
CREATE INDEX IF NOT EXISTS idx_activations_fingerprint ON public.activations(device_fingerprint);
CREATE INDEX IF NOT EXISTS idx_validation_attempts_key ON public.validation_attempts(license_key);
CREATE INDEX IF NOT EXISTS idx_validation_attempts_time ON public.validation_attempts(attempted_at);

-- Function to update updated_at timestamp
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

-- Trigger to auto-update updated_at
CREATE TRIGGER update_licenses_updated_at BEFORE UPDATE ON public.licenses
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- Row Level Security (RLS) Policies
ALTER TABLE public.licenses ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.activations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.validation_attempts ENABLE ROW LEVEL SECURITY;

-- Policy: Anyone can read licenses (needed for validation)
CREATE POLICY "Allow public read access to licenses"
    ON public.licenses FOR SELECT
    USING (true);

-- Policy: Anyone can read activations for their license key
CREATE POLICY "Allow read access to activations with valid key"
    ON public.activations FOR SELECT
    USING (true);

-- Policy: Anyone can insert activations (for new device activation)
CREATE POLICY "Allow insert access to activations"
    ON public.activations FOR INSERT
    WITH CHECK (true);

-- Policy: Anyone can update their own activation's last_used
CREATE POLICY "Allow update access to activations"
    ON public.activations FOR UPDATE
    USING (true);

-- Policy: Anyone can insert validation attempts
CREATE POLICY "Allow insert access to validation attempts"
    ON public.validation_attempts FOR INSERT
    WITH CHECK (true);

-- Stored Procedure: Validate License Key
CREATE OR REPLACE FUNCTION validate_license_key(
    p_license_key TEXT,
    p_device_fingerprint TEXT,
    p_user_agent TEXT DEFAULT NULL,
    p_ip_address TEXT DEFAULT NULL
)
RETURNS JSON AS $$
DECLARE
    v_license RECORD;
    v_activation RECORD;
    v_active_count INTEGER;
    v_result JSON;
BEGIN
    -- Check if license exists and is active
    SELECT * INTO v_license
    FROM public.licenses
    WHERE license_key = p_license_key;

    -- License not found
    IF NOT FOUND THEN
        INSERT INTO public.validation_attempts (license_key, device_fingerprint, success, error_message, ip_address)
        VALUES (p_license_key, p_device_fingerprint, false, 'License key not found', p_ip_address);

        RETURN json_build_object(
            'valid', false,
            'error', 'Invalid license key',
            'code', 'KEY_NOT_FOUND'
        );
    END IF;

    -- Check if license is active
    IF v_license.is_active = false THEN
        INSERT INTO public.validation_attempts (license_key, device_fingerprint, success, error_message, ip_address)
        VALUES (p_license_key, p_device_fingerprint, false, 'License is inactive', p_ip_address);

        RETURN json_build_object(
            'valid', false,
            'error', 'This license key has been deactivated',
            'code', 'KEY_INACTIVE'
        );
    END IF;

    -- Check if license has expired
    IF v_license.expires_at IS NOT NULL AND v_license.expires_at < NOW() THEN
        INSERT INTO public.validation_attempts (license_key, device_fingerprint, success, error_message, ip_address)
        VALUES (p_license_key, p_device_fingerprint, false, 'License expired', p_ip_address);

        RETURN json_build_object(
            'valid', false,
            'error', 'This license key has expired',
            'code', 'KEY_EXPIRED',
            'expires_at', v_license.expires_at
        );
    END IF;

    -- Check if this device is already activated
    SELECT * INTO v_activation
    FROM public.activations
    WHERE license_key = p_license_key
      AND device_fingerprint = p_device_fingerprint
      AND is_active = true;

    -- Device already activated - update last_used
    IF FOUND THEN
        UPDATE public.activations
        SET last_used = NOW(),
            user_agent = COALESCE(p_user_agent, user_agent),
            ip_address = COALESCE(p_ip_address, ip_address)
        WHERE id = v_activation.id;

        INSERT INTO public.validation_attempts (license_key, device_fingerprint, success, ip_address)
        VALUES (p_license_key, p_device_fingerprint, true, p_ip_address);

        RETURN json_build_object(
            'valid', true,
            'license_key', v_license.license_key,
            'max_devices', v_license.max_devices,
            'expires_at', v_license.expires_at,
            'activated_at', v_activation.activated_at
        );
    END IF;

    -- Count active devices for this license
    SELECT COUNT(*) INTO v_active_count
    FROM public.activations
    WHERE license_key = p_license_key
      AND is_active = true;

    -- Check if max devices reached
    IF v_active_count >= v_license.max_devices THEN
        INSERT INTO public.validation_attempts (license_key, device_fingerprint, success, error_message, ip_address)
        VALUES (p_license_key, p_device_fingerprint, false, 'Max devices reached', p_ip_address);

        RETURN json_build_object(
            'valid', false,
            'error', 'Maximum number of devices reached',
            'code', 'MAX_DEVICES_REACHED',
            'max_devices', v_license.max_devices,
            'current_devices', v_active_count
        );
    END IF;

    -- Activate new device
    INSERT INTO public.activations (
        license_key,
        device_fingerprint,
        user_agent,
        ip_address
    ) VALUES (
        p_license_key,
        p_device_fingerprint,
        p_user_agent,
        p_ip_address
    );

    INSERT INTO public.validation_attempts (license_key, device_fingerprint, success, ip_address)
    VALUES (p_license_key, p_device_fingerprint, true, p_ip_address);

    RETURN json_build_object(
        'valid', true,
        'license_key', v_license.license_key,
        'max_devices', v_license.max_devices,
        'expires_at', v_license.expires_at,
        'activated_at', NOW(),
        'message', 'Device activated successfully'
    );

EXCEPTION WHEN OTHERS THEN
    RETURN json_build_object(
        'valid', false,
        'error', 'An error occurred during validation',
        'code', 'VALIDATION_ERROR'
    );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Stored Procedure: Deactivate Device
CREATE OR REPLACE FUNCTION deactivate_device(
    p_license_key TEXT,
    p_device_fingerprint TEXT
)
RETURNS JSON AS $$
DECLARE
    v_activation RECORD;
BEGIN
    -- Find the activation
    SELECT * INTO v_activation
    FROM public.activations
    WHERE license_key = p_license_key
      AND device_fingerprint = p_device_fingerprint
      AND is_active = true;

    IF NOT FOUND THEN
        RETURN json_build_object(
            'success', false,
            'error', 'Activation not found'
        );
    END IF;

    -- Deactivate the device
    UPDATE public.activations
    SET is_active = false
    WHERE id = v_activation.id;

    RETURN json_build_object(
        'success', true,
        'message', 'Device deactivated successfully'
    );

EXCEPTION WHEN OTHERS THEN
    RETURN json_build_object(
        'success', false,
        'error', 'An error occurred during deactivation'
    );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Stored Procedure: Get License Info
CREATE OR REPLACE FUNCTION get_license_info(
    p_license_key TEXT,
    p_device_fingerprint TEXT
)
RETURNS JSON AS $$
DECLARE
    v_license RECORD;
    v_active_count INTEGER;
    v_activations JSON;
BEGIN
    -- Get license details
    SELECT * INTO v_license
    FROM public.licenses
    WHERE license_key = p_license_key;

    IF NOT FOUND THEN
        RETURN json_build_object(
            'found', false,
            'error', 'License key not found'
        );
    END IF;

    -- Count active devices
    SELECT COUNT(*) INTO v_active_count
    FROM public.activations
    WHERE license_key = p_license_key
      AND is_active = true;

    -- Get activations list (only if requesting from activated device)
    SELECT json_agg(json_build_object(
        'device_fingerprint', SUBSTRING(device_fingerprint, 1, 8) || '...',
        'device_name', device_name,
        'activated_at', activated_at,
        'last_used', last_used,
        'is_current', device_fingerprint = p_device_fingerprint
    )) INTO v_activations
    FROM public.activations
    WHERE license_key = p_license_key
      AND is_active = true;

    RETURN json_build_object(
        'found', true,
        'license_key', v_license.license_key,
        'is_active', v_license.is_active,
        'max_devices', v_license.max_devices,
        'active_devices', v_active_count,
        'expires_at', v_license.expires_at,
        'activations', COALESCE(v_activations, '[]'::json)
    );

EXCEPTION WHEN OTHERS THEN
    RETURN json_build_object(
        'found', false,
        'error', 'An error occurred'
    );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Insert sample/test licenses (replace with your own keys)
-- Example:
-- INSERT INTO public.licenses (license_key, max_devices, purchase_email, notes)
-- VALUES
--     ('YOUR-PREFIX-TEST-XXXX', 3, 'test@example.com', 'Test license key - 3 devices')
-- ON CONFLICT (license_key) DO NOTHING;

-- Grant necessary permissions (adjust as needed)
GRANT USAGE ON SCHEMA public TO anon, authenticated;
GRANT SELECT ON public.licenses TO anon, authenticated;
GRANT SELECT, INSERT, UPDATE ON public.activations TO anon, authenticated;
GRANT INSERT ON public.validation_attempts TO anon, authenticated;
GRANT EXECUTE ON FUNCTION validate_license_key TO anon, authenticated;
GRANT EXECUTE ON FUNCTION deactivate_device TO anon, authenticated;
GRANT EXECUTE ON FUNCTION get_license_info TO anon, authenticated;


================================================================================
FILE PATH: tsconfig.json
================================================================================
{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "types": [
      "node"
    ],
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}

================================================================================
FILE PATH: types.ts
================================================================================
export interface FontPairing {
  primary: string;
  secondary: string;
  rationale: string;
}

export interface SimilarFont {
    name: string;
    source: string; // e.g., "Google Fonts"
    rationale: string;
}

export interface FontAccessibility {
    analysis: string; // A general summary
    notes: string[]; // Specific points like "Clear distinction between I and l"
}

export interface VariableAxis {
    tag: string; // e.g., 'wght'
    name: string; // e.g., 'Weight'
    minValue: number;
    maxValue: number;
    defaultValue: number;
}

export interface FontAnalysis {
  status: 'success' | 'not_enough_data';
  fontName: string;
  fontType: string;
  analysis: string;
  designer: string;
  historicalContext: string;
  weightRecommendations: string[];
  usageRecommendations: string[];
  businessSuitability: string[];
  fontPairings: FontPairing[];
  licenseInfo: string;
  accessibility: FontAccessibility;
  similarFonts: SimilarFont[];
  isVariable: boolean;
  fontFoundry?: string; // The foundry/company that created the font (e.g., "Adobe", "Google", "Monotype")
  fontSource?: FontSource; // Where the font was analyzed from (optional for backward compatibility)
  characterSets?: string[]; // Language support (Latin, Cyrillic, Greek, etc.)
  releaseYear?: string; // When the font was released
  licensingNotes?: string; // Commercial usage considerations
}

// Font source types - expanded for universal font support
export type FontSource =
  | 'google-fonts'
  | 'adobe-fonts'
  | 'uploaded-file'
  | 'image'
  | 'myfonts'
  | 'fontshare'
  | 'font-squirrel'
  | 'dafont'
  | 'fontesk'
  | 'velvetyne'
  | 'league-of-moveable-type'
  | 'the-northern-block'
  | 'atipo'
  | 'other';

export interface PairingCritique {
    overallScore: number; // 1-10
    analysis: string;
    pros: string[];
    cons: string[];
}

export interface GlyphComparison {
    character: string;
    font1Analysis: string;
    font2Analysis: string;
    differences: string[];
    readabilityScore: number;
}

export interface GlyphComparisonResult {
    overallAssessment: string;
    comparisons: GlyphComparison[];
}

// AI Mode types
export type AIMode = 'chrome' | 'cloud';

export interface AISettings {
    mode: AIMode;
    apiKey: string;
}

// Chrome AI API types (Built-in AI / Prompt API)
declare global {
    interface Window {
        ai?: {
            languageModel?: {
                capabilities(): Promise<AILanguageModelCapabilities>;
                create(options?: AILanguageModelCreateOptions): Promise<AILanguageModel>;
            };
        };
    }
}

export interface AILanguageModelCapabilities {
    available: 'readily' | 'after-download' | 'no';
    defaultTopK?: number;
    maxTopK?: number;
    defaultTemperature?: number;
}

export interface AILanguageModelCreateOptions {
    systemPrompt?: string;
    initialPrompts?: Array<{ role: 'system' | 'user' | 'assistant'; content: string }>;
    topK?: number;
    temperature?: number;
}

export interface AILanguageModel {
    prompt(input: string): Promise<string>;
    promptStreaming(input: string): ReadableStream;
    destroy(): void;
}

// Font Suggestion types
export interface FontSuggestionRequest {
    description: string;              // User's text input
    usageTypes?: string[];            // Selected usage categories
    businessTypes?: string[];         // Selected business categories
    themes?: string[];                // Selected theme categories
    fontCategories?: string[];        // serif, sans-serif, etc.
    maxResults?: number;              // Default: 5
}

export interface FontSuggestion {
    fontName: string;                 // Google Font name
    category: string;                 // serif, sans-serif, display, etc.
    rationale: string;                // Why this font fits (2-3 sentences)
    useCases: string[];               // Specific use cases: ["Headers", "Logo"]
    matchScore: number;               // 1-10 relevance score
    previewText?: string;             // Optional custom preview text
}

export interface FontSuggestionResult {
    suggestions: FontSuggestion[];    // 3-5 font recommendations
    searchSummary: string;            // Overview of what was searched
    additionalNotes?: string;         // Any helpful context from AI
}

// Google Fonts API types
export interface GoogleFontMetadata {
    family: string;                   // Font name
    category: string;                 // serif, sans-serif, display, handwriting, monospace
    variants: string[];               // Available weights/styles
    subsets: string[];                // language support
    popularity?: number;              // Usage rank (optional)
}

// Onboarding Tour types
export interface OnboardingStep {
    id: string;
    targetSelector: string;           // CSS selector for target element
    title: string;
    message: string;
    placement?: 'top' | 'bottom' | 'left' | 'right' | 'center';
    actionText: string;               // Button text
    condition?: () => boolean;        // Optional: only show if condition true
}

export interface OnboardingState {
    isActive: boolean;
    currentStep: number;
    hasCompleted: boolean;
}

// Font DNA Matching types
export interface FontDNAMatch {
    fontName: string;                  // Name of the similar font
    source: string;                    // Where to get it (Google Fonts, Adobe Fonts, etc.)
    matchScore: number;                // 1-100 similarity score
    visualSimilarity: string;          // Description of visual similarities
    differingCharacteristics: string;  // What makes it different/unique
    bestUseCase: string;               // When to use this alternative instead
    isPremium: boolean;                // Whether it requires a paid license
    directLink?: string;               // Optional: Direct link to font source
}

export interface FontDNAResult {
    referenceFont: string;             // The font we're finding alternatives for
    totalMatches: number;              // How many alternatives were found
    matches: FontDNAMatch[];           // Array of similar fonts
    analysisNotes: string;             // AI's commentary on the matching process
    characteristics: string[];         // Key DNA characteristics identified
}

// Project Management types
export interface ProjectPairing {
    id: string;                        // Unique ID for this pairing
    leftFont: FontAnalysis | null;     // Left column analysis
    rightFont: FontAnalysis | null;    // Right column analysis
    leftPreview?: string;              // Preview image base64
    rightPreview?: string;             // Preview image base64
    critique?: PairingCritique;        // Optional critique
    createdAt: number;                 // Timestamp when added
    notes?: string;                    // User notes for this pairing
}

export interface Project {
    id: string;                        // Unique project ID
    name: string;                      // Project name (e.g., "Client Brand Refresh")
    description?: string;              // Optional project description
    pairings: ProjectPairing[];        // Array of font pairings in this project
    createdAt: number;                 // Timestamp when created
    updatedAt: number;                 // Timestamp when last modified
    color?: string;                    // Optional color tag for the project
}

export interface ProjectsState {
    projects: Project[];               // All projects
    activeProjectId: string | null;    // Currently active project ID
}

// Typography Context & Trends types
export interface TypographyContextResult {
    fontName: string;                  // The font being analyzed
    historicalUsage: string;           // Historical usage and notable examples
    currentTrends: string;             // Current typography trends (2025)
    pairingTrends: string[];           // What fonts are commonly paired with this
    recommendations: string;           // Professional recommendations
    culturalContext: string;           // Cultural/regional considerations
}

// Batch Compatibility Matrix types
export interface PairingScore {
    font1: string;                     // First font name
    font2: string;                     // Second font name
    score: number;                     // Compatibility score 1-10
    quickNote: string;                 // Brief note about the pairing
}

export interface BatchCompatibilityResult {
    fonts: string[];                   // List of font names analyzed
    pairings: PairingScore[];          // All pairwise compatibility scores
    topPairings: PairingScore[];       // Top 3 best pairings
    worstPairings: PairingScore[];     // Bottom 3 worst pairings
    overallNotes: string;              // General observations about the font set
}


================================================================================
FILE PATH: utils\aiSettings.ts
================================================================================
import type { AIMode, AISettings } from '../types';

const AI_MODE_KEY = 'ai_mode';
const GEMINI_API_KEY = 'gemini_api_key';

/**
 * Get the current AI mode from localStorage
 * Defaults to 'cloud' (primary/recommended option)
 */
export const getAIMode = async (): Promise<AIMode> => {
    const stored = localStorage.getItem(AI_MODE_KEY) as AIMode | null;
    if (stored === 'chrome' || stored === 'cloud') {
        return stored;
    }

    // Default to cloud (recommended option)
    return 'cloud';
};

/**
 * Set the current AI mode in localStorage
 */
export const setAIMode = (mode: AIMode): void => {
    localStorage.setItem(AI_MODE_KEY, mode);
};

/**
 * Get the Gemini API key from localStorage
 */
export const getAPIKey = (): string => {
    return localStorage.getItem(GEMINI_API_KEY) || '';
};

/**
 * Set the Gemini API key in localStorage
 */
export const setAPIKey = (key: string): void => {
    if (key.trim()) {
        localStorage.setItem(GEMINI_API_KEY, key.trim());
    } else {
        localStorage.removeItem(GEMINI_API_KEY);
    }
};

/**
 * Clear the Gemini API key from localStorage
 */
export const clearAPIKey = (): void => {
    localStorage.removeItem(GEMINI_API_KEY);
};

/**
 * Get all AI settings
 */
export const getAISettings = async (): Promise<AISettings> => {
    const mode = await getAIMode();
    const apiKey = getAPIKey();
    return { mode, apiKey };
};

/**
 * Check if Chrome's built-in AI is available
 * Uses the new window.ai.languageModel API
 * This is an EXPERIMENTAL feature and may not work on all systems
 */
export const isChromeAIAvailable = async (): Promise<boolean> => {
    try {
        // Defensive checks - Chrome AI is experimental and may not exist
        if (typeof window === 'undefined') return false;
        if (!('ai' in window)) return false;
        if (!window.ai) return false;
        if (!window.ai.languageModel) return false;
        if (typeof window.ai.languageModel.capabilities !== 'function') return false;

        const capabilities = await window.ai.languageModel.capabilities();
        return capabilities.available === 'readily';
    } catch (error) {
        // Silently fail - Chrome AI is experimental and failures are expected
        console.warn('Chrome AI not available (this is normal):', error);
        return false;
    }
};

/**
 * Get Chrome AI availability status with details
 * Returns detailed status for better user feedback
 * Chrome AI is EXPERIMENTAL and may not work on all systems
 */
export const getChromeAIStatus = async (): Promise<{
    available: boolean;
    status: 'readily' | 'after-download' | 'no' | 'unsupported' | 'checking';
    message: string;
    details?: string;
}> => {
    try {
        // Defensive checks - Chrome AI is experimental
        if (typeof window === 'undefined') {
            return {
                available: false,
                status: 'unsupported',
                message: 'Not Available',
                details: 'Chrome AI is an experimental feature. For reliable results, use Cloud AI with your Gemini API key.'
            };
        }

        if (!('ai' in window) || !window.ai) {
            return {
                available: false,
                status: 'unsupported',
                message: 'Not Available',
                details: 'Chrome AI is not supported in your browser. This experimental feature requires Chrome Canary or Dev channel. Use Cloud AI for reliable results.'
            };
        }

        if (!window.ai.languageModel) {
            return {
                available: false,
                status: 'no',
                message: 'Not Enabled',
                details: 'Chrome AI flags are not enabled. This is an experimental feature. For reliable results, use Cloud AI instead.'
            };
        }

        // Try to get capabilities
        if (typeof window.ai.languageModel.capabilities !== 'function') {
            return {
                available: false,
                status: 'unsupported',
                message: 'Not Available',
                details: 'Chrome AI API is not fully available. Use Cloud AI for reliable results.'
            };
        }

        const capabilities = await window.ai.languageModel.capabilities();

        if (capabilities.available === 'readily') {
            return {
                available: true,
                status: 'readily',
                message: 'Ready âœ“',
                details: 'Chrome AI is working! This experimental feature provides fast, local processing.'
            };
        } else if (capabilities.available === 'after-download') {
            return {
                available: true, // Consider it available but downloading
                status: 'after-download',
                message: 'Downloading...',
                details: 'Model downloading (5-10 min). This is experimental - you can use Cloud AI now for immediate results.'
            };
        } else {
            return {
                available: false,
                status: 'no',
                message: 'Not Available',
                details: 'Chrome AI setup incomplete. This is an experimental feature. Use Cloud AI for reliable results.'
            };
        }
    } catch (error) {
        // Silently handle errors - Chrome AI is experimental
        console.warn('Chrome AI detection failed (this is normal):', error);
        return {
            available: false,
            status: 'unsupported',
            message: 'Not Available',
            details: 'Chrome AI is an experimental feature and may not work on all systems. Use Cloud AI for reliable results.'
        };
    }
};

/**
 * Validate that the current mode can be used
 * Provides helpful error messages for each mode
 */
export const validateAIMode = async (mode: AIMode): Promise<{
    valid: boolean;
    error?: string;
    shouldFallback?: boolean; // Indicates should auto-switch to Cloud AI
}> => {
    if (mode === 'chrome') {
        const available = await isChromeAIAvailable();
        if (!available) {
            return {
                valid: false,
                shouldFallback: true,
                error: 'Chrome AI is not available. Switching to Cloud AI for reliable results.'
            };
        }
        return { valid: true };
    } else {
        // cloud mode - the recommended/primary option
        const apiKey = getAPIKey();
        if (!apiKey) {
            return {
                valid: false,
                shouldFallback: false,
                error: 'No API key configured. Please add your Gemini API key in settings to use Cloud AI.'
            };
        }
        return { valid: true };
    }
};


================================================================================
FILE PATH: utils\fileUtils.ts
================================================================================
export const fileToBase64 = (file: File): Promise<{ base64: string, mimeType: string }> => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => {
      const result = reader.result as string;
      const base64 = result.split(',')[1];
      const mimeType = file.type;
      
      resolve({ base64, mimeType });
    };
    reader.onerror = (error) => reject(error);
  });
};

================================================================================
FILE PATH: utils\fontCache.ts
================================================================================
import type { FontAnalysis } from '../types';

// Cache configuration
const CACHE_PREFIX = 'cadmus_font_cache_';
const CACHE_EXPIRY_DAYS = 30;
const CACHE_VERSION = 'v1'; // Increment to invalidate old caches

interface CacheEntry {
  analysis: FontAnalysis;
  timestamp: number;
  version: string;
}

/**
 * Simple hash function for generating cache keys
 * Uses DJB2 hash algorithm
 */
function simpleHash(str: string): string {
  let hash = 5381;
  for (let i = 0; i < str.length; i++) {
    hash = (hash * 33) ^ str.charCodeAt(i);
  }
  return (hash >>> 0).toString(36);
}

/**
 * Generate cache key for uploaded font file
 */
export function generateFileCacheKey(fileName: string, fileContent: string): string {
  // Use first 1KB of file content for hash
  const contentSample = fileContent.substring(0, 1024);
  const hashInput = `${fileName}_${contentSample}`;
  return `${CACHE_PREFIX}file_${simpleHash(hashInput)}`;
}

/**
 * Generate cache key for Google Font
 */
export function generateGoogleFontCacheKey(fontName: string, variant: string = 'regular'): string {
  const hashInput = `${fontName}_${variant}`;
  return `${CACHE_PREFIX}google_${simpleHash(hashInput)}`;
}

/**
 * Generate cache key for image analysis
 */
export function generateImageCacheKey(imageData: string): string {
  // Use first 2KB of base64 image data for hash
  const contentSample = imageData.substring(0, 2048);
  return `${CACHE_PREFIX}image_${simpleHash(contentSample)}`;
}

/**
 * Check if cache entry is expired
 */
function isExpired(timestamp: number): boolean {
  const expiryMs = CACHE_EXPIRY_DAYS * 24 * 60 * 60 * 1000;
  return Date.now() - timestamp > expiryMs;
}

/**
 * Retrieve cached analysis
 * Returns null if not found, expired, or invalid
 */
export function getCachedAnalysis(cacheKey: string): FontAnalysis | null {
  try {
    const cached = localStorage.getItem(cacheKey);
    if (!cached) return null;

    const entry: CacheEntry = JSON.parse(cached);

    // Check version
    if (entry.version !== CACHE_VERSION) {
      localStorage.removeItem(cacheKey);
      return null;
    }

    // Check expiry
    if (isExpired(entry.timestamp)) {
      localStorage.removeItem(cacheKey);
      return null;
    }

    return entry.analysis;
  } catch (error) {
    console.error('Error reading cache:', error);
    return null;
  }
}

/**
 * Store analysis in cache
 */
export function setCachedAnalysis(cacheKey: string, analysis: FontAnalysis): void {
  try {
    const entry: CacheEntry = {
      analysis,
      timestamp: Date.now(),
      version: CACHE_VERSION
    };

    localStorage.setItem(cacheKey, JSON.stringify(entry));
  } catch (error) {
    console.error('Error writing cache:', error);
    // If localStorage is full, try to clear old entries
    if (error instanceof Error && error.name === 'QuotaExceededError') {
      clearExpiredCache();
      // Try again after clearing
      try {
        const entry: CacheEntry = {
          analysis,
          timestamp: Date.now(),
          version: CACHE_VERSION
        };
        localStorage.setItem(cacheKey, JSON.stringify(entry));
      } catch (retryError) {
        console.error('Failed to cache even after cleanup:', retryError);
      }
    }
  }
}

/**
 * Clear all cached analyses
 */
export function clearCache(): void {
  try {
    const keys = Object.keys(localStorage);
    keys.forEach(key => {
      if (key.startsWith(CACHE_PREFIX)) {
        localStorage.removeItem(key);
      }
    });
  } catch (error) {
    console.error('Error clearing cache:', error);
  }
}

/**
 * Clear only expired cache entries
 */
export function clearExpiredCache(): void {
  try {
    const keys = Object.keys(localStorage);
    keys.forEach(key => {
      if (key.startsWith(CACHE_PREFIX)) {
        try {
          const cached = localStorage.getItem(key);
          if (cached) {
            const entry: CacheEntry = JSON.parse(cached);
            if (isExpired(entry.timestamp) || entry.version !== CACHE_VERSION) {
              localStorage.removeItem(key);
            }
          }
        } catch (e) {
          // If parsing fails, remove the corrupted entry
          localStorage.removeItem(key);
        }
      }
    });
  } catch (error) {
    console.error('Error clearing expired cache:', error);
  }
}

/**
 * Get cache statistics
 */
export function getCacheStats(): {
  totalEntries: number;
  totalSize: number;
  oldestEntry: number | null;
  newestEntry: number | null;
} {
  const keys = Object.keys(localStorage);
  const cacheKeys = keys.filter(key => key.startsWith(CACHE_PREFIX));

  let totalSize = 0;
  let oldestEntry: number | null = null;
  let newestEntry: number | null = null;

  cacheKeys.forEach(key => {
    const value = localStorage.getItem(key);
    if (value) {
      totalSize += value.length;
      try {
        const entry: CacheEntry = JSON.parse(value);
        if (oldestEntry === null || entry.timestamp < oldestEntry) {
          oldestEntry = entry.timestamp;
        }
        if (newestEntry === null || entry.timestamp > newestEntry) {
          newestEntry = entry.timestamp;
        }
      } catch (e) {
        // Ignore parse errors for stats
      }
    }
  });

  return {
    totalEntries: cacheKeys.length,
    totalSize,
    oldestEntry,
    newestEntry
  };
}


================================================================================
FILE PATH: utils\fontUtils.ts
================================================================================
export const getAxisDescription = (tag: string): string => {
    switch (tag.toLowerCase()) {
        case 'wght':
            return "Controls the stroke thickness of the characters, ranging from thin and delicate to heavy and bold. Essential for establishing visual hierarchy.";
        case 'wdth':
            return "Adjusts the horizontal space characters occupy. Lower values create a condensed, narrow look, while higher values produce an expanded, wide style.";
        case 'slnt':
            return "Tilts the characters to an oblique angle, creating a slanted or italic effect. Unlike a true italic, this is typically a uniform shear transformation.";
        case 'ital':
            return "A binary switch (0 for Roman, 1 for Italic) that toggles between the upright and the true italic letterforms, which often have different constructions.";
        case 'opsz':
            return "Optimizes the font's details for its intended display size. At smaller sizes, strokes might be thicker and contrast lower for better legibility. At larger sizes, the font can have finer details and more contrast.";
        default:
            return `This is a custom font axis defined by the font creator with the technical tag '${tag}'.`;
    }
};


================================================================================
FILE PATH: utils\types.ts
================================================================================


================================================================================
FILE PATH: vercel.json
================================================================================
{
  "buildCommand": "npm install --include=optional && npm run build",
  "installCommand": "npm ci --include=optional",
  "framework": "vite"
}


================================================================================
FILE PATH: vite.config.ts
================================================================================
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
    const env = loadEnv(mode, '.', '');
    return {
      server: {
        port: 3005,
        host: '0.0.0.0',
      },
      plugins: [react()],
      define: {
        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
      },
      resolve: {
        alias: {
          '@': path.resolve(__dirname, '.'),
        }
      }
    };
});

